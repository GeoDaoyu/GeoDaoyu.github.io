<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>CSS使用外部字体</title>
    <url>/2020/06/28/CSS%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E5%AD%97%E4%BD%93/</url>
    <content><![CDATA[<p>UI提供的字体，浏览器并没有，需要手动引入。</p>
<p>以普惠体为例，引入方式如下：</p>
<a id="more"></a>
<ol>
<li><p>下载<code>.ttf</code>文件，然后在全局的CSS中用路径引入。</p>
   <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: AlibabaPuHuiTi;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">"./fonts/Alibaba-PuHuiTi.ttf"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>webpack打包部署，可能需要考虑路径指向。</p>
</blockquote>
</li>
<li><p>使用示例</p>
   <figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,<span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: AlibabaPuHuiTi;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>font</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS处理文字溢出</title>
    <url>/2020/07/09/CSS%E5%A4%84%E7%90%86%E6%96%87%E5%AD%97%E6%BA%A2%E5%87%BA/</url>
    <content><![CDATA[<p>有时，文字很长，从展示的地方溢出，导致UI上看着很乱。</p>
<p>这时候，通过CSS控制文字的宽度，把溢出的文字处理为缩略号，保证了UI上的美观。</p>
<p>下面列两种CSS处理文字溢出的方式，分别针对单行文字和多行文字。</p>
<h2 id="单行文字"><a href="#单行文字" class="headerlink" title="单行文字"></a>单行文字</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">overflow</span>: <span class="selector-tag">hidden</span>;</span><br><span class="line"><span class="selector-tag">text-overflow</span>: <span class="selector-tag">ellipsis</span>;</span><br><span class="line"><span class="selector-tag">white-space</span>: <span class="selector-tag">nowrap</span>;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>参数说明：</p>
<ul>
<li><code>text-overflow</code>— 规定当文本溢出包含元素时发生的事情.</li>
<li><code>text-overflow: ellipsis</code>— 显示省略符号来代表被修剪的文本.</li>
<li><code>white-space</code>— 设置如何处理元素内的空白 .</li>
<li><code>white-space: nowrap</code>文本不会换行，文本会在在同一行上继续，直到遇到 <code>&lt;br&gt;</code> 标签为止.</li>
</ul>
<h2 id="多行文字"><a href="#多行文字" class="headerlink" title="多行文字"></a>多行文字</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">display</span>: <span class="selector-tag">-webkit-box</span>;</span><br><span class="line"><span class="selector-tag">-webkit-line-clamp</span>: 2;</span><br><span class="line"><span class="selector-tag">-webkit-box-orient</span>: <span class="selector-tag">vertical</span>;</span><br><span class="line"><span class="selector-tag">overflow</span>: <span class="selector-tag">hidden</span>;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>-webkit-line-clamp</code>— webkit的私有属性，用来限制在一个块元素显示的文本的行数.</li>
<li><code>-webkit-box-orient</code>— 设置或检索伸缩盒对象的子元素的排列方式 .</li>
<li><code>display: -webkit-box</code>— 将对象作为弹性伸缩盒子模型显示.</li>
</ul>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>ellipsis</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx基础-1:安装部署</title>
    <url>/2020/06/03/Nginx%E5%9F%BA%E7%A1%80-1-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<p>Nginx作为高性能的Web服务器，小巧、稳定、香。</p>
<p>官网文档链接：<a href="http://nginx.org/en/docs/" target="_blank" rel="noopener">http://nginx.org/en/docs/</a></p>
<p>下面介绍两种操作系统下的安装部署。</p>
<a id="more"></a>
<h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p>在<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a>下载压缩包</p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/1568250404696.png" alt="1568250404696"></p>
<p>解压后即可使用</p>
<p>配置在<code>nginx\conf</code>目录修改<code>nginx.conf</code></p>
<p><strong>常用命令</strong>：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd nginx         -- 进入到nginx解压文件的目录</span><br><span class="line">start nginx      -- 启动</span><br><span class="line">nginx -s reload  -- 重新装载配置文件并重启</span><br><span class="line">nginx -s stop    -- 快速停止</span><br><span class="line">nginx -s quit    -- 正常停止</span><br></pre></td></tr></table></figure>

<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>官网安装说明：<a href="http://nginx.org/en/linux_packages.html#RHEL-CentOS" target="_blank" rel="noopener">http://nginx.org/en/linux_packages.html#RHEL-CentOS</a></p>
<p>执行下面两个命令进行安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install yum-utils</span><br><span class="line">sudo yum install nginx</span><br></pre></td></tr></table></figure>

<p>安装后，cd到<code>/usr/sbin/</code>目录下启动nginx</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/sbin</span><br><span class="line">./nginx</span><br></pre></td></tr></table></figure>

<p>配置在<code>/etc/nginx</code>目录下修改<code>nginx.conf</code></p>
<p><strong>常用命令</strong>：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd nginx         -- 进入到nginx解压文件的目录</span><br><span class="line">./nginx          -- 启动</span><br><span class="line">nginx -s reload  -- 重新装载配置文件并重启</span><br><span class="line">nginx -s stop    -- 快速停止</span><br><span class="line">nginx -s quit    -- 正常停止</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：linux下如果启动失败，报错缺失日志文件，则在对应路径下新建日志文件。</p>
</blockquote>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>ArcGIS-JS-API加载天地图</title>
    <url>/2020/07/06/ArcGIS-JS-API%E5%8A%A0%E8%BD%BD%E5%A4%A9%E5%9C%B0%E5%9B%BE/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在<a href="http://lbs.tianditu.gov.cn/server/MapService.html" target="_blank" rel="noopener">天地图官网服务</a>可以看到，天地图提供了多种底图服务，分别有两种投影类型，CGCS2000和Web Mercator。</p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/1584498518305.png" alt="1584498518305"></p>
<a id="more"></a>
<h2 id="WMTSLayer加载失败"><a href="#WMTSLayer加载失败" class="headerlink" title="WMTSLayer加载失败"></a>WMTSLayer加载失败</h2><p>使用WMTSLayer进行加载</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> wmtsLayer = <span class="keyword">new</span> WMTSLayer(&#123;</span><br><span class="line">  id: <span class="string">"wmts"</span>,</span><br><span class="line">  url: <span class="string">"http://t0.tianditu.gov.cn/vec_c/wmts"</span>,</span><br><span class="line">  customParameters: &#123;</span><br><span class="line">    tk: <span class="string">"b854fdb3a3b2625bd6c8353e83f7cca3"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  serviceMode: <span class="string">"KVP"</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>结果：无报错，不上图。</p>
<p>查看源码得知：</p>
<p>WMTSLayer先请求元数据，然后构造tileInfo，最后用WebTileLayer加载。</p>
<h2 id="问题排查"><a href="#问题排查" class="headerlink" title="问题排查"></a>问题排查</h2><p>查看天地图和Esri的切片方案。</p>
<p>Esri的切片方案是从第0级开始，天地图的切片方案从第1级开始。</p>
<p>切片方案，附在文末附件中。</p>
<h2 id="WebTileLayer加载"><a href="#WebTileLayer加载" class="headerlink" title="WebTileLayer加载"></a>WebTileLayer加载</h2><p>4490和4326差别很小，可以叠加，所以CGCS2000的服务，采用4326来加载。</p>
<p>tileInfo中dpi，参考一篇<a href="https://www.cnblogs.com/cehui0303/p/10978011.html" target="_blank" rel="noopener">博文</a>，设置为<code>layers/support/wmtsUtils.js</code>中的90.71428571428571。</p>
<p>lods采用4326的切片方案，levelValue设置为天地图的level。</p>
<p>size和origin按天地图的切片方案设置。</p>
<p>spatialReference设置为4326。（如果设置为4490，也可以上图，但是view的center不生效。）</p>
<p>通过构造TileInfo，使用WebTileLayer来加载。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> WebTileLayer <span class="keyword">from</span> <span class="string">"esri/layers/WebTileLayer"</span>;</span><br><span class="line"><span class="keyword">import</span> TileInfo <span class="keyword">from</span> <span class="string">"esri/layers/support/TileInfo"</span>;</span><br><span class="line"><span class="keyword">import</span> SpatialReference <span class="keyword">from</span> <span class="string">"esri/geometry/SpatialReference"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tileInfoWebMercator = <span class="keyword">new</span> TileInfo(&#123;</span><br><span class="line">  dpi: <span class="number">90.71428571427429</span>,</span><br><span class="line">  lods: [&#123;</span><br><span class="line">    level: <span class="number">0</span>,</span><br><span class="line">    scale: <span class="number">591657527.591555</span>,</span><br><span class="line">    resolution: <span class="number">156543.033928</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">1</span>,</span><br><span class="line">    scale: <span class="number">295828763.795777</span>,</span><br><span class="line">    resolution: <span class="number">78271.5169639999</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">2</span>,</span><br><span class="line">    scale: <span class="number">147914381.897889</span>,</span><br><span class="line">    resolution: <span class="number">39135.7584820001</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">3</span>,</span><br><span class="line">    scale: <span class="number">73957190.948944</span>,</span><br><span class="line">    resolution: <span class="number">19567.8792409999</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">4</span>,</span><br><span class="line">    scale: <span class="number">36978595.474472</span>,</span><br><span class="line">    resolution: <span class="number">9783.93962049996</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">5</span>,</span><br><span class="line">    scale: <span class="number">18489297.737236</span>,</span><br><span class="line">    resolution: <span class="number">4891.96981024998</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">6</span>,</span><br><span class="line">    scale: <span class="number">9244648.868618</span>,</span><br><span class="line">    resolution: <span class="number">2445.98490512499</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">7</span>,</span><br><span class="line">    scale: <span class="number">4622324.434309</span>,</span><br><span class="line">    resolution: <span class="number">1222.99245256249</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">8</span>,</span><br><span class="line">    scale: <span class="number">2311162.217155</span>,</span><br><span class="line">    resolution: <span class="number">611.49622628138</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">9</span>,</span><br><span class="line">    scale: <span class="number">1155581.108577</span>,</span><br><span class="line">    resolution: <span class="number">305.748113140558</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">10</span>,</span><br><span class="line">    scale: <span class="number">577790.554289</span>,</span><br><span class="line">    resolution: <span class="number">152.874056570411</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">11</span>,</span><br><span class="line">    scale: <span class="number">288895.277144</span>,</span><br><span class="line">    resolution: <span class="number">76.4370282850732</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">12</span>,</span><br><span class="line">    scale: <span class="number">144447.638572</span>,</span><br><span class="line">    resolution: <span class="number">38.2185141425366</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">13</span>,</span><br><span class="line">    scale: <span class="number">72223.819286</span>,</span><br><span class="line">    resolution: <span class="number">19.1092570712683</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">14</span>,</span><br><span class="line">    scale: <span class="number">36111.909643</span>,</span><br><span class="line">    resolution: <span class="number">9.55462853563415</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">15</span>,</span><br><span class="line">    scale: <span class="number">18055.954822</span>,</span><br><span class="line">    resolution: <span class="number">4.77731426794937</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">16</span>,</span><br><span class="line">    scale: <span class="number">9027.977411</span>,</span><br><span class="line">    resolution: <span class="number">2.38865713397468</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">17</span>,</span><br><span class="line">    scale: <span class="number">4513.988705</span>,</span><br><span class="line">    resolution: <span class="number">1.19432856685505</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">18</span>,</span><br><span class="line">    scale: <span class="number">2256.994353</span>,</span><br><span class="line">    resolution: <span class="number">0.597164283559817</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    level: <span class="number">19</span>,</span><br><span class="line">    scale: <span class="number">1128.497176</span>,</span><br><span class="line">    resolution: <span class="number">0.298582141647617</span></span><br><span class="line">  &#125;],</span><br><span class="line">  size: [<span class="number">256</span>, <span class="number">256</span>],</span><br><span class="line">  origin: &#123;</span><br><span class="line">    x: <span class="number">-20037508.342787</span>,</span><br><span class="line">    y: <span class="number">20037508.342787</span></span><br><span class="line">  &#125;,</span><br><span class="line">  spatialReference: SpatialReference.WebMercator</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> tileInfoWGS84 = <span class="keyword">new</span> TileInfo(&#123;</span><br><span class="line">  dpi: <span class="number">90.71428571427429</span>,</span><br><span class="line">  lods: [</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">0</span>,</span><br><span class="line">      levelValue: <span class="string">"1"</span>,</span><br><span class="line">      scale: <span class="number">295828763.79585470937713011037</span>,</span><br><span class="line">      resolution: <span class="number">0.703125</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">1</span>,</span><br><span class="line">      levelValue: <span class="string">"2"</span>,</span><br><span class="line">      scale: <span class="number">147914381.89792735468856505518</span>,</span><br><span class="line">      resolution: <span class="number">0.3515625</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">2</span>,</span><br><span class="line">      levelValue: <span class="string">"3"</span>,</span><br><span class="line">      scale: <span class="number">73957190.948963677344282527592</span>,</span><br><span class="line">      resolution: <span class="number">0.17578125</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">3</span>,</span><br><span class="line">      levelValue: <span class="string">"4"</span>,</span><br><span class="line">      scale: <span class="number">36978595.474481838672141263796</span>,</span><br><span class="line">      resolution: <span class="number">0.087890625</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">4</span>,</span><br><span class="line">      levelValue: <span class="string">"5"</span>,</span><br><span class="line">      scale: <span class="number">18489297.737240919336070631898</span>,</span><br><span class="line">      resolution: <span class="number">0.0439453125</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">5</span>,</span><br><span class="line">      levelValue: <span class="string">"6"</span>,</span><br><span class="line">      scale: <span class="number">9244648.868620459668035315949</span>,</span><br><span class="line">      resolution: <span class="number">0.02197265625</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">6</span>,</span><br><span class="line">      levelValue: <span class="string">"7"</span>,</span><br><span class="line">      scale: <span class="number">4622324.4343102298340176579745</span>,</span><br><span class="line">      resolution: <span class="number">0.010986328125</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">7</span>,</span><br><span class="line">      levelValue: <span class="string">"8"</span>,</span><br><span class="line">      scale: <span class="number">2311162.2171551149170088289872</span>,</span><br><span class="line">      resolution: <span class="number">0.0054931640625</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">8</span>,</span><br><span class="line">      levelValue: <span class="string">"9"</span>,</span><br><span class="line">      scale: <span class="number">1155581.1085775574585044144937</span>,</span><br><span class="line">      resolution: <span class="number">0.00274658203125</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">9</span>,</span><br><span class="line">      levelValue: <span class="string">"10"</span>,</span><br><span class="line">      scale: <span class="number">577790.55428877872925220724681</span>,</span><br><span class="line">      resolution: <span class="number">0.001373291015625</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">10</span>,</span><br><span class="line">      levelValue: <span class="string">"11"</span>,</span><br><span class="line">      scale: <span class="number">288895.2771443893646261036234</span>,</span><br><span class="line">      resolution: <span class="number">0.0006866455078125</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">11</span>,</span><br><span class="line">      levelValue: <span class="string">"12"</span>,</span><br><span class="line">      scale: <span class="number">144447.63857219468231305181171</span>,</span><br><span class="line">      resolution: <span class="number">0.00034332275390625</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">12</span>,</span><br><span class="line">      levelValue: <span class="string">"13"</span>,</span><br><span class="line">      scale: <span class="number">72223.819286097341156525905853</span>,</span><br><span class="line">      resolution: <span class="number">0.000171661376953125</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">13</span>,</span><br><span class="line">      levelValue: <span class="string">"14"</span>,</span><br><span class="line">      scale: <span class="number">36111.909643048670578262952926</span>,</span><br><span class="line">      resolution: <span class="number">0.0000858306884765625</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">14</span>,</span><br><span class="line">      levelValue: <span class="string">"15"</span>,</span><br><span class="line">      scale: <span class="number">18055.954821524335289131476463</span>,</span><br><span class="line">      resolution: <span class="number">0.00004291534423828125</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">15</span>,</span><br><span class="line">      levelValue: <span class="string">"16"</span>,</span><br><span class="line">      scale: <span class="number">9027.977410762167644565738231</span>,</span><br><span class="line">      resolution: <span class="number">0.000021457672119140625</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">16</span>,</span><br><span class="line">      levelValue: <span class="string">"17"</span>,</span><br><span class="line">      scale: <span class="number">4513.9887053810838222828691158</span>,</span><br><span class="line">      resolution: <span class="number">0.0000107288360595703125</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">17</span>,</span><br><span class="line">      levelValue: <span class="string">"18"</span>,</span><br><span class="line">      scale: <span class="number">2256.9943526905419111414345579</span>,</span><br><span class="line">      resolution: <span class="number">0.00000536441802978515625</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      level: <span class="number">18</span>,</span><br><span class="line">      levelValue: <span class="string">"19"</span>,</span><br><span class="line">      scale: <span class="number">1128.4971763452709555707172788</span>,</span><br><span class="line">      resolution: <span class="number">0.000002682209014892578125</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  size: [<span class="number">256</span>, <span class="number">256</span>],</span><br><span class="line">  origin: &#123;</span><br><span class="line">    x: <span class="number">-180</span>,</span><br><span class="line">    y: <span class="number">90</span></span><br><span class="line">  &#125;,</span><br><span class="line">  spatialReference: SpatialReference.WGS84</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> TianDiTuLayer <span class="keyword">extends</span> WebTileLayer &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">props: WebTileLayer</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.tileInfo = <span class="keyword">this</span>.generateTileInfo(props.urlTemplate);</span><br><span class="line">    <span class="keyword">this</span>.urlTemplate = <span class="keyword">this</span>.generateUrlTemplate(props.urlTemplate);</span><br><span class="line">    <span class="keyword">this</span>.subDomains = [<span class="string">"t0"</span>, <span class="string">"t1"</span>, <span class="string">"t2"</span>, <span class="string">"t3"</span>, <span class="string">"t4"</span>, <span class="string">"t5"</span>, <span class="string">"t6"</span>, <span class="string">"t7"</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> generateUrlTemplate(urlTemplate: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [layer, tileMatrixSet] = urlTemplate.split(<span class="string">'/'</span>)[<span class="number">3</span>].split(<span class="string">'_'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`http://&#123;subDomain&#125;.tianditu.com/<span class="subst">$&#123;layer&#125;</span>_<span class="subst">$&#123;tileMatrixSet&#125;</span>/wmts?SERVICE=WMTS&amp;VERSION=1.0.0&amp;REQUEST=GetTile&amp;LAYER=<span class="subst">$&#123;layer&#125;</span>&amp;STYLE=default&amp;FORMAT=tiles&amp;TILEMATRIXSET=<span class="subst">$&#123;tileMatrixSet&#125;</span>&amp;TILEMATRIX=&#123;level&#125;&amp;TILEROW=&#123;row&#125;&amp;TILECOL=&#123;col&#125;&amp;tk=ac0daf56728bbb77d9514ba3df69bcd3`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> generateTileInfo(urlTemplate: <span class="built_in">string</span>): TileInfo &#123;</span><br><span class="line">    <span class="keyword">const</span> [layer, tileMatrixSet] = urlTemplate.split(<span class="string">'/'</span>)[<span class="number">3</span>].split(<span class="string">'_'</span>);</span><br><span class="line">    <span class="keyword">return</span> tileMatrixSet === <span class="string">'c'</span> ? tileInfoWGS84 : tileInfoWebMercator;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> TianDiTuLayer(&#123;</span><br><span class="line">  urlTemplate: <span class="string">"http://t0.tianditu.com/vec_w/wmts"</span></span><br><span class="line">&#125; <span class="keyword">as</span> TianDiTuLayer);</span><br><span class="line"><span class="keyword">new</span> TianDiTuLayer(&#123;</span><br><span class="line">  urlTemplate: <span class="string">"http://t0.tianditu.com/img_c/wmts"</span>,</span><br><span class="line">  spatialReference: SpatialReference.WGS84</span><br><span class="line">&#125; <span class="keyword">as</span> TianDiTuLayer);</span><br></pre></td></tr></table></figure>

<h2 id="附件"><a href="#附件" class="headerlink" title="附件"></a>附件</h2><h3 id="天地图-经纬度投影-切片方案"><a href="#天地图-经纬度投影-切片方案" class="headerlink" title="天地图-经纬度投影-切片方案"></a>天地图-经纬度投影-切片方案</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Capabilities</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.opengis.net/wmts/1.0 http://schemas.opengis.net/wmts/1.0.0/wmtsGetCapabilities_response.xsd"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.opengis.net/wmts/1.0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:ows</span>=<span class="string">"http://www.opengis.net/ows/1.1"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:gml</span>=<span class="string">"http://www.opengis.net/gml"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:xlink</span>=<span class="string">"http://www.w3.org/1999/xlink"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ows:ServiceIdentification</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Title</span>&gt;</span>在线地图服务<span class="tag">&lt;/<span class="name">ows:Title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Abstract</span>&gt;</span>基于OGC标准的地图服务<span class="tag">&lt;/<span class="name">ows:Abstract</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Keywords</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:Keyword</span>&gt;</span>OGC<span class="tag">&lt;/<span class="name">ows:Keyword</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ows:Keywords</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:ServiceType</span> <span class="attr">codeSpace</span>=<span class="string">"wmts"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:ServiceTypeVersion</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">ows:ServiceTypeVersion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Fees</span>&gt;</span>none<span class="tag">&lt;/<span class="name">ows:Fees</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:AccessConstraints</span>&gt;</span>none<span class="tag">&lt;/<span class="name">ows:AccessConstraints</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ows:ServiceIdentification</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ows:ServiceProvider</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:ProviderName</span>&gt;</span>国家基础地理信息中心<span class="tag">&lt;/<span class="name">ows:ProviderName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:ProviderSite</span>&gt;</span>http://www.tianditu.com<span class="tag">&lt;/<span class="name">ows:ProviderSite</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:ServiceContact</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:IndividualName</span>&gt;</span>Mr Liu<span class="tag">&lt;/<span class="name">ows:IndividualName</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:PositionName</span>&gt;</span>Software Engineer<span class="tag">&lt;/<span class="name">ows:PositionName</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:ContactInfo</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Phone</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:Voice</span>&gt;</span>010-88187700<span class="tag">&lt;/<span class="name">ows:Voice</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:Facsimile</span>&gt;</span>010-88187700<span class="tag">&lt;/<span class="name">ows:Facsimile</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ows:Phone</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Address</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:DeliveryPoint</span>&gt;</span>北京市海淀区莲花池西路28号<span class="tag">&lt;/<span class="name">ows:DeliveryPoint</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:City</span>&gt;</span>北京市<span class="tag">&lt;/<span class="name">ows:City</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:AdministrativeArea</span>&gt;</span>北京市<span class="tag">&lt;/<span class="name">ows:AdministrativeArea</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:Country</span>&gt;</span>中国<span class="tag">&lt;/<span class="name">ows:Country</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:PostalCode</span>&gt;</span>101399<span class="tag">&lt;/<span class="name">ows:PostalCode</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:ElectronicMailAddress</span>&gt;</span>tianditu.com<span class="tag">&lt;/<span class="name">ows:ElectronicMailAddress</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ows:Address</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:OnlineResource</span> <span class="attr">xlink:type</span>=<span class="string">"simple"</span> <span class="attr">xlink:href</span>=<span class="string">"http://www.tianditu.com"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ows:ContactInfo</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ows:ServiceContact</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ows:ServiceProvider</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ows:OperationsMetadata</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Operation</span> <span class="attr">name</span>=<span class="string">"GetCapabilities"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:DCP</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:HTTP</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:Get</span> <span class="attr">xlink:href</span>=<span class="string">"http://t0.tianditu.com/vec_c/wmts?"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ows:Constraint</span> <span class="attr">name</span>=<span class="string">"GetEncoding"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ows:AllowedValues</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">ows:Value</span>&gt;</span>KVP<span class="tag">&lt;/<span class="name">ows:Value</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">ows:AllowedValues</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ows:Constraint</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ows:Get</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ows:HTTP</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ows:DCP</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ows:Operation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Operation</span> <span class="attr">name</span>=<span class="string">"GetTile"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:DCP</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:HTTP</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:Get</span> <span class="attr">xlink:href</span>=<span class="string">"http://t0.tianditu.com/vec_c/wmts?"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ows:Constraint</span> <span class="attr">name</span>=<span class="string">"GetEncoding"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ows:AllowedValues</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">ows:Value</span>&gt;</span>KVP<span class="tag">&lt;/<span class="name">ows:Value</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">ows:AllowedValues</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ows:Constraint</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ows:Get</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ows:HTTP</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ows:DCP</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ows:Operation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ows:OperationsMetadata</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Contents</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Layer</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:Title</span>&gt;</span>vec<span class="tag">&lt;/<span class="name">ows:Title</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:Abstract</span>&gt;</span>vec<span class="tag">&lt;/<span class="name">ows:Abstract</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>vec<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:WGS84BoundingBox</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:LowerCorner</span>&gt;</span>-180.0 -90.0<span class="tag">&lt;/<span class="name">ows:LowerCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:UpperCorner</span>&gt;</span>180.0 90.0<span class="tag">&lt;/<span class="name">ows:UpperCorner</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ows:WGS84BoundingBox</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:BoundingBox</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:LowerCorner</span>&gt;</span>-180.0 -90.0<span class="tag">&lt;/<span class="name">ows:LowerCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:UpperCorner</span>&gt;</span>180.0 90.0<span class="tag">&lt;/<span class="name">ows:UpperCorner</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ows:BoundingBox</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Style</span>&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>default<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Format</span>&gt;</span>tiles<span class="tag">&lt;/<span class="name">Format</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrixSetLink</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileMatrixSet</span>&gt;</span>c<span class="tag">&lt;/<span class="name">TileMatrixSet</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrixSetLink</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Layer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TileMatrixSet</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>c<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:SupportedCRS</span>&gt;</span>urn:ogc:def:crs:EPSG::4490<span class="tag">&lt;/<span class="name">ows:SupportedCRS</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>1<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>2.958293554545656E8<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>2<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>1<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>2<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>1.479146777272828E8<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>4<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>2<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>3<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>7.39573388636414E7<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>8<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>4<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>4<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>3.69786694318207E7<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>16<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>8<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>5<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>1.848933471591035E7<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>32<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>16<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>6<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>9244667.357955175<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>64<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>32<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span>                </span><br><span class="line">			    <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>7<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>4622333.678977588<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>128<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>64<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>8<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>2311166.839488794<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>128<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>9<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>1155583.419744397<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>512<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>10<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>577791.7098721985<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>512<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>11<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>288895.85493609926<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>12<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>144447.92746804963<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>13<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>72223.96373402482<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>8192<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>14<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>36111.98186701241<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>16384<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>8192<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>15<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>18055.990933506204<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>32768<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>16384<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>16<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>9027.995466753102<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>65536<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>32768<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>17<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>4513.997733376551<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>131072<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>65536<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>18<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>2256.998866688275<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>262144<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>131072<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>19<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>1128.4994333441375<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>524288<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>262144<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">TileMatrixSet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Contents</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Capabilities</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="天地图-球面墨卡托投影-切片方案"><a href="#天地图-球面墨卡托投影-切片方案" class="headerlink" title="天地图-球面墨卡托投影-切片方案"></a>天地图-球面墨卡托投影-切片方案</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Capabilities</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.opengis.net/wmts/1.0 http://schemas.opengis.net/wmts/1.0.0/wmtsGetCapabilities_response.xsd"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">version</span>=<span class="string">"1.0.0"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.opengis.net/wmts/1.0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:ows</span>=<span class="string">"http://www.opengis.net/ows/1.1"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:gml</span>=<span class="string">"http://www.opengis.net/gml"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:xlink</span>=<span class="string">"http://www.w3.org/1999/xlink"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ows:ServiceIdentification</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Title</span>&gt;</span>在线地图服务<span class="tag">&lt;/<span class="name">ows:Title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Abstract</span>&gt;</span>基于OGC标准的地图服务<span class="tag">&lt;/<span class="name">ows:Abstract</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Keywords</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:Keyword</span>&gt;</span>OGC<span class="tag">&lt;/<span class="name">ows:Keyword</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ows:Keywords</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:ServiceType</span> <span class="attr">codeSpace</span>=<span class="string">"wmts"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:ServiceTypeVersion</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">ows:ServiceTypeVersion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Fees</span>&gt;</span>none<span class="tag">&lt;/<span class="name">ows:Fees</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:AccessConstraints</span>&gt;</span>none<span class="tag">&lt;/<span class="name">ows:AccessConstraints</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ows:ServiceIdentification</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ows:ServiceProvider</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:ProviderName</span>&gt;</span>国家基础地理信息中心<span class="tag">&lt;/<span class="name">ows:ProviderName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:ProviderSite</span>&gt;</span>http://www.tianditu.com<span class="tag">&lt;/<span class="name">ows:ProviderSite</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:ServiceContact</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:IndividualName</span>&gt;</span>Mr Liu<span class="tag">&lt;/<span class="name">ows:IndividualName</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:PositionName</span>&gt;</span>Software Engineer<span class="tag">&lt;/<span class="name">ows:PositionName</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:ContactInfo</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Phone</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:Voice</span>&gt;</span>010-88187700<span class="tag">&lt;/<span class="name">ows:Voice</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:Facsimile</span>&gt;</span>010-88187700<span class="tag">&lt;/<span class="name">ows:Facsimile</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ows:Phone</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Address</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:DeliveryPoint</span>&gt;</span>北京市海淀区莲花池西路28号<span class="tag">&lt;/<span class="name">ows:DeliveryPoint</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:City</span>&gt;</span>北京市<span class="tag">&lt;/<span class="name">ows:City</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:AdministrativeArea</span>&gt;</span>北京市<span class="tag">&lt;/<span class="name">ows:AdministrativeArea</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:Country</span>&gt;</span>中国<span class="tag">&lt;/<span class="name">ows:Country</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:PostalCode</span>&gt;</span>101399<span class="tag">&lt;/<span class="name">ows:PostalCode</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:ElectronicMailAddress</span>&gt;</span>tianditu.com<span class="tag">&lt;/<span class="name">ows:ElectronicMailAddress</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ows:Address</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:OnlineResource</span> <span class="attr">xlink:type</span>=<span class="string">"simple"</span> <span class="attr">xlink:href</span>=<span class="string">"http://www.tianditu.com"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ows:ContactInfo</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ows:ServiceContact</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ows:ServiceProvider</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ows:OperationsMetadata</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Operation</span> <span class="attr">name</span>=<span class="string">"GetCapabilities"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:DCP</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:HTTP</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:Get</span> <span class="attr">xlink:href</span>=<span class="string">"http://t0.tianditu.com/vec_w/wmts?"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ows:Constraint</span> <span class="attr">name</span>=<span class="string">"GetEncoding"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ows:AllowedValues</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">ows:Value</span>&gt;</span>KVP<span class="tag">&lt;/<span class="name">ows:Value</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">ows:AllowedValues</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ows:Constraint</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ows:Get</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ows:HTTP</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ows:DCP</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ows:Operation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ows:Operation</span> <span class="attr">name</span>=<span class="string">"GetTile"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:DCP</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:HTTP</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ows:Get</span> <span class="attr">xlink:href</span>=<span class="string">"http://t0.tianditu.com/vec_w/wmts?"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ows:Constraint</span> <span class="attr">name</span>=<span class="string">"GetEncoding"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ows:AllowedValues</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">ows:Value</span>&gt;</span>KVP<span class="tag">&lt;/<span class="name">ows:Value</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">ows:AllowedValues</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ows:Constraint</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ows:Get</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ows:HTTP</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ows:DCP</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ows:Operation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ows:OperationsMetadata</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Contents</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Layer</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:Title</span>&gt;</span>vec<span class="tag">&lt;/<span class="name">ows:Title</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:Abstract</span>&gt;</span>vec<span class="tag">&lt;/<span class="name">ows:Abstract</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>vec<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:WGS84BoundingBox</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:LowerCorner</span>&gt;</span>-20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">ows:LowerCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:UpperCorner</span>&gt;</span>20037508.3427892 20037508.3427892<span class="tag">&lt;/<span class="name">ows:UpperCorner</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ows:WGS84BoundingBox</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:BoundingBox</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:LowerCorner</span>&gt;</span>-20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">ows:LowerCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:UpperCorner</span>&gt;</span>20037508.3427892 20037508.3427892<span class="tag">&lt;/<span class="name">ows:UpperCorner</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ows:BoundingBox</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Style</span>&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>default<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Format</span>&gt;</span>tiles<span class="tag">&lt;/<span class="name">Format</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrixSetLink</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileMatrixSet</span>&gt;</span>w<span class="tag">&lt;/<span class="name">TileMatrixSet</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrixSetLink</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Layer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TileMatrixSet</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>w<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ows:SupportedCRS</span>&gt;</span>urn:ogc:def:crs:EPSG::900913<span class="tag">&lt;/<span class="name">ows:SupportedCRS</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>1<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>2.958293554545656E8<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>2<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>2<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>2<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>1.479146777272828E8<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>4<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>4<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>3<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>7.39573388636414E7<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>8<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>8<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>4<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>3.69786694318207E7<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>16<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>16<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>5<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>1.848933471591035E7<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>32<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>32<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>6<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>9244667.357955175<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>64<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>64<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">			      <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>7<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>4622333.678977588<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>128<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>128<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>8<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>2311166.839488794<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>9<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>1155583.419744397<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>512<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>512<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>10<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>577791.7098721985<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>11<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>288895.85493609926<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>12<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>144447.92746804963<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>13<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>72223.96373402482<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>8192<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>8192<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>14<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>36111.98186701241<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>16384<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>16384<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>15<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>18055.990933506204<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>32768<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>32768<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>16<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>9027.995466753102<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>65536<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>65536<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>17<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>4513.997733376551<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>131072<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>131072<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>18<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>2256.998866688275<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>20037508.3427892 -20037508.3427892<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>262144<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>262144<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ows:Identifier</span>&gt;</span>19<span class="tag">&lt;/<span class="name">ows:Identifier</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ScaleDenominator</span>&gt;</span>1128.4994333441375<span class="tag">&lt;/<span class="name">ScaleDenominator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TopLeftCorner</span>&gt;</span>90.0 -180.0<span class="tag">&lt;/<span class="name">TopLeftCorner</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileWidth</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TileHeight</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileHeight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixWidth</span>&gt;</span>524288<span class="tag">&lt;/<span class="name">MatrixWidth</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MatrixHeight</span>&gt;</span>262144<span class="tag">&lt;/<span class="name">MatrixHeight</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TileMatrix</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">TileMatrixSet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Contents</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Capabilities</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Esri-WGS84-Geographic-Coordinate-System-V2"><a href="#Esri-WGS84-Geographic-Coordinate-System-V2" class="headerlink" title="Esri-WGS84_Geographic_Coordinate_System_V2"></a>Esri-WGS84_Geographic_Coordinate_System_V2</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CacheInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:CacheInfo'</span> <span class="attr">xmlns:xsi</span>=<span class="string">'http://www.w3.org/2001/XMLSchema-instance'</span> <span class="attr">xmlns:xs</span>=<span class="string">'http://www.w3.org/2001/XMLSchema'</span> <span class="attr">xmlns:typens</span>=<span class="string">'http://www.esri.com/schemas/ArcGIS/10.0'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">TileCacheInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:TileCacheInfo'</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">SpatialReference</span> <span class="attr">xsi:type</span>=<span class="string">"typens:GeographicCoordinateSystem"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">WKT</span>&gt;</span>GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]<span class="tag">&lt;/<span class="name">WKT</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">XOrigin</span>&gt;</span>-399.99999999999989<span class="tag">&lt;/<span class="name">XOrigin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">YOrigin</span>&gt;</span>-399.99999999999989<span class="tag">&lt;/<span class="name">YOrigin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">XYScale</span>&gt;</span>11258999068426.24<span class="tag">&lt;/<span class="name">XYScale</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ZOrigin</span>&gt;</span>-100000<span class="tag">&lt;/<span class="name">ZOrigin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ZScale</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">ZScale</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">MOrigin</span>&gt;</span>-100000<span class="tag">&lt;/<span class="name">MOrigin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">MScale</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">MScale</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">XYTolerance</span>&gt;</span>8.9831528411952133e-009<span class="tag">&lt;/<span class="name">XYTolerance</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ZTolerance</span>&gt;</span>0.001<span class="tag">&lt;/<span class="name">ZTolerance</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">MTolerance</span>&gt;</span>0.001<span class="tag">&lt;/<span class="name">MTolerance</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">HighPrecision</span>&gt;</span>true<span class="tag">&lt;/<span class="name">HighPrecision</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">LeftLongitude</span>&gt;</span>-180<span class="tag">&lt;/<span class="name">LeftLongitude</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">WKID</span>&gt;</span>4326<span class="tag">&lt;/<span class="name">WKID</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">SpatialReference</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TileOrigin</span> <span class="attr">xsi:type</span>=<span class="string">'typens:PointN'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">X</span>&gt;</span>-180.0<span class="tag">&lt;/<span class="name">X</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Y</span>&gt;</span>90.0<span class="tag">&lt;/<span class="name">Y</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">TileOrigin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TileCols</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileCols</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TileRows</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileRows</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DPI</span>&gt;</span>96<span class="tag">&lt;/<span class="name">DPI</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PreciseDPI</span>&gt;</span>96<span class="tag">&lt;/<span class="name">PreciseDPI</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LODInfos</span> <span class="attr">xsi:type</span>=<span class="string">"typens:ArrayOfLODInfo"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>0<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>295828763.79585470937713011037<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.703125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>1<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>147914381.89792735468856505518<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.3515625<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>2<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>73957190.948963677344282527592<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.17578125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>3<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>36978595.474481838672141263796<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.087890625<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>4<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>18489297.737240919336070631898<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.0439453125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>5<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>9244648.868620459668035315949<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.02197265625<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>6<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>4622324.4343102298340176579745<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.010986328125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>7<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>2311162.2171551149170088289872<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.0054931640625<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>8<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>1155581.1085775574585044144937<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.00274658203125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>9<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>577790.55428877872925220724681<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.001373291015625<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>10<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>288895.27714438936462610362340<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.0006866455078125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>11<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>144447.63857219468231305181171<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.00034332275390625<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>12<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>72223.819286097341156525905853<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.000171661376953125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>13<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>36111.909643048670578262952926<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.0000858306884765625<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>14<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>18055.954821524335289131476463<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.00004291534423828125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>15<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>9027.977410762167644565738231<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.000021457672119140625<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>16<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>4513.9887053810838222828691158<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.0000107288360595703125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>17<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>2256.9943526905419111414345579<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.00000536441802978515625<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>18<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>1128.4971763452709555707172788<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.000002682209014892578125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>19<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>564.24858817263547778535863938<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.0000013411045074462890625<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>20<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>282.12429408631773889267931988<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.00000067055225372314453125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>21<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>141.06214704315886944633965975<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.000000335276126861572265625<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>22<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>70.531073521579434723169829875<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.0000001676380634307861328125<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LODInfos</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">TileCacheInfo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">TileImageInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:TileImageInfo'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CacheTileFormat</span>&gt;</span>PNG<span class="tag">&lt;/<span class="name">CacheTileFormat</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CompressionQuality</span>&gt;</span>0<span class="tag">&lt;/<span class="name">CompressionQuality</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Antialiasing</span>&gt;</span>false<span class="tag">&lt;/<span class="name">Antialiasing</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">TileImageInfo</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CacheInfo</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Esri-ArcGIS-Online-Bing-Maps-Google-Maps"><a href="#Esri-ArcGIS-Online-Bing-Maps-Google-Maps" class="headerlink" title="Esri-ArcGIS_Online_Bing_Maps_Google_Maps"></a>Esri-ArcGIS_Online_Bing_Maps_Google_Maps</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CacheInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:CacheInfo'</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">'http://www.w3.org/2001/XMLSchema-instance'</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xs</span>=<span class="string">'http://www.w3.org/2001/XMLSchema'</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:typens</span>=<span class="string">'http://www.esri.com/schemas/ArcGIS/9.3'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">TileCacheInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:TileCacheInfo'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SpatialReference</span> <span class="attr">xsi:type</span>=<span class="string">'typens:ProjectedCoordinateSystem'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">WKT</span>&gt;</span>PROJCS[<span class="symbol">&amp;quot;</span>WGS_1984_Web_Mercator_Auxiliary_Sphere<span class="symbol">&amp;quot;</span>,GEOGCS[<span class="symbol">&amp;quot;</span>GCS_WGS_1984<span class="symbol">&amp;quot;</span>,DATUM[<span class="symbol">&amp;quot;</span>D_WGS_1984<span class="symbol">&amp;quot;</span>,SPHEROID[<span class="symbol">&amp;quot;</span>WGS_1984<span class="symbol">&amp;quot;</span>,6378137.0,298.257223563]],PRIMEM[<span class="symbol">&amp;quot;</span>Greenwich<span class="symbol">&amp;quot;</span>,0.0],UNIT[<span class="symbol">&amp;quot;</span>Degree<span class="symbol">&amp;quot;</span>,0.0174532925199433]],PROJECTION[<span class="symbol">&amp;quot;</span>Mercator_Auxiliary_Sphere<span class="symbol">&amp;quot;</span>],PARAMETER[<span class="symbol">&amp;quot;</span>False_Easting<span class="symbol">&amp;quot;</span>,0.0],PARAMETER[<span class="symbol">&amp;quot;</span>False_Northing<span class="symbol">&amp;quot;</span>,0.0],PARAMETER[<span class="symbol">&amp;quot;</span>Central_Meridian<span class="symbol">&amp;quot;</span>,0.0],PARAMETER[<span class="symbol">&amp;quot;</span>Standard_Parallel_1<span class="symbol">&amp;quot;</span>,0.0],PARAMETER[<span class="symbol">&amp;quot;</span>Auxiliary_Sphere_Type<span class="symbol">&amp;quot;</span>,0.0],UNIT[<span class="symbol">&amp;quot;</span>Meter<span class="symbol">&amp;quot;</span>,1.0],AUTHORITY[<span class="symbol">&amp;quot;</span>EPSG<span class="symbol">&amp;quot;</span>,3857]]<span class="tag">&lt;/<span class="name">WKT</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">XOrigin</span>&gt;</span>-20037700<span class="tag">&lt;/<span class="name">XOrigin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">YOrigin</span>&gt;</span>-30241100<span class="tag">&lt;/<span class="name">YOrigin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">XYScale</span>&gt;</span>148923141.92838538<span class="tag">&lt;/<span class="name">XYScale</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ZOrigin</span>&gt;</span>-100000<span class="tag">&lt;/<span class="name">ZOrigin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ZScale</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">ZScale</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">MOrigin</span>&gt;</span>-100000<span class="tag">&lt;/<span class="name">MOrigin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">MScale</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">MScale</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">XYTolerance</span>&gt;</span>0.001<span class="tag">&lt;/<span class="name">XYTolerance</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ZTolerance</span>&gt;</span>0.001<span class="tag">&lt;/<span class="name">ZTolerance</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">MTolerance</span>&gt;</span>0.001<span class="tag">&lt;/<span class="name">MTolerance</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">HighPrecision</span>&gt;</span>true<span class="tag">&lt;/<span class="name">HighPrecision</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">WKID</span>&gt;</span>3857<span class="tag">&lt;/<span class="name">WKID</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">SpatialReference</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TileOrigin</span> <span class="attr">xsi:type</span>=<span class="string">'typens:PointN'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">X</span>&gt;</span>-20037508.342787<span class="tag">&lt;/<span class="name">X</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Y</span>&gt;</span>20037508.342787<span class="tag">&lt;/<span class="name">Y</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">TileOrigin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TileCols</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileCols</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TileRows</span>&gt;</span>256<span class="tag">&lt;/<span class="name">TileRows</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DPI</span>&gt;</span>96<span class="tag">&lt;/<span class="name">DPI</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LODInfos</span> <span class="attr">xsi:type</span>=<span class="string">'typens:ArrayOfLODInfo'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>0<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>591657527.591555<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>156543.033928<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>1<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>295828763.795777<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>78271.5169639999<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>2<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>147914381.897889<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>39135.7584820001<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>3<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>73957190.948944<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>19567.8792409999<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>4<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>36978595.474472<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>9783.93962049996<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>5<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>18489297.737236<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>4891.96981024998<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>6<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>9244648.868618<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>2445.98490512499<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>7<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>4622324.434309<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>1222.99245256249<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>8<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>2311162.217155<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>611.49622628138<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>9<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>1155581.108577<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>305.748113140558<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>10<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>577790.554289<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>152.874056570411<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>11<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>288895.277144<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>76.4370282850732<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>12<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>144447.638572<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>38.2185141425366<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>13<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>72223.819286<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>19.1092570712683<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>14<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>36111.909643<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>9.55462853563415<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>15<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>18055.954822<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>4.77731426794937<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>16<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>9027.977411<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>2.38865713397468<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>17<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>4513.988705<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>1.19432856685505<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>18<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>2256.994353<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.597164283559817<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>19<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>1128.497176<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.298582141647617<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>20<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>564.248588<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.14929107082380833<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>21<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>282.124294<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.07464553541190416<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>22<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>141.062147<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.03732276770595208<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LODInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:LODInfo'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LevelID</span>&gt;</span>23<span class="tag">&lt;/<span class="name">LevelID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>70.5310735<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resolution</span>&gt;</span>0.01866138385297604<span class="tag">&lt;/<span class="name">Resolution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">LODInfo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LODInfos</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">TileCacheInfo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">TileImageInfo</span> <span class="attr">xsi:type</span>=<span class="string">'typens:TileImageInfo'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CacheTileFormat</span>&gt;</span>PNG8<span class="tag">&lt;/<span class="name">CacheTileFormat</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CompressionQuality</span>&gt;</span>0<span class="tag">&lt;/<span class="name">CompressionQuality</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Antialiasing</span>&gt;</span>false<span class="tag">&lt;/<span class="name">Antialiasing</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">TileImageInfo</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CacheInfo</span>&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ArcGIS JS API</category>
      </categories>
      <tags>
        <tag>WMTS</tag>
        <tag>天地图</tag>
        <tag>TileInfo</tag>
        <tag>SpatialReference</tag>
        <tag>WKT</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx基础-3:反向代理</title>
    <url>/2020/06/03/Nginx%E5%9F%BA%E7%A1%80-3-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<p>反向代理，举个场景来说明什么是反向代理。</p>
<p>我向A服务器发请求，A服务拿到请求后，根据业务区分，把请求交给了C处理，C处理完后，给A，再由A返回给我结果。在我的视角中，我是不知道C的存在的。我始终只与A交流。</p>
<a id="more"></a>
<p>与正向代理区别的就是，</p>
<ul>
<li>正向代理为客户端服务</li>
<li>反向代理为服务端服务</li>
</ul>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx基础-4:负载均衡</title>
    <url>/2020/06/03/Nginx%E5%9F%BA%E7%A1%80-4-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/</url>
    <content><![CDATA[<p>负载均衡是为减轻单个服务器负担，将请求按照某种策略分发给多个服务器。</p>
<p>官方文档参考：<a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream" target="_blank" rel="noopener">http://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream</a></p>
<p>以2台Tomcat集群为例</p>
<a id="more"></a>
<h2 id="Tomcat配置"><a href="#Tomcat配置" class="headerlink" title="Tomcat配置"></a>Tomcat配置</h2><p>Tomcat下载地址：<a href="https://tomcat.apache.org/download-80.cgi" target="_blank" rel="noopener">https://tomcat.apache.org/download-80.cgi</a></p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/1568258710917.png" alt="1568258710917"></p>
<p>解压后修改<code>\tomcat\conf\</code>目录下的server.xml</p>
<p>修改<strong>所有的</strong>端口号，避免冲突</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">redirectPort</span>=<span class="string">"8443"</span> </span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>本例中，Tomcat A部署在<code>http://localhost:8080</code>，Tomcat B部署在<code>http://localhost:8082</code></p>
<p>分别在两个Tomcat下部署<code>tomcat\webapps\demo\load-balance.html</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"color: pink"</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>用颜色和文字区分两个Tomcat</p>
<h2 id="Nginx配置"><a href="#Nginx配置" class="headerlink" title="Nginx配置"></a>Nginx配置</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream tomcat &#123;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8082;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       8088;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    charset utf-8;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass   http:&#x2F;&#x2F;tomcat;</span><br><span class="line">        proxy_redirect default;</span><br><span class="line"></span><br><span class="line">        include proxy_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">    location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">        root   html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进入浏览器，用<code>http://localhost:8088/demo/load-balance.html</code>进行访问</p>
<p>F5刷新页面，会依次地访问到8080和8082上的Tomcat</p>
<h2 id="分发策略"><a href="#分发策略" class="headerlink" title="分发策略"></a>分发策略</h2><h3 id="1-轮询（默认）"><a href="#1-轮询（默认）" class="headerlink" title="1.轮询（默认）"></a>1.轮询（默认）</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream tomcat &#123;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8082;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按时间顺序，依次分发</p>
<h3 id="2-加权轮询"><a href="#2-加权轮询" class="headerlink" title="2.加权轮询"></a>2.加权轮询</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream tomcat &#123;</span><br><span class="line">    server localhost:8080 weight&#x3D;1;</span><br><span class="line">    server localhost:8082 weight&#x3D;10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>weight值与访问几率成正比</p>
<h3 id="3-ip-hash"><a href="#3-ip-hash" class="headerlink" title="3.ip_hash"></a>3.ip_hash</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream tomcat &#123;</span><br><span class="line">	ip_hash;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8082;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>考虑缓存的情况，保持会话</p>
<p>来自同一ip的请求会固定到一个server</p>
<h3 id="4-最小连接"><a href="#4-最小连接" class="headerlink" title="4.最小连接"></a>4.最小连接</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream tomcat &#123;</span><br><span class="line">	least_conn；</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8082;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据连接数来分发，起到均分的作用</p>
<h3 id="5-url-hash"><a href="#5-url-hash" class="headerlink" title="5.url_hash"></a>5.url_hash</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream tomcat &#123;</span><br><span class="line">	hash $request_url;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8082;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>来自同一url的请求会固定到一个server</p>
<h2 id="状态参数"><a href="#状态参数" class="headerlink" title="状态参数"></a>状态参数</h2><h3 id="1-down"><a href="#1-down" class="headerlink" title="1.down"></a>1.down</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream tomcat &#123;</span><br><span class="line">    server localhost:8080 down;</span><br><span class="line">    server localhost:8082;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当前server不参与负载均衡</p>
<h3 id="2-backup"><a href="#2-backup" class="headerlink" title="2.backup"></a>2.backup</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream tomcat &#123;</span><br><span class="line">    server localhost:8080 down;</span><br><span class="line">    server localhost:8082;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>预留的server，当有其他的server挂掉或者忙的时候，才会参与负载</p>
<h3 id="3-max-fails和fail-timeout"><a href="#3-max-fails和fail-timeout" class="headerlink" title="3.max_fails和fail_timeout"></a>3.max_fails和fail_timeout</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream tomcat &#123;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8082 max_fails&#x3D;3 fail_timeout&#x3D;30s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最大连接错误次数3次，每次失败后，间隔30s再重新发起连接</p>
<h3 id="4-max-conns"><a href="#4-max-conns" class="headerlink" title="4.max_conns"></a>4.max_conns</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream tomcat &#123;</span><br><span class="line">    server localhost:8080;</span><br><span class="line">    server localhost:8082 max_conns&#x3D;500;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>超过最大连接数后，就不参与负载</p>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx基础-2:正向代理</title>
    <url>/2020/06/03/Nginx%E5%9F%BA%E7%A1%80-2-%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<p>正向代理，简单来说，就是你想请求A，但是不能直接访问A，所以你托Nginx帮你请求A，再将请求的结果返回给你。一般用来处理跨域、翻墙等。</p>
<p>下面以处理跨域来举例。</p>
<a id="more"></a>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       8088;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    charset utf-8;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        root   html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">    location &#x2F;juhe&#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;v.juhe.cn&#x2F;;</span><br><span class="line">    &#125;</span><br><span class="line">    error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">    location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">        root   html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前端往<code>http://localhost:8088/juhe/</code>上发送的请求，都会代理到<code>http://v.juhe.cn/</code>上。根据API接口的地址往请求url上追加即可。</p>
<p>如：想请求<code>http://v.juhe.cn/weather/index</code>，则访问<code>http://localhost:8088/juhe/weather/index</code>。</p>
<h2 id="proxy-pass说明"><a href="#proxy-pass说明" class="headerlink" title="proxy_pass说明"></a>proxy_pass说明</h2><p>在NGINX中配置proxy_pass代理转发时，如果在proxy_pass后面的url加 / ，表示绝对根路径；如果没有 / ，表示相对路径，把匹配的路径部分也给代理。</p>
<p>下面举4种情况来说明，注意看proxy_pass中末尾有无 / 。</p>
<ol>
<li><p>访问地址：<code>http://localhost:8088/juhe/weather/index</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location &#x2F;juhe&#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;v.juhe.cn&#x2F;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>真实地址：<code>http://v.juhe.cn/</code>+<code>weather/index</code>=<code>http://v.juhe.cn/weather/index</code></p>
</li>
<li><p>访问地址：<code>http://localhost:8088/weather/index</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location &#x2F;weather&#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;v.juhe.cn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>真实地址：<code>http://v.juhe.cn</code>+<code>/weather/index</code>=<code>http://v.juhe.cn/weather/index</code></p>
</li>
<li><p>访问地址：<code>http://localhost:8088/juhe/index</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location &#x2F;juhe&#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;v.juhe.cn&#x2F;weather&#x2F;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>真实地址：<code>http://v.juhe.cn/weather/</code>+<code>index</code>=<code>http://v.juhe.cn/weather/index</code></p>
</li>
<li><p>访问地址：<code>http://localhost:8088/juhe/ther/index</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location &#x2F;juhe&#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;v.juhe.cn&#x2F;wea;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>真实地址：<code>http://v.juhe.cn/wea</code>+<code>ther/index</code>=<code>http://v.juhe.cn/weather/index</code></p>
</li>
</ol>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>参数都在ajax的data中，会自动带到地址的url中。</p>
<p>参数中如果有中文，可能需要编码或解码。</p>
<h2 id="请求示例"><a href="#请求示例" class="headerlink" title="请求示例"></a>请求示例</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    input &#123;</span><br><span class="line">      width: 400px;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"bindEvent()"</span>&gt;</span></span><br><span class="line">  url: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"http://localhost:8088/juhe/weather/index"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  key: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"key"</span> <span class="attr">value</span>=<span class="string">"b2cf66d157ca387b7b32455ce282427e"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  city: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"city"</span> <span class="attr">value</span>=<span class="string">"北京"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"get"</span>&gt;</span>get<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"post"</span>&gt;</span>post<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">"100"</span> <span class="attr">rows</span>=<span class="string">"50"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">bindEvent</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      $(<span class="string">"button"</span>).on(<span class="string">"click"</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> url = $(<span class="string">"#url"</span>).val();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> key = $(<span class="string">"#key"</span>).val();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> cityname = $(<span class="string">"#city"</span>).val();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> type = $(<span class="keyword">this</span>).attr(<span class="string">'id'</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> params = &#123;</span></span><br><span class="line">          key,</span><br><span class="line">          cityname</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> response = <span class="keyword">await</span> queryData(url, params, type);</span></span><br><span class="line">        printResponse(response);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">queryData</span>(<span class="params">url, params, type</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> $.ajax(&#123;</span></span><br><span class="line">        type,</span><br><span class="line">        data: params,</span><br><span class="line">        url: url,</span><br><span class="line"><span class="actionscript">        dataType: <span class="string">"json"</span></span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">printResponse</span><span class="params">(response)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      $(<span class="string">"textarea"</span>).val(<span class="built_in">JSON</span>.stringify(response, <span class="literal">null</span>, <span class="string">"  "</span>));</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Promise执行顺序</title>
    <url>/2020/09/23/Promise%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/</url>
    <content><![CDATA[<p>Promise的执行顺序会设计到JavaScript的事件循环。</p>
<p>找到一张图，来理解：</p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/eventloop-1600651261570.png" alt="eventloop"></p>
<a id="more"></a>
<ol>
<li>宏队列: 用来保存待执行的宏任务(回调), 比如: 定时器回调/DOM事件回调/ajax回调</li>
<li>微队列: 用来保存待执行的微任务(回调), 比如: promise的回调/MutationObserver的回调</li>
<li>JS执行时会区别这2个队列<br> JS引擎首先必须先执行所有的初始化同步任务代码<br> 每次准备取出第一个宏任务执行前, 都要将所有的微任务一个一个取出来执行</li>
</ol>
<p>下面列出一道试题：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Promise执行顺序<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    /*</span><br><span class="line">    同步 </span><br><span class="line">    宏: []</span><br><span class="line">    微: []</span><br><span class="line">    */</span><br><span class="line"><span class="javascript">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"0"</span>)</span></span><br><span class="line">    &#125;, 0)</span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"1"</span>)</span></span><br><span class="line">      resolve()</span><br><span class="line"><span class="javascript">    &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"2"</span>)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"3"</span>)</span></span><br><span class="line">        resolve()</span><br><span class="line"><span class="javascript">      &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"4"</span>)</span></span><br><span class="line"><span class="javascript">      &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"5"</span>)</span></span><br><span class="line">      &#125;)</span><br><span class="line"><span class="javascript">    &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"6"</span>)</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"7"</span>)</span></span><br><span class="line">      resolve()</span><br><span class="line"><span class="javascript">    &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"8"</span>)</span></span><br><span class="line">    &#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>判断思路：</p>
<p>先判断同步的代码，然后把异步的任务push到数组中。</p>
<p>同步代码的打印顺序就是真实的打印顺序。</p>
<p>当同步代码执行完毕后，执行宏任务，执行宏任务时，要先处理所有的微任务（也就是要保证微任务的数组是空的）。</p>
<p>在执行宏任务或微任务时，如果遇到新的异步任务，则push到对应的数组中。在数组中的任务是还未执行的，到移动到同步的数组中时，才是真正执行的时候。</p>
<p>过程：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 同步: [1, 7]</span></span><br><span class="line"><span class="comment">// 宏: [0]</span></span><br><span class="line"><span class="comment">// 微: [2, 8]</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 同步: [1, 7, 2, 3]</span></span><br><span class="line"><span class="comment">// 宏: [0]</span></span><br><span class="line"><span class="comment">// 微: [8, 4, 6]</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="comment">// 同步: [1, 7, 2, 3, 8]</span></span><br><span class="line"><span class="comment">// 宏: [0]</span></span><br><span class="line"><span class="comment">// 微: [4, 6]</span></span><br><span class="line"><span class="comment">// 4</span></span><br><span class="line"><span class="comment">// 同步: [1, 7, 2, 3, 8, 4]</span></span><br><span class="line"><span class="comment">// 宏: [0]</span></span><br><span class="line"><span class="comment">// 微: [6, 5]</span></span><br><span class="line"><span class="comment">// 5</span></span><br><span class="line"><span class="comment">// 同步: [1, 7, 2, 3, 8, 4, 6, 5]</span></span><br><span class="line"><span class="comment">// 宏: [0]</span></span><br><span class="line"><span class="comment">// 微: []</span></span><br><span class="line"><span class="comment">// 6</span></span><br><span class="line"><span class="comment">// 同步: [1, 7, 2, 3, 8, 4, 6, 5, 0]</span></span><br><span class="line"><span class="comment">// 宏: []</span></span><br><span class="line"><span class="comment">// 微: []</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>Promise</tag>
        <tag>ES6+</tag>
      </tags>
  </entry>
  <entry>
    <title>XML基础</title>
    <url>/2020/07/02/XML%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<p>在项目中，有时需要处理XML的数据，如WFS服务。</p>
<p>XML、HTML、XHTML，这三者长得太像了，所以按照一样的操作处理即可。</p>
<blockquote>
<p>XML，Extensible Markup Language，可扩展标记语言</p>
</blockquote>
<a id="more"></a>
<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> parser = <span class="keyword">new</span> DOMParser();</span><br><span class="line"><span class="keyword">const</span> xml = parser.parseFromString(response, <span class="string">'text/xml'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="获取节点"><a href="#获取节点" class="headerlink" title="获取节点"></a>获取节点</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> htmlCollection = xml.getElementsByTagName(<span class="string">'title'</span>);</span><br></pre></td></tr></table></figure>

<p>通过标签名，获取到指定标签名的所有元素的节点列表。</p>
<p>结果是一个htmlCollection对象，长的和数组一样，但是没有数组的许多方法。</p>
<h2 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h2><p>for循环，遍历htmlCollection对象，通过下标拿到节点。</p>
<p>通过<code>nodeValue</code>或<code>innerHTML</code>来获取其中的值。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = htmlCollection.length; i &lt; len; i++) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(htmlCollection[i].innerHTML);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>解析服务数据，上面的操作就够用了。当做HTML去操作就行了，没有特别深入的去了解。</p>
]]></content>
      <categories>
        <category>XML</category>
      </categories>
      <tags>
        <tag>XML</tag>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>border-left样式高度控制</title>
    <url>/2020/08/13/border-left%E6%A0%B7%E5%BC%8F%E9%AB%98%E5%BA%A6%E6%8E%A7%E5%88%B6/</url>
    <content><![CDATA[<p>有时候加个border-left，可以有分割的效果。</p>
<p>但是直接设置，高度顶满之后，感觉不好看。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.navbar-right</span> <span class="selector-class">.navbar-temperature</span> &#123;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="number">#FFF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20200813180118899.png" alt="image-20200813180118899"></p>
<p>所以通过before来插入一个元素，就可以控制高度，更好看些。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.navbar-right</span> <span class="selector-class">.navbar-temperature</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">' '</span>;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="number">#FFF</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20200813180155480.png" alt="image-20200813180155480"></p>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>border</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2020/06/03/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<a id="more"></a>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
      <categories>
        <category>Blog</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>ramda-curd</title>
    <url>/2020/09/14/ramda-curd/</url>
    <content><![CDATA[<h2 id="对象属性的增删改查"><a href="#对象属性的增删改查" class="headerlink" title="对象属性的增删改查"></a>对象属性的增删改查</h2><a id="more"></a>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>assoc / assocPath</strong></td>
<td>添加或者修改属性</td>
</tr>
<tr>
<td><strong>dissoc / dissocPath / omit</strong></td>
<td>删除属性</td>
</tr>
<tr>
<td><strong>evolve</strong></td>
<td>修改属性</td>
</tr>
<tr>
<td><strong>merge</strong></td>
<td>合并对象</td>
</tr>
<tr>
<td><strong>prop / pick / has / path / propOr / pathOr</strong></td>
<td>读取属性</td>
</tr>
<tr>
<td><strong>keys / values</strong></td>
<td>读取属性</td>
</tr>
</tbody></table>
<h2 id="数组的增删改查"><a href="#数组的增删改查" class="headerlink" title="数组的增删改查"></a>数组的增删改查</h2><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>nth / slice / contains</strong></td>
<td>读取元素</td>
</tr>
<tr>
<td><strong>insert / update</strong></td>
<td>添加或者修改元素</td>
</tr>
<tr>
<td><strong>append / prepend</strong></td>
<td>在数组头部或尾部添加元素</td>
</tr>
<tr>
<td><strong>concat</strong></td>
<td>合并数组</td>
</tr>
<tr>
<td><strong>remove</strong></td>
<td>删除元素</td>
</tr>
<tr>
<td><strong>adjust</strong></td>
<td>修改元素</td>
</tr>
</tbody></table>
<h2 id="透镜"><a href="#透镜" class="headerlink" title="透镜"></a>透镜</h2><p>创建透镜：</p>
<ul>
<li>lensProp：创建关注对象某一属性的透镜。</li>
<li>lensPath: 创建关注对象某一嵌套属性的透镜。</li>
<li>lensIndex: 创建关注数组某一索引的透镜。</li>
</ul>
<p>使用透镜：</p>
<ul>
<li>view：读取透镜的值。</li>
<li>set：更新透镜的值。</li>
<li>over：将变换函数作用于透镜。</li>
</ul>
]]></content>
      <categories>
        <category>Ramda</category>
      </categories>
      <tags>
        <tag>Ramda</tag>
      </tags>
  </entry>
  <entry>
    <title>umi学习大纲梳理</title>
    <url>/2020/10/09/umi%E5%AD%A6%E4%B9%A0%E5%A4%A7%E7%BA%B2%E6%A2%B3%E7%90%86/</url>
    <content><![CDATA[<h1 id="UmiJS"><a href="#UmiJS" class="headerlink" title="UmiJS"></a>UmiJS</h1><p><code>Umi</code>是可扩展的企业级前端应用框架。</p>
<p>链接：<a href="https://umijs.org/zh-CN/docs" target="_blank" rel="noopener">https://umijs.org/zh-CN/docs</a></p>
<a id="more"></a>
<h2 id="React"><a href="#React" class="headerlink" title="React"></a>React</h2><p><code>react</code>用于构建用户界面的 JavaScript 库。</p>
<p>链接：<a href="https://react.docschina.org/" target="_blank" rel="noopener">https://react.docschina.org/</a></p>
<h3 id="ahooks"><a href="#ahooks" class="headerlink" title="ahooks"></a>ahooks</h3><p>a hooks library</p>
<p>链接：<a href="https://ahooks.js.org/zh-CN" target="_blank" rel="noopener">https://ahooks.js.org/zh-CN</a></p>
<h2 id="DvaJS"><a href="#DvaJS" class="headerlink" title="DvaJS"></a>DvaJS</h2><p><code>dva</code>首先是一个基于 <code>redux</code>和<code>redux-saga</code> 的数据流方案，然后为了简化开发体验，<code>dva</code>还额外内置了 <code>react-router</code> 和 <code>fetch</code>，所以也可以理解为一个轻量级的应用框架。</p>
<p>链接：<a href="https://dvajs.com/" target="_blank" rel="noopener">https://dvajs.com/</a></p>
<h3 id="react-redux"><a href="#react-redux" class="headerlink" title="react-redux"></a>react-redux</h3><p><code>Redux</code> is a predictable state container for JavaScript apps.</p>
<p>全局状态</p>
<p>链接：<a href="https://redux.js.org/" target="_blank" rel="noopener">https://redux.js.org/</a></p>
<h3 id="redux-saga"><a href="#redux-saga" class="headerlink" title="redux-saga"></a>redux-saga</h3><p><code>redux-saga</code> 是一个用于管理应用程序 Side Effect（副作用，例如异步获取数据，访问浏览器缓存等）的 library，它的目标是让副作用管理更容易，执行更高效，测试更简单，在处理故障时更容易。</p>
<p>链接：<a href="https://redux-saga-in-chinese.js.org/" target="_blank" rel="noopener">https://redux-saga-in-chinese.js.org/</a></p>
<blockquote>
<p>历史中间产物，可以不用学</p>
</blockquote>
<h3 id="react-router"><a href="#react-router" class="headerlink" title="react-router"></a>react-router</h3><p>Declarative routing for React.</p>
<p><a href="https://reactrouter.com/web/guides/quick-start" target="_blank" rel="noopener">https://reactrouter.com/web/guides/quick-start</a></p>
<h3 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h3><p>A window.fetch JavaScript polyfill.</p>
<p>链接：<a href="https://github.com/github/fetch">https://github.com/github/fetch</a></p>
<h2 id="antd"><a href="#antd" class="headerlink" title="antd"></a>antd</h2><p><code>antd</code> 是基于 Ant Design 设计体系的 React UI 组件库，主要用于研发企业级中后台产品。</p>
<p>链接：<a href="https://ant.design/index-cn" target="_blank" rel="noopener">https://ant.design/index-cn</a></p>
<h3 id="less"><a href="#less" class="headerlink" title="less"></a>less</h3><p><code>Less</code>是一门 CSS 预处理语言，它扩展了 CSS 语言，增加了变量、Mixin、函数等特性，使 CSS 更易维护和扩展。</p>
<p>链接：<a href="http://lesscss.cn/" target="_blank" rel="noopener">http://lesscss.cn/</a></p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>umi</tag>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot下的增删改查</title>
    <url>/2020/07/03/SpringBoot%E4%B8%8B%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/</url>
    <content><![CDATA[<p>实习的时候，需要临时写点后端代码，实现最基础的增删改查。</p>
<p>在已有的项目框架（Spring Boot）中，观察其他模块的实现，发现需要7个文件。</p>
<p>热心的同事还专门电话给我讲解spring的目录结构和层级关系。</p>
<p>整理记录一下，下次需要写的时候，就直接凑7文件了【狗头】。</p>
<a id="more"></a>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">src&#x2F;main</span><br><span class="line">├──  java&#x2F;com.geodaoyu</span><br><span class="line">|    ├──  manager</span><br><span class="line">|    |    ├──  data&#x2F;model&#x2F;MsgDialog.java</span><br><span class="line">|    |    ├──  mapper&#x2F;MsgDialogMapper.java</span><br><span class="line">|    |    ├──  filter&#x2F;MsgDialogFilter.java</span><br><span class="line">|    |    └──  service</span><br><span class="line">|    |         ├──  impls&#x2F;MsgDialogServiceImpl.java</span><br><span class="line">|    |         └──  MsgDialogService.java</span><br><span class="line">|    └──  webcontroller&#x2F;PortalManagerController.java</span><br><span class="line">└──  resources&#x2F;mapper</span><br><span class="line">     └──  MsgDialogMapper.xml</span><br></pre></td></tr></table></figure>

<h2 id="层级关系"><a href="#层级关系" class="headerlink" title="层级关系"></a>层级关系</h2><ul>
<li>model层，数据库实体层，定义实体</li>
<li>dao层，数据持久层，访问数据库，向数据库发送sql语句</li>
<li>service层，业务逻辑层</li>
<li>controller层，控制层</li>
</ul>
<h2 id="model"><a href="#model" class="headerlink" title="model"></a>model</h2><p>相对路径：<code>com/geodaoyu/manager/data/model/MsgDialog.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.geodaoyu.manager.data.model;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@descript</span>: 消息提醒Model类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: zhanggy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/08/21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsgDialog</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String msgId; <span class="comment">//消息唯一标识标识</span></span><br><span class="line">    <span class="keyword">private</span> String sender; <span class="comment">//发送人</span></span><br><span class="line">    <span class="keyword">private</span> String receiver; <span class="comment">//接收人</span></span><br><span class="line">    <span class="keyword">private</span> String sendTime; <span class="comment">//发送时间</span></span><br><span class="line">    <span class="keyword">private</span> String content; <span class="comment">//发送内容</span></span><br><span class="line">    <span class="keyword">private</span> String state;  <span class="comment">//消息状态</span></span><br><span class="line">    <span class="keyword">private</span> String readTime; <span class="comment">//查看时间</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsgId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msgId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsgId</span><span class="params">(String msgId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msgId = msgId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>IntelliJ IDEA 可以使用快捷键<code>ALT</code>+<code>INSERT</code>生成get和set。</p>
</blockquote>
<h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><p>相对路径：<code>com/geodaoyu/manager/filter/MsgDialogFilter.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.geodaoyu.manager.filter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@descript</span>: 消息提醒过滤类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: zhanggy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/08/21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsgDialogFilter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String msgId; <span class="comment">//消息唯一标识标识</span></span><br><span class="line">    <span class="keyword">private</span> String receiver; <span class="comment">//接收人</span></span><br><span class="line">    <span class="keyword">private</span> String sendTime; <span class="comment">//发送时间</span></span><br><span class="line">    <span class="keyword">private</span> String content; <span class="comment">//发送内容</span></span><br><span class="line">    <span class="keyword">private</span> String state;  <span class="comment">//消息状态</span></span><br><span class="line">    <span class="keyword">private</span> String readTime; <span class="comment">//查看时间</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> startIndex; <span class="comment">//起始索引</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> endIndex; <span class="comment">//终止索引</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContent</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="model-mapper"><a href="#model-mapper" class="headerlink" title="model mapper"></a>model mapper</h2><p>相对路径：<code>com/geodaoyu/manager/data/mapper/MsgDialogMapper.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.geodaoyu.manager.data.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.geodaoyu.manager.data.model.MsgDialog;</span><br><span class="line"><span class="keyword">import</span> com.geodaoyu.manager.filter.MsgDialogFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MsgDialogMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertMsg</span><span class="params">(MsgDialog msgDialog)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertMsgs</span><span class="params">(List&lt;MsgDialog&gt; msgDialogs)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteMsg</span><span class="params">(MsgDialog msgDialog)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateMsg</span><span class="params">(MsgDialog msgDialog)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateMsgs</span><span class="params">(MsgDialog msgDialog)</span></span>;</span><br><span class="line">    <span class="function">List&lt;MsgDialog&gt; <span class="title">selectMsgsByFilter</span><span class="params">(MsgDialogFilter filter)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">selectMsgsCountByFilter</span><span class="params">(MsgDialogFilter filter)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><p>相对路径：<code>com/geodaoyu/manager/service/MsgDialogService.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.geodaoyu.manager.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.geodaoyu.manager.data.model.MsgDialog;</span><br><span class="line"><span class="keyword">import</span> com.geodaoyu.manager.filter.MsgDialogFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MsgDialogService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertMsg</span><span class="params">(MsgDialog msgDialog)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertMsgs</span><span class="params">(List&lt;MsgDialog&gt; msgDialogs)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteMsg</span><span class="params">(MsgDialog msgDialog)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateMsg</span><span class="params">(MsgDialog msgDialog)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateMsgs</span><span class="params">(MsgDialog msgDialog)</span></span>;</span><br><span class="line">    <span class="function">List&lt;MsgDialog&gt; <span class="title">selectMsgsByFilter</span><span class="params">(MsgDialogFilter filter)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">selectMsgsCountByFilter</span><span class="params">(MsgDialogFilter filter)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="impl"><a href="#impl" class="headerlink" title="impl"></a>impl</h2><p>相对路径：<code>com/geodaoyu/manager/service/impls/MsgDialogServiceImpl.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.geodaoyu.manager.service.impls;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.geodaoyu.manager.data.mapper.MsgDialogMapper;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@descript</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: zhanggy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2018/08/21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span>(value = <span class="string">"MsgDialogService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsgDialogServiceImpl</span> <span class="keyword">implements</span> <span class="title">MsgDialogService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MsgDialogMapper msgDialogMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    插入单条消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertMsg</span><span class="params">(MsgDialog msgDialog)</span> </span>&#123;</span><br><span class="line">        msgDialog.setMsgId(UUID.randomUUID().toString());</span><br><span class="line">        MsgHandler msgHandler = <span class="keyword">new</span> MsgHandler();</span><br><span class="line">        msgHandler.sendMsg(msgDialog.getReceiver(), <span class="keyword">new</span> TextMessage(<span class="string">"message"</span>));</span><br><span class="line">        <span class="keyword">return</span> msgDialogMapper.insertMsg(msgDialog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    批量插入消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertMsgs</span><span class="params">(List&lt;MsgDialog&gt; msgDialogs)</span> </span>&#123;</span><br><span class="line">        MsgDialog msgDialog =  msgDialogs.get(<span class="number">0</span>);</span><br><span class="line">        MsgHandler msgHandler = <span class="keyword">new</span> MsgHandler();</span><br><span class="line">        msgHandler.sendMsg(msgDialog.getReceiver(), <span class="keyword">new</span> TextMessage(<span class="string">"message"</span>));</span><br><span class="line">        <span class="keyword">return</span> msgDialogMapper.insertMsgs(msgDialogs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    根据MSGID删除消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteMsg</span><span class="params">(MsgDialog msgDialog)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msgDialogMapper.deleteMsg(msgDialog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    更改消息状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateMsg</span><span class="params">(MsgDialog msgDialog)</span> </span>&#123;</span><br><span class="line">        msgDialog.setState(<span class="string">"已读"</span>);</span><br><span class="line">        msgDialog.setReadTime(NowTime.GetTimeString2());</span><br><span class="line">        <span class="keyword">return</span> msgDialogMapper.updateMsg(msgDialog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    批量将所有未读更改为已读</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateMsgs</span><span class="params">(MsgDialog msgDialog)</span> </span>&#123;</span><br><span class="line">        msgDialog.setState(<span class="string">"已读"</span>);</span><br><span class="line">        msgDialog.setReadTime(NowTime.GetTimeString2());</span><br><span class="line">        <span class="keyword">return</span> msgDialogMapper.updateMsgs(msgDialog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    根据接收者查询消息，按时间倒序排列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;MsgDialog&gt; <span class="title">selectMsgsByFilter</span><span class="params">(MsgDialogFilter filter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msgDialogMapper.selectMsgsByFilter(filter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    查询消息数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">selectMsgsCountByFilter</span><span class="params">(MsgDialogFilter filter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msgDialogMapper.selectMsgsCountByFilter(filter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="dao"><a href="#dao" class="headerlink" title="dao"></a>dao</h2><p>相对路径：<code>mapper/MsgDialogMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.geodaoyu.manager.data.mapper.MsgDialogMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"com.geodaoyu.manager.data.model.MsgDialog"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"msgId"</span> <span class="attr">column</span>=<span class="string">"MSGID"</span>  <span class="attr">javaType</span>=<span class="string">"java.lang.String"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sender"</span> <span class="attr">column</span>=<span class="string">"SENDER"</span> <span class="attr">javaType</span>=<span class="string">"java.lang.String"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"receiver"</span> <span class="attr">column</span>=<span class="string">"RECEIVER"</span> <span class="attr">javaType</span>=<span class="string">"java.lang.String"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sendTime"</span> <span class="attr">column</span>=<span class="string">"SENDTIME"</span> <span class="attr">javaType</span>=<span class="string">"java.lang.String"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"content"</span> <span class="attr">column</span>=<span class="string">"CONTENT"</span> <span class="attr">javaType</span>=<span class="string">"java.lang.String"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"state"</span> <span class="attr">column</span>=<span class="string">"STATE"</span> <span class="attr">javaType</span>=<span class="string">"java.lang.String"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"readTime"</span> <span class="attr">column</span>=<span class="string">"READTIME"</span> <span class="attr">javaType</span>=<span class="string">"java.lang.String"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertMsg"</span> <span class="attr">parameterType</span>=<span class="string">"com.geodaoyu.manager.data.model.MsgDialog"</span>&gt;</span></span><br><span class="line">        INSERT INTO</span><br><span class="line">        w_message</span><br><span class="line">        (</span><br><span class="line">          MSGID,SENDER,RECEIVER,SENDTIME,CONTENT,STATE,READTIME</span><br><span class="line">        )</span><br><span class="line">        VALUES</span><br><span class="line">        (</span><br><span class="line">        #&#123;msgId,jdbcType=VARCHAR&#125;,</span><br><span class="line">        #&#123;sender,jdbcType=VARCHAR&#125;,</span><br><span class="line">        #&#123;receiver,jdbcType=VARCHAR&#125;,</span><br><span class="line">        #&#123;sendTime,jdbcType=VARCHAR&#125;,</span><br><span class="line">        #&#123;content,jdbcType=VARCHAR&#125;,</span><br><span class="line">        #&#123;state,jdbcType=VARCHAR&#125;,</span><br><span class="line">        #&#123;readTime,jdbcType=VARCHAR&#125;</span><br><span class="line">        )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertMsgs"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.List"</span> &gt;</span></span><br><span class="line">        INSERT ALL</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">separator</span>=<span class="string">"  "</span>&gt;</span></span><br><span class="line">            INTO</span><br><span class="line">            w_message</span><br><span class="line">            (</span><br><span class="line">            MSGID,SENDER,RECEIVER,SENDTIME,CONTENT,STATE,READTIME</span><br><span class="line">            )</span><br><span class="line">            VALUES</span><br><span class="line">            (</span><br><span class="line">            #&#123;item.msgId,jdbcType=VARCHAR&#125;,</span><br><span class="line">            #&#123;item.sender,jdbcType=VARCHAR&#125;,</span><br><span class="line">            #&#123;item.receiver,jdbcType=VARCHAR&#125;,</span><br><span class="line">            #&#123;item.sendTime,jdbcType=VARCHAR&#125;,</span><br><span class="line">            #&#123;item.content,jdbcType=VARCHAR&#125;,</span><br><span class="line">            #&#123;item.state,jdbcType=VARCHAR&#125;,</span><br><span class="line">            #&#123;item.readTime,jdbcType=VARCHAR&#125;,</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        select * from dual</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteMsg"</span> <span class="attr">parameterType</span>=<span class="string">"com.geodaoyu.manager.data.model.MsgDialog"</span>&gt;</span></span><br><span class="line">        DELETE FROM</span><br><span class="line">          w_message</span><br><span class="line">        WHERE</span><br><span class="line">          MSGID=#&#123;msgId,jdbcType=VARCHAR&#125;</span><br><span class="line">     <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateMsg"</span> <span class="attr">parameterType</span>=<span class="string">"com.geodaoyu.manager.data.model.MsgDialog"</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">          w_message</span><br><span class="line">        SET</span><br><span class="line">          STATE=#&#123;state,jdbcType=VARCHAR&#125;,</span><br><span class="line">          READTIME=#&#123;readTime,jdbcType=VARCHAR&#125;</span><br><span class="line">        WHERE</span><br><span class="line">          MSGID=#&#123;msgId,jdbcType=VARCHAR&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateMsgs"</span> <span class="attr">parameterType</span>=<span class="string">"com.geodaoyu.manager.data.model.MsgDialog"</span>&gt;</span></span><br><span class="line">    UPDATE</span><br><span class="line">      w_message</span><br><span class="line">    SET</span><br><span class="line">      STATE='已读',</span><br><span class="line">      READTIME=#&#123;readTime,jdbcType=VARCHAR&#125;</span><br><span class="line">    WHERE</span><br><span class="line">      RECEIVER=#&#123;receiver,jdbcType=VARCHAR&#125;</span><br><span class="line">      AND</span><br><span class="line">      STATE='未读'</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectMsgsByFilter"</span> <span class="attr">parameterType</span>=<span class="string">"com.geodaoyu.manager.filter.MsgDialogFilter"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">        SELECT * FROM</span><br><span class="line">        (</span><br><span class="line">        SELECT r.*,ROWNUM oracleRN FROM</span><br><span class="line">        (</span><br><span class="line">        SELECT t.* FROM w_message t</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"receiver != null and receiver != ''"</span>&gt;</span></span><br><span class="line">                AND t.RECEIVER = #&#123;receiver,jdbcType=VARCHAR&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"state != null and state != ''"</span>&gt;</span></span><br><span class="line">                AND t.STATE  = #&#123;state,jdbcType=VARCHAR&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"content != null and content != ''"</span>&gt;</span></span><br><span class="line">                AND t.CONTENT LIKE CONCAT('%',CONCAT(#&#123;content&#125;,'%'))</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        ORDER BY STATE DESC, SENDTIME DESC</span><br><span class="line">        ) r</span><br><span class="line">        )</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"startIndex != null and startIndex <span class="symbol">&amp;gt;</span> 0"</span> &gt;</span></span><br><span class="line">                AND oracleRN <span class="symbol">&amp;gt;</span>= $&#123;startIndex&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"endIndex != null and endIndex <span class="symbol">&amp;gt;</span> 0"</span> &gt;</span></span><br><span class="line">                AND oracleRN <span class="symbol">&amp;lt;</span>= $&#123;endIndex&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectMsgsCountByFilter"</span> <span class="attr">parameterType</span>=<span class="string">"com.geodaoyu.manager.filter.MsgDialogFilter"</span> <span class="attr">resultType</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">        COUNT(*)</span><br><span class="line">        FROM</span><br><span class="line">        w_message t</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"receiver != null and receiver != ''"</span>&gt;</span></span><br><span class="line">                AND t.RECEIVER = #&#123;receiver,jdbcType=VARCHAR&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"state != null and state != ''"</span>&gt;</span></span><br><span class="line">                AND t.STATE  = #&#123;state,jdbcType=VARCHAR&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"content != null and content != ''"</span>&gt;</span></span><br><span class="line">                AND t.CONTENT LIKE CONCAT('%',CONCAT(#&#123;content&#125;,'%'))</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：oracle和pg的分页查询写法不同</p>
</blockquote>
<h2 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h2><p>相对路径：<code>com/geodaoyu/webcontroller/MsgDialogController.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.geodaoyu.webcontroller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.geodaoyu.manager.data.model.MsgDialog;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api</span>(value=<span class="string">"/msgDialog"</span>, description = <span class="string">"消息接口"</span>)</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/msgDialog"</span>)</span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsgDialogController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MsgDialogService msgDialogService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LogService logService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/insertMsg"</span>, method = RequestMethod.POST, produces = <span class="string">"application/json; charset=utf-8"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"添加消息"</span>,notes = <span class="string">"添加消息"</span>)</span><br><span class="line">    <span class="meta">@ApiImplicitParam</span>(name = <span class="string">"msgDialog"</span>, value = <span class="string">"MsgDialog 模型"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">insertMsgDialog</span><span class="params">(@RequestBody MsgDialog msgDialog)</span> </span>&#123;</span><br><span class="line">        Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">        <span class="keyword">int</span> insertMsg = msgDialogService.insertMsg(msgDialog);</span><br><span class="line">        map.put(<span class="string">"insert"</span>, insertMsg);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/deleteMsg"</span>, method = RequestMethod.POST, produces = <span class="string">"application/json; charset=utf-8"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"删除消息"</span>,notes = <span class="string">"删除消息"</span>)</span><br><span class="line">    <span class="meta">@ApiImplicitParam</span>(name = <span class="string">"msgDialog"</span>, value = <span class="string">"MsgDialog 模型"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">deleteMsgDialog</span><span class="params">(@RequestBody MsgDialog msgDialog)</span> </span>&#123;</span><br><span class="line">        Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">        <span class="keyword">int</span> deleteMsg = msgDialogService.deleteMsg(msgDialog);</span><br><span class="line">        map.put(<span class="string">"delete"</span>, deleteMsg);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/updateMsg"</span>, method = RequestMethod.POST, produces = <span class="string">"application/json; charset=utf-8"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"更改消息状态"</span>,notes = <span class="string">"更改消息状态"</span>)</span><br><span class="line">    <span class="meta">@ApiImplicitParam</span>(name = <span class="string">"msgDialog"</span>, value = <span class="string">"MsgDialog 模型"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">updateMsgDialog</span><span class="params">(@RequestBody MsgDialog msgDialog)</span> </span>&#123;</span><br><span class="line">        Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">        <span class="keyword">int</span> updateMsg = msgDialogService.updateMsg(msgDialog);</span><br><span class="line">        map.put(<span class="string">"update"</span>, updateMsg);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/updateMsgs"</span>, method = RequestMethod.POST, produces = <span class="string">"application/json; charset=utf-8"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"批量更改消息状态"</span>,notes = <span class="string">"批量更改消息状态"</span>)</span><br><span class="line">    <span class="meta">@ApiImplicitParam</span>(name = <span class="string">"msgDialog"</span>, value = <span class="string">"MsgDialog 模型"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">updateMsgDialogs</span><span class="params">(@RequestBody MsgDialog msgDialog)</span> </span>&#123;</span><br><span class="line">        Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">        <span class="keyword">int</span> updateMsgs = msgDialogService.updateMsgs(msgDialog);</span><br><span class="line">        map.put(<span class="string">"update"</span>, updateMsgs);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/select"</span>, method = RequestMethod.POST, produces = <span class="string">"application/json; charset=utf-8"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"按条件查询消息"</span>,notes = <span class="string">"按条件查询消息"</span>)</span><br><span class="line">    <span class="meta">@ApiImplicitParam</span>(name = <span class="string">"msgDialogFilter"</span>, value = <span class="string">"msgDialogFilter 模型"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">selectMsgsByFilter</span><span class="params">(@RequestBody MsgDialogFilter msgDialogFilter)</span> </span>&#123;</span><br><span class="line">        Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">        List&lt;MsgDialog&gt; pageData = msgDialogService.selectMsgsByFilter(msgDialogFilter);</span><br><span class="line">        map.put(<span class="string">"pageData"</span>, pageData);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/selectCount"</span>, method = RequestMethod.POST, produces = <span class="string">"application/json; charset=utf-8"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"按条件查询消息数量"</span>,notes = <span class="string">"按条件查询消息数量"</span>)</span><br><span class="line">    <span class="meta">@ApiImplicitParam</span>(name = <span class="string">"msgDialogFilter"</span>, value = <span class="string">"msgDialogFilter 模型"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">selectMsgsCountByFilter</span><span class="params">(@RequestBody MsgDialogFilter msgDialogFilter)</span> </span>&#123;</span><br><span class="line">        Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">        <span class="keyword">int</span> count = msgDialogService.selectMsgsCountByFilter(msgDialogFilter);</span><br><span class="line">        map.put(<span class="string">"count"</span>, count);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring Boot</tag>
      </tags>
  </entry>
  <entry>
    <title>个人博客搭建</title>
    <url>/2020/06/02/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<p>在GitHub上搭建一个个人博客，作为笔记日志的存放。</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li>OS: windows10</li>
<li>Node: &gt;=10.0.0</li>
<li>Git: &gt;=2.17.1</li>
</ul>
<h2 id="工具-平台"><a href="#工具-平台" class="headerlink" title="工具/平台"></a>工具/平台</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">GitHub  -- 博客</span><br><span class="line">Hexo    -- 博客框架</span><br><span class="line">NexT    -- 博客主题</span><br><span class="line">gitee   -- 图床</span><br><span class="line">PicGo   -- 图片上传管理</span><br><span class="line">Typora  -- 编辑器</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h3><ol>
<li><p>注册账号</p>
</li>
<li><p>新建仓库<br>名称格式：username.github.io<br>这也是博客的访问地址。</p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20200530104727936.png" alt="image-20200531202258405"></p>
</li>
</ol>
<h3 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h3><ol>
<li><p>安装Hexo脚手架并创建项目</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br><span class="line">hexo init blog</span><br><span class="line">cd blog</span><br><span class="line">npm intall</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<strong>站点配置文件</strong><br>编辑根目录下<code>_config.yml</code>文件，包括Site、URL、Deployment等。</p>
</li>
<li><p>常用命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo init [folder]               # 新建网站</span><br><span class="line">hexo new [layout] &lt;title&gt;        # 新建文章</span><br><span class="line">hexo generate                    # 生成静态文件</span><br><span class="line">hexo server                      # 启动服务</span><br><span class="line">hexo deploy                      # 部署网站</span><br><span class="line">hexo clean                       # 清除缓存文件和静态文件</span><br></pre></td></tr></table></figure>
</li>
<li><p>部署到GitHub<br> 站点配置文件的Deployment如下配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"> <span class="comment"># Deployment</span></span><br><span class="line"> <span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"> <span class="attr">deploy:</span></span><br><span class="line">   <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">   <span class="attr">repo:</span> <span class="string">https://github.com/GeoDaoyu/GeoDaoyu.github.io.git</span></span><br><span class="line"><span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>

<p>命令行输入命令进行推送部署：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure>



</li>
</ol>
<blockquote>
<p>注：如报错无法加载hexo.psl文件，修改windows的设置，允许powershell脚本在未签名的情况下运行即可。</p>
</blockquote>
<h3 id="NexT"><a href="#NexT" class="headerlink" title="NexT"></a>NexT</h3><ol>
<li><p>下载并启用主题</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd blog</span><br><span class="line">git clone https://github.com/iissnan/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>

<p>打开<strong>站点配置文件</strong>， 找到 <code>theme</code> 字段，并将其值更改为 <code>next</code>。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">theme:</span> <span class="string">next</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>设定主题</p>
<ul>
<li>选择Scheme</li>
<li>设置语音</li>
<li>设置菜单</li>
<li>……</li>
</ul>
</li>
</ol>
<h3 id="gitee"><a href="#gitee" class="headerlink" title="gitee"></a>gitee</h3><ol>
<li>注册账号</li>
<li>新建仓库<br>名称随意，仓库作为图床使用。</li>
<li>获取token</li>
</ol>
<h3 id="PicGo"><a href="#PicGo" class="headerlink" title="PicGo"></a>PicGo</h3><ol>
<li><p>下载安装</p>
</li>
<li><p>配置图床<br>在<strong>插件设置</strong>中搜索gitee，然后下载安装。<br><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20200531202258405.png" alt="image-20200531202258405"></p>
<p>在<strong>图床设置</strong>中设置参数，</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">owner:</span> <span class="string">gitee的用户名</span></span><br><span class="line"><span class="attr">repo:</span> <span class="string">项目名称</span></span><br><span class="line"><span class="attr">path:</span> <span class="string">项目下的路径</span></span><br><span class="line"><span class="attr">token:</span> <span class="string">gitee的token</span></span><br><span class="line"><span class="attr">message:</span> <span class="string">代码提交的说明，随意填写</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20200531202442036.png" alt="image-20200531202442036"></p>
</li>
</ol>
<h3 id="Typora"><a href="#Typora" class="headerlink" title="Typora"></a>Typora</h3><ol>
<li><p>下载安装</p>
</li>
<li><p>配置图片上传<br><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20200531212036484.png" alt="image-20200531212036484"></p>
<p>复制一份到本地，然后手动点击上传的时候再上传。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Blog</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>PicGo</tag>
        <tag>Typora</tag>
      </tags>
  </entry>
  <entry>
    <title>WebSocket在SpringBoot下的实践</title>
    <url>/2020/06/10/WebSocket%E5%9C%A8SpringBoot%E4%B8%8B%E7%9A%84%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<p>项目中有消息推送的需求，就用到了WebSocket。</p>
<p>先在<a href="https://www.runoob.com/html/html5-websocket.html" target="_blank" rel="noopener">菜鸟教程</a>上抄一段介绍：</p>
<blockquote>
<p>WebSocket 是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。</p>
<p>WebSocket 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 WebSocket API 中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。</p>
</blockquote>
<a id="more"></a>
<blockquote>
<p>在 WebSocket API 中，浏览器和服务器只需要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。</p>
<p>现在，很多网站为了实现推送技术，所用的技术都是 Ajax 轮询。轮询是在特定的的时间间隔（如每1秒），由浏览器对服务器发出HTTP请求，然后由服务器返回最新的数据给客户端的浏览器。这种传统的模式带来很明显的缺点，即浏览器需要不断的向服务器发出请求，然而HTTP请求可能包含较长的头部，其中真正有效的数据可能只是很小的一部分，显然这样会浪费很多的带宽等资源。</p>
<p>HTML5 定义的 WebSocket 协议，能更好的节省服务器资源和带宽，并且能够更实时地进行通讯。</p>
</blockquote>
<p>后台是用的Spring Boot，Java我不会，网上的文章、例子也看不懂，最后找了个视频教程<a href="https://ke.qq.com/course/315308" target="_blank" rel="noopener">千锋微信公众号和微信支付入门视频</a>，边看边照着打，实现得功能。</p>
<p>把带注释的示例代码记录下来，避免下次使用。</p>
<h2 id="依赖：pom-xml"><a href="#依赖：pom-xml" class="headerlink" title="依赖：pom.xml"></a>依赖：pom.xml</h2><p>在Spring Boot框架下使用WebSocket实现消息推送，首先在pom.xml中加入依赖。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- webSocket 开始--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.websocket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.websocket-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- webSocket 结束--&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置类：WebSocketConfig-java"><a href="#配置类：WebSocketConfig-java" class="headerlink" title="配置类：WebSocketConfig.java"></a>配置类：WebSocketConfig.java</h2><p>接着我们新建一个配置类，去注册我们的WebSocket。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSockectConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册websocket</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> webSocketHandlerRegistry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry webSocketHandlerRegistry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * webSocketHandler:处理器</span></span><br><span class="line"><span class="comment">         * stings:websocket访问路径</span></span><br><span class="line"><span class="comment">         * addInterceptors:拦截器,给session加标记</span></span><br><span class="line"><span class="comment">         * setAllowedOrigins:设置允许访问的来源，url</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        webSocketHandlerRegistry.addHandler(<span class="keyword">new</span> MsgHandler(),<span class="string">"/websocket/*"</span>).addInterceptors(<span class="keyword">new</span> MsgInterceptor()).setAllowedOrigins(<span class="string">"*"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="拦截器类：MsgInterceptor-java"><a href="#拦截器类：MsgInterceptor-java" class="headerlink" title="拦截器类：MsgInterceptor.java"></a>拦截器类：MsgInterceptor.java</h2><p>思路是将前端传过来的ws://websocket/{username}先拦截下来，通过username来确定与谁建立连接。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.server.support.HttpSessionHandshakeInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsgInterceptor</span> <span class="keyword">extends</span> <span class="title">HttpSessionHandshakeInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">beforeHandshake</span><span class="params">(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Map&lt;String, Object&gt; attributes)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String url = request.getURI().toString();</span><br><span class="line">        String username =  url.substring(url.lastIndexOf(<span class="string">"/"</span>) + <span class="number">1</span>);</span><br><span class="line">        attributes.put(<span class="string">"username"</span>, username);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.beforeHandshake(request, response, wsHandler, attributes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterHandshake</span><span class="params">(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Exception ex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.afterHandshake(request, response, wsHandler, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="处理器类：MsgHandler-java"><a href="#处理器类：MsgHandler-java" class="headerlink" title="处理器类：MsgHandler.java"></a>处理器类：MsgHandler.java</h2><p>处理器中主要应为与业务相关的代码，此处简单作为示例，将收到的消息传给接收者</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> net.sf.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.CloseStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.TextMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.handler.TextWebSocketHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsgHandler</span> <span class="keyword">extends</span> <span class="title">TextWebSocketHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建key是username，value是session的哈希表，用来查找username对应的session</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,WebSocketSession&gt; allClient = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 建立连接触发</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String username = (String) session.getAttributes().get(<span class="string">"username"</span>);</span><br><span class="line">        <span class="keyword">if</span> (username != <span class="keyword">null</span>) &#123;</span><br><span class="line">            allClient.put(username, session);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 收到消息触发</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handleTextMessage</span><span class="params">(WebSocketSession session, TextMessage message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        JSONObject jsonObject = JSONObject.fromObject(<span class="keyword">new</span> String(message.asBytes()));</span><br><span class="line">        String to = jsonObject.getString(<span class="string">"toUser"</span>);</span><br><span class="line">        String toMessage = jsonObject.getString(<span class="string">"toMessage"</span>);</span><br><span class="line">        String formUser = (String) session.getAttributes().get(<span class="string">"username"</span>);</span><br><span class="line">        String content = <span class="string">"来自"</span>+formUser+<span class="string">"的内容："</span>+toMessage;</span><br><span class="line">        TextMessage toTextMessage = <span class="keyword">new</span> TextMessage(content);</span><br><span class="line">        sendMsg(to, toTextMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 断开连接触发</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus status)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.afterConnectionClosed(session, status);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封装的发送消息方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> toUser</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">(String toUser, TextMessage message)</span> </span>&#123;</span><br><span class="line">        WebSocketSession session = allClient.get(toUser);</span><br><span class="line">        <span class="keyword">if</span> (session != <span class="keyword">null</span> &amp;&amp; session.isOpen()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                session.sendMessage(message);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试页面：Msg-html"><a href="#测试页面：Msg-html" class="headerlink" title="测试页面：Msg.html"></a>测试页面：Msg.html</h2><p>我们需要一个简单的页面去测试是否能推送消息。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>msg<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> websocket = <span class="literal">null</span>;</span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">connection</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> username = <span class="built_in">document</span>.getElementById(<span class="string">"name"</span>).value;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(<span class="string">'WebSocket'</span> <span class="keyword">in</span> <span class="built_in">window</span>) &#123;</span></span><br><span class="line"><span class="actionscript">            websocket = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost/websocket/"</span> + username);</span></span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">            alert(<span class="string">"不支持websocket"</span>)</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">        websocket.onopen = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">"message"</span>).innerHTML = <span class="string">'连接建立'</span>;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line"><span class="actionscript">        websocket.onmessage = <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> data = event.data;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">"message"</span>).innerHTML = data;</span></span><br><span class="line">        &#125;;</span><br><span class="line">    </span><br><span class="line"><span class="actionscript">        websocket.onerror = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">"message"</span>).innerHTML = <span class="string">'异常'</span>;</span></span><br><span class="line">        &#125;;</span><br><span class="line"><span class="actionscript">        websocket.onclose = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">"message"</span>).innerHTML = <span class="string">'连接关闭'</span>;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// 当浏览器关闭窗口时，也应该关闭连接，否者服务器端websocket会抛出异常</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.onbeforeunload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (websocket != <span class="literal">null</span>) &#123;</span></span><br><span class="line">                websocket.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> toUser = <span class="built_in">document</span>.getElementById(<span class="string">"toUser"</span>).value;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> toMessage = <span class="built_in">document</span>.getElementById(<span class="string">"toMessage"</span>).value;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> json = <span class="string">'&#123;"toUser":"'</span> + toUser +<span class="string">'","toMessage":"'</span>+toMessage+<span class="string">'"&#125;'</span>;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (websocket != <span class="literal">null</span>) &#123;</span></span><br><span class="line">            websocket.send(json);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;<span class="name">button</span>  <span class="attr">onclick</span>=<span class="string">"connection()"</span>&gt;</span>连接<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    接收人：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"toUser"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    内容：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"toMessage"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"send()"</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"message"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置wss"><a href="#配置wss" class="headerlink" title="配置wss"></a>配置wss</h2><p>因为项目后台使用https，所以WebSocket也要从ws://改为wss://</p>
<p>是Spring Boot框架，所以在项目入口文件</p>
<p><code>SpringApplication.run(DemoApplication.class, args);</code>的启动方法下增加<code>bean</code>配置。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 创建wss协议接口</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> TomcatContextCustomizer <span class="title">tomcatContextCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> TomcatContextCustomizer() &#123;</span><br><span class="line">         <span class="meta">@Override</span></span><br><span class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">             context.addServletContainerInitializer(<span class="keyword">new</span> WsSci(), <span class="keyword">null</span>);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Spring Boot</tag>
        <tag>WebSocket</tag>
      </tags>
  </entry>
  <entry>
    <title>ramda初体验-数据转换</title>
    <url>/2020/09/14/ramda%E5%88%9D%E4%BD%93%E9%AA%8C-%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>前段时间发现了ramda这个函数式的JavaScript的库。一直没机会用。今天遇到个需求，刚好可以使用上。</p>
<p>要求是把后台接口返回的数据格式转化成与echart对接的数据格式，如图：</p>
<a id="more"></a>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"2020-07-01"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"北京输气管理处"</span>: <span class="string">"95"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"山西输气管理处"</span>: <span class="string">"51"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"2020-07-02"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"北京输气管理处"</span>: <span class="string">"98"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"山西输气管理处"</span>: <span class="string">"54"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">-&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"北京输气管理处"</span>: [</span><br><span class="line">    <span class="string">"95"</span>,</span><br><span class="line">    <span class="string">"98"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"山西输气管理处"</span>: [</span><br><span class="line">    <span class="string">"51"</span>,</span><br><span class="line">    <span class="string">"54"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>先放上平时的写法：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>ES6<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    textarea &#123;</span><br><span class="line">      width: 100%;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"run()"</span>&gt;</span>run<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">"100"</span> <span class="attr">rows</span>=<span class="string">"50"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">      run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">      workFlow()</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">print</span><span class="params">(str)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.getElementsByTagName(<span class="string">"textarea"</span>)[<span class="number">0</span>].value = str;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">stringify</span><span class="params">(json)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(json, <span class="literal">null</span>, <span class="string">"  "</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">workFlow</span><span class="params">(layerUrl, sublayerId, token)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> response = getResponse();</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> resultMap = response.result.ResultMap;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> result = format(resultMap);</span></span><br><span class="line">      print(stringify(result));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">getResponse</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="string">"responseCode"</span>: <span class="string">"200"</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"result"</span>: &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="string">"ResultMap"</span>: &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="string">"2020-07-01"</span>: [&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="string">"北京输气管理处"</span>: <span class="string">"95"</span></span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line"><span class="actionscript">              <span class="string">"山西输气管理处"</span>: <span class="string">"51"</span></span></span><br><span class="line">            &#125;],</span><br><span class="line"><span class="actionscript">            <span class="string">"2020-07-02"</span>: [&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="string">"北京输气管理处"</span>: <span class="string">"98"</span></span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line"><span class="actionscript">              <span class="string">"山西输气管理处"</span>: <span class="string">"54"</span></span></span><br><span class="line">            &#125;],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">format</span><span class="params">(resultMap)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> time = [];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> data = [];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> resultMap) &#123;</span></span><br><span class="line">        time.push(key);</span><br><span class="line">        data.push(resultMap[key]);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="actionscript">      <span class="comment">// 二维数组转化为一维</span></span></span><br><span class="line">      data = data.reduce(</span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="params">(a, b)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> a.concat(b);</span></span><br><span class="line">        &#125;,</span><br><span class="line">        []</span><br><span class="line">      );</span><br><span class="line"><span class="actionscript">      data = groupBy(data, <span class="string">"key"</span>);</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        time,</span><br><span class="line">        data</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">groupBy</span><span class="params">(objectArray, property)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> objectArray.reduce(<span class="function"><span class="keyword">function</span> <span class="params">(acc, obj)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> key = obj[property];</span></span><br><span class="line">        if (!acc[key]) &#123;</span><br><span class="line">          acc[key] = [];</span><br><span class="line">        &#125;</span><br><span class="line">        acc[key].push(obj);</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> acc;</span></span><br><span class="line">      &#125;, &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用ramda的代码实现如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Ramda<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    textarea &#123;</span><br><span class="line">      width: 100%;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//cdnjs.cloudflare.com/ajax/libs/ramda/0.27.0/ramda.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"run()"</span>&gt;</span>run<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">"100"</span> <span class="attr">rows</span>=<span class="string">"50"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">      run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">      workFlow()</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">print</span><span class="params">(str)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.getElementsByTagName(<span class="string">"textarea"</span>)[<span class="number">0</span>].value = str;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">stringify</span><span class="params">(json)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(json, <span class="literal">null</span>, <span class="string">"  "</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">getResponse</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="string">"responseCode"</span>: <span class="string">"200"</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"result"</span>: &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="string">"ResultMap"</span>: &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="string">"2020-07-01"</span>: [&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="string">"北京输气管理处"</span>: <span class="string">"95"</span></span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line"><span class="actionscript">              <span class="string">"山西输气管理处"</span>: <span class="string">"51"</span></span></span><br><span class="line">            &#125;],</span><br><span class="line"><span class="actionscript">            <span class="string">"2020-07-02"</span>: [&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="string">"北京输气管理处"</span>: <span class="string">"98"</span></span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line"><span class="actionscript">              <span class="string">"山西输气管理处"</span>: <span class="string">"54"</span></span></span><br><span class="line">            &#125;],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> objFormat = <span class="function"><span class="params">o</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> [key, value] = <span class="built_in">Object</span>.entries(o)[<span class="number">0</span>];</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">        key,</span><br><span class="line">        value</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> valueFn = <span class="function">(<span class="params">acc, &#123; value &#125;</span>) =&gt;</span> acc.concat(value);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> keyFn = <span class="function">(<span class="params">&#123; key &#125;</span>) =&gt;</span> key;</span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">workFlow</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> response = getResponse();</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> resultMap = response.result.ResultMap;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> result = R.compose(</span></span><br><span class="line"><span class="actionscript">        R.reduceBy(valueFn, [], keyFn),  <span class="comment">// 对数组进行groupBy</span></span></span><br><span class="line"><span class="actionscript">        R.flatten,                       <span class="comment">// 抹平数组</span></span></span><br><span class="line"><span class="actionscript">        R.values,                        <span class="comment">// 取出value作为数组</span></span></span><br><span class="line"><span class="actionscript">        R.map(R.map(objFormat))          <span class="comment">// 转化为key value的对象</span></span></span><br><span class="line">      )(resultMap);</span><br><span class="line">      print(stringify(result));</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>ramda在进行数据处理、数据转换上，流程似乎更加明晰，代码更加可读。</p>
<p>而且保持了数据不变。</p>
]]></content>
      <categories>
        <category>Ramda</category>
      </categories>
      <tags>
        <tag>Ramda</tag>
      </tags>
  </entry>
  <entry>
    <title>个人服务器</title>
    <url>/2020/12/07/%E4%B8%AA%E4%BA%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    <content><![CDATA[<p>2019年12月，想着参照<a href="https://developers.arcgis.com/javascript/latest/guide/typescript-setup/" target="_blank" rel="noopener">AcrGIS官网示例</a>搭建的typescript开发环境，写一些简单入门的WebGIS demo。</p>
<p>然后租了腾讯云的一台1H2G的服务器，部署ArcGIS API、SDK和应用。</p>
<p>同时准备录制视频，所以想租一台windows server，直接录屏操作服务器。结果网络很卡，就放弃了录屏服务器的想法。</p>
<a id="more"></a>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><ul>
<li>安装node.js，安装nvm管理node版本。</li>
<li>安装VSCode、Chrome，Git（可省略）</li>
<li>修改计算机名称，计算机全名：geodaoyu.arcgisonline.cn</li>
</ul>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">C:</span><br><span class="line">├── Application</span><br><span class="line">│   ├──  nginx-1.17.6</span><br><span class="line">│   │    ├──  ssl&#x2F;geodaoyu.crt        # ssl证书</span><br><span class="line">│   │    └──  ssl&#x2F;geodaoyu.key</span><br><span class="line">│   ├──  nodejs</span><br><span class="line">│   └──  nvm</span><br><span class="line">├── Project</span><br><span class="line">│   ├──  script</span><br><span class="line">│   │    └──  update-documentation.js  # 更新sdk的脚本</span><br><span class="line">│   └──  ts-api-app</span><br><span class="line">└── Resource&#x2F;arcgis</span><br><span class="line">    ├──  api</span><br><span class="line">    │    ├──  4.13</span><br><span class="line">    │    │    ├──  ...</span><br><span class="line">    │    │    └──  init.js</span><br><span class="line">    │    ├──  4.14</span><br><span class="line">    │    └──  ...</span><br><span class="line">    └──  sdk</span><br><span class="line">         ├──  4.13</span><br><span class="line">         │    ├──  ...</span><br><span class="line">         │    └──  index.html</span><br><span class="line">         ├──  4.14</span><br><span class="line">         └──  ...</span><br></pre></td></tr></table></figure>

<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">#user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs&#x2F;error.log;</span><br><span class="line">#error_log  logs&#x2F;error.log  notice;</span><br><span class="line">#error_log  logs&#x2F;error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs&#x2F;access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        listen       443 ssl;</span><br><span class="line">        server_name  geodaoyu.arcgisonline.cn;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs&#x2F;host.access.log  main;</span><br><span class="line"></span><br><span class="line">        ssl_certificate      C:&#x2F;Application&#x2F;nginx-1.17.6&#x2F;ssl&#x2F;geodaoyu.crt;</span><br><span class="line">        ssl_certificate_key  C:&#x2F;Application&#x2F;nginx-1.17.6&#x2F;ssl&#x2F;geodaoyu.key;</span><br><span class="line"></span><br><span class="line">        ssl_session_cache    shared:SSL:1m;</span><br><span class="line">        ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">        ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">        ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location &#x2F;favicon.ico &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location &#x2F;arcgis&#x2F;api &#123;</span><br><span class="line">            add_header Access-Control-Allow-Origin *;</span><br><span class="line">            alias  C:&#x2F;Resource&#x2F;arcgis&#x2F;api;</span><br><span class="line">            index  dojo&#x2F;dojo.js;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location &#x2F;arcgis&#x2F;sdk &#123;</span><br><span class="line">            alias  C:&#x2F;Resource&#x2F;arcgis&#x2F;sdk;</span><br><span class="line">            index  index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location &#x2F;ts-api-app &#123;</span><br><span class="line">            alias  C:&#x2F;Project&#x2F;ts-api-app;</span><br><span class="line">            index  index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              &#x2F;404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page &#x2F;50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http:&#x2F;&#x2F;127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  &#x2F;scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&#39;s document root</span><br><span class="line">        # concurs with nginx&#39;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ &#x2F;\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location &#x2F; &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ArcGIS JS API</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>二维样式受高程影响显示异常</title>
    <url>/2020/08/20/%E4%BA%8C%E7%BB%B4%E6%A0%B7%E5%BC%8F%E5%8F%97%E9%AB%98%E7%A8%8B%E5%BD%B1%E5%93%8D%E6%98%BE%E7%A4%BA%E5%BC%82%E5%B8%B8/</url>
    <content><![CDATA[<p>遇到个问题，二维样式在三维下，显示异常：显示不全，样式随地图拖拽会闪烁、变化。如下图：</p>
<a id="more"></a>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20200814105022173.png" alt="image-20200814105022173"></p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20200814105110911.png" alt="image-20200814105110911"></p>
<p>代码中symbol设置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> symbol = &#123;</span><br><span class="line">  type: <span class="string">"simple-fill"</span>,  <span class="comment">// autocasts as new SimpleFillSymbol()</span></span><br><span class="line">  color: [ <span class="number">51</span>,<span class="number">51</span>, <span class="number">204</span>, <span class="number">0.9</span> ],</span><br><span class="line">  style: <span class="string">"solid"</span>,</span><br><span class="line">  outline: &#123;  <span class="comment">// autocasts as new SimpleLineSymbol()</span></span><br><span class="line">    color: <span class="string">"white"</span>,</span><br><span class="line">    width: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>问题原因及解决方法：</p>
<p>受到高程影响，导致部分面要素被遮盖。</p>
<p>设置<code>FeatureLayer</code>的<code>elevationInfo</code>属性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> FeatureLayer(&#123;</span><br><span class="line">  ...,</span><br><span class="line">  elevationInfo: &#123;</span><br><span class="line">    mode: <span class="string">"on-the-ground"</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ArcGIS JS API</category>
      </categories>
      <tags>
        <tag>elevationInfo</tag>
      </tags>
  </entry>
  <entry>
    <title>使用FeatureLayer加载WFS服务</title>
    <url>/2020/07/02/%E4%BD%BF%E7%94%A8FeatureLayer%E5%8A%A0%E8%BD%BDWFS%E6%9C%8D%E5%8A%A1/</url>
    <content><![CDATA[<p>ArcGIS JS API 在当前（4.15版本）提供有WebTileLayer、WMSLayer、WMTSLayer等图层类，但并没有提供加载WFS服务的图层类。所以使用FeatureLayer来实现加载。</p>
<blockquote>
<p>WFS，Web Feature Service，网络要素服务</p>
</blockquote>
<a id="more"></a>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>手动构造FeatureLayer的source 属性。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">st&#x3D;&gt;start: Start</span><br><span class="line">req&#x3D;&gt;operation: WFS请求</span><br><span class="line">xml&#x3D;&gt;operation: 解析XML</span><br><span class="line">feature&#x3D;&gt;operation: 实例化FeatureLayer</span><br><span class="line">e&#x3D;&gt;end</span><br><span class="line">st-&gt;req-&gt;xml-&gt;feature-&gt;e</span><br></pre></td></tr></table></figure>

<h2 id="WFS请求"><a href="#WFS请求" class="headerlink" title="WFS请求"></a>WFS请求</h2><h3 id="GetCapabilities"><a href="#GetCapabilities" class="headerlink" title="GetCapabilities"></a>GetCapabilities</h3><p>参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>是否必须</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>SERVICE</td>
<td>Y</td>
<td>WFS</td>
</tr>
<tr>
<td>REQUEST=GetCapabilities</td>
<td>Y</td>
<td></td>
</tr>
</tbody></table>
<p>请求示例：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.someserver.com&#x2F;wfs?</span><br><span class="line"></span><br><span class="line">SERVICE&#x3D;WFS&amp;</span><br><span class="line"></span><br><span class="line">REQUEST&#x3D;GetCapabilities</span><br></pre></td></tr></table></figure>

<h3 id="GetFeature"><a href="#GetFeature" class="headerlink" title="GetFeature"></a>GetFeature</h3><p>参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>是否必须</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>VERSION</td>
<td>Y</td>
<td>1.1.0</td>
</tr>
<tr>
<td>SERVICE</td>
<td>Y</td>
<td>WFS</td>
</tr>
<tr>
<td>REQUEST=GetFeature</td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>TYPENAME</td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>OUTPUTFORMAT</td>
<td></td>
<td>text/xml; subtype=gml/3.1.1</td>
</tr>
<tr>
<td>BBOX</td>
<td></td>
<td></td>
</tr>
<tr>
<td>FILTER</td>
<td></td>
<td></td>
</tr>
<tr>
<td>SORTBY</td>
<td></td>
<td></td>
</tr>
<tr>
<td>MAXFEATURES</td>
<td></td>
<td></td>
</tr>
<tr>
<td>PROPERTYNAME</td>
<td></td>
<td></td>
</tr>
<tr>
<td>SRSNAME</td>
<td></td>
<td></td>
</tr>
<tr>
<td>FEATUREID</td>
<td></td>
<td></td>
</tr>
<tr>
<td>EXPIRY</td>
<td></td>
<td></td>
</tr>
<tr>
<td>RESULTTYPE</td>
<td></td>
<td>results</td>
</tr>
<tr>
<td>FEATUREVERSION</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>请求示例：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.someserver.com&#x2F;wfs？</span><br><span class="line"></span><br><span class="line">SERVICE&#x3D;WFS&amp;</span><br><span class="line"></span><br><span class="line">VERSION&#x3D;1.1.0&amp;</span><br><span class="line"></span><br><span class="line">REQUEST&#x3D;GetFeature&amp;</span><br><span class="line"></span><br><span class="line">PROPERTYNAME&#x3D;InWaterA_1M&#x2F;wkbGeom,InWaterA_1M&#x2F;tileId&amp;</span><br><span class="line"></span><br><span class="line">TYPENAME&#x3D;InWaterA_1M&amp;</span><br><span class="line"></span><br><span class="line">FILTER&#x3D;InWaterA_1M&#x2F;wkbGeom</span><br></pre></td></tr></table></figure>

<h2 id="解析XML"><a href="#解析XML" class="headerlink" title="解析XML"></a>解析XML</h2><p>从返回的XML中解析数据，构造Features数组。</p>
<p>解析过程示例代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> parser = <span class="keyword">new</span> DOMParser();</span><br><span class="line"><span class="keyword">const</span> xml = parser.parseFromString(response, <span class="string">'text/xml'</span>);</span><br><span class="line"><span class="keyword">const</span> htmlCollection = xml.getElementsByTagName(<span class="string">'wfs:FeatureCollection'</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = htmlCollection.length; i &lt; len; i++) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(htmlCollection[i].innerHTML);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Features数组：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> features = [</span><br><span class="line"> &#123;</span><br><span class="line">   geometry: &#123;</span><br><span class="line">     type: <span class="string">"point"</span>,</span><br><span class="line">     x: <span class="number">-100</span>,</span><br><span class="line">     y: <span class="number">38</span></span><br><span class="line">   &#125;,</span><br><span class="line">   attributes: &#123;</span><br><span class="line">     ObjectID: <span class="number">1</span>,</span><br><span class="line">     DepArpt: <span class="string">"KATL"</span>,</span><br><span class="line">     MsgTime: <span class="built_in">Date</span>.now(),</span><br><span class="line">     FltId: <span class="string">"UAL1"</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> ...</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h2 id="实例化FeatureLayer"><a href="#实例化FeatureLayer" class="headerlink" title="实例化FeatureLayer"></a>实例化FeatureLayer</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> FeatureLayer(&#123;</span><br><span class="line">  source: features,  <span class="comment">// autocast as a Collection of new Graphic()</span></span><br><span class="line">  objectIdField: <span class="string">"ObjectID"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ArcGIS JS API</category>
      </categories>
      <tags>
        <tag>XML</tag>
        <tag>WFS</tag>
        <tag>FeatureLayer</tag>
        <tag>OGC</tag>
        <tag>ArcGIS JS API</tag>
      </tags>
  </entry>
  <entry>
    <title>使用Jenkins代码构建</title>
    <url>/2020/07/06/%E4%BD%BF%E7%94%A8Jenkins%E4%BB%A3%E7%A0%81%E6%9E%84%E5%BB%BA/</url>
    <content><![CDATA[<p>以前构建部署，都是手工操作。先在本机编译打包，然后拷贝到服务器上做部署。</p>
<p>频繁的构建部署，费时烦心，所以学习使用Jenkins来实现自动化。</p>
<blockquote>
<p>Jenkins是开源CI&amp;CD软件领导者， 提供超过1000个插件来支持构建、部署、自动化， 满足任何项目的需要。</p>
</blockquote>
<p><a href="https://www.jenkins.io/" target="_blank" rel="noopener">官网</a>的介绍和文档写的也很详尽了，下面我简单介绍下流程。</p>
<p>本文针对是Windows。Linux的环境时，一般都是内网，无法通过Git拉取更新。</p>
<a id="more"></a>
<h2 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1 环境准备"></a>1 环境准备</h2><ul>
<li>Java</li>
</ul>
<p>Jenkins 是基于 Java 的独立程序，所以需要Java环境，这里不细说。</p>
<ul>
<li>Node</li>
</ul>
<p>主要是前端项目，所以需要Node。</p>
<ul>
<li>Git</li>
</ul>
<p>使用Git做版本控制。</p>
<ul>
<li>Gradle环境</li>
</ul>
<p>后端如果使用Maven，则需要配置Gradle环境。</p>
<h2 id="2-下载安装"><a href="#2-下载安装" class="headerlink" title="2 下载安装"></a>2 下载安装</h2><p>官网提供了两种方式，一种是war包，一种是msi安装包。</p>
<p>安装包的实质也是war包启动。所以推荐使用war包。</p>
<p>启动的两种方式：</p>
<p>一是把jenkins.war放到Tomcat下，作为项目启动。</p>
<p>二是通过命令行<code>java -jar jenkins.war</code>来启动。</p>
<h2 id="3-Jenkins配置"><a href="#3-Jenkins配置" class="headerlink" title="3 Jenkins配置"></a>3 Jenkins配置</h2><h3 id="3-1-端口号"><a href="#3-1-端口号" class="headerlink" title="3.1 端口号"></a>3.1 端口号</h3><p>默认端口号是8080，为了避免冲突，一般是需要修改的。</p>
<p>如果是Tomcat启动，则修改Tomcat的端口号。</p>
<p>如果是<code>java -jar jenkins.war</code>启动，修改根目录jenkins.xml文件</p>
<h3 id="3-2-初始化"><a href="#3-2-初始化" class="headerlink" title="3.2 初始化"></a>3.2 初始化</h3><p>浏览器输入<code>http://localhost:8080/jenkins</code>可以进入到Jenkins页面。</p>
<p>然后是引导式的配置，需要配置一些如管理员账号，安装常用插件等。</p>
<h3 id="3-3-项目构建配置"><a href="#3-3-项目构建配置" class="headerlink" title="3.3 项目构建配置"></a>3.3 项目构建配置</h3><p>初始化完成后可以进入到Jenkins主页面，新建任务。</p>
<h4 id="3-3-1-源码管理"><a href="#3-3-1-源码管理" class="headerlink" title="3.3.1 源码管理"></a>3.3.1 源码管理</h4><p>设置源码git地址和git账号，默认分支是master。</p>
<h4 id="3-3-2-构建器触发"><a href="#3-3-2-构建器触发" class="headerlink" title="3.3.2 构建器触发"></a>3.3.2 构建器触发</h4><p>有多种触发方式，简单介绍两种：</p>
<ul>
<li>Poll SCM</li>
</ul>
<p>定时器，间隔时间拉取git，如果有新代码则触发构建。</p>
<ul>
<li>GitLab Hook</li>
</ul>
<p>通过钩子，每次有代码推送，就触发构建。</p>
<p>需要在GitLab开启Webhooks，在Jenkins中安装 GitLab Hook插件。</p>
<blockquote>
<p>修改jenkins配置，在jenkins的 Config System 功能中，取消 Enable authentication for ‘/project’ end-point 的选中状</p>
</blockquote>
<h3 id="3-4-构建"><a href="#3-4-构建" class="headerlink" title="3.4 构建"></a>3.4 构建</h3><h4 id="3-4-1-npm构建"><a href="#3-4-1-npm构建" class="headerlink" title="3.4.1 npm构建"></a>3.4.1 npm构建</h4><p>流程：git拉取-&gt;npm打包-&gt;替换部署文件</p>
<p>示例Shell脚本代码</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">git pull</span><br><span class="line">npm install</span><br><span class="line">npm run build</span><br><span class="line"><span class="built_in">Remove-Item</span> C:\Projects\xxx <span class="literal">-Recurse</span> <span class="literal">-Force</span> <span class="literal">-Confirm</span>:<span class="variable">$false</span></span><br><span class="line"><span class="built_in">Copy-Item</span> dist C:\Projects\xxx <span class="literal">-Recurse</span></span><br></pre></td></tr></table></figure>

<h4 id="3-4-2-gradle构建"><a href="#3-4-2-gradle构建" class="headerlink" title="3.4.2 gradle构建"></a>3.4.2 gradle构建</h4><p>流程：git拉取-&gt;gradel打jar包-&gt;停止jar包-&gt;替换文件-&gt;启动新的jar包</p>
<h3 id="3-5-通知"><a href="#3-5-通知" class="headerlink" title="3.5 通知"></a>3.5 通知</h3><p>构建结果可以通知，常见有邮箱通知和钉钉群通知。</p>
<blockquote>
<p>Jenkins需要安装钉钉插件</p>
</blockquote>
<h2 id="4-使用总结"><a href="#4-使用总结" class="headerlink" title="4 使用总结"></a>4 使用总结</h2><p>配置一次项目自动构建大概需要大半天时间。</p>
<p>然后后面就不怎么用管它了。</p>
<p>我理解的自动构建的实质就是，在服务器上放了一个”金老头”，然后把帮你把你手动操作的构建部署做一遍。</p>
<p>如果构建失败，可以在Jenkins页面查看日志，排查问题。但是一般直接重新构建就能成功。</p>
]]></content>
      <categories>
        <category>Jenkins</category>
      </categories>
      <tags>
        <tag>Jenkins</tag>
        <tag>CI&amp;CD</tag>
      </tags>
  </entry>
  <entry>
    <title>修改hr标签样式</title>
    <url>/2020/06/28/%E4%BF%AE%E6%94%B9hr%E6%A0%87%E7%AD%BE%E6%A0%B7%E5%BC%8F/</url>
    <content><![CDATA[<p>一段来自的w3school介绍：</p>
<blockquote>
<p><code>&lt;hr&gt;</code>标签在 HTML 页面中创建一条水平线。</p>
<p>水平分隔线（horizontal rule）可以在<em>视觉上</em>将文档分隔成各个部分。</p>
</blockquote>
<p><code>&lt;hr&gt;</code>标签的表现，像一个内容为空的div。</p>
<p>那么通过设置border的样式，则可以修改hr的样式。</p>
<a id="more"></a>
<p>例如：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">hr</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid orange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>ramda-compose中包含异步操作</title>
    <url>/2020/09/20/ramda-compose%E4%B8%AD%E5%8C%85%E5%90%AB%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<p>在函数组合时，如果有异步操作，那么ramda中compose应该怎么写呢？</p>
<p>在写空间查询例子的时候，就遇到了这个问题，其中doQuery方法是一个异步函数。</p>
<p>解决方法是一个andThen函数。</p>
<a id="more"></a>
<p>代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// highLight上图</span></span><br><span class="line"><span class="keyword">let</span> highLightHandler: __esri.Handle = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">const</span> highLight = <span class="function">(<span class="params">features: <span class="built_in">Array</span>&lt;Graphic&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">  view.whenLayerView(featureLayer).then(<span class="function"><span class="params">layerView</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (highLightHandler) &#123;</span><br><span class="line">      highLightHandler.remove(); <span class="comment">// 清空高亮</span></span><br><span class="line">    &#125;</span><br><span class="line">    highLightHandler = layerView.highlight(features);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用查询条件查询返回查询结果</span></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line"><span class="keyword">const</span> doQuery = <span class="keyword">async</span> query =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> featureLayer.queryFeatures(query);</span><br><span class="line">  <span class="keyword">const</span> &#123; features &#125; = result;</span><br><span class="line">  <span class="keyword">return</span> features;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用绘制的图形生成查询条件</span></span><br><span class="line"><span class="keyword">const</span> generateQuery = <span class="function">(<span class="params">geometry: Geometry</span>) =&gt;</span> <span class="keyword">new</span> Query(&#123;</span><br><span class="line">  returnGeometry: <span class="literal">true</span>,</span><br><span class="line">  outFields: [<span class="string">"NAME"</span>, <span class="string">"OBJECTID"</span>], <span class="comment">// highlight必须要OBJECTID字段</span></span><br><span class="line">  geometry,</span><br><span class="line">  outSpatialReference: view.spatialReference,</span><br><span class="line">  spatialRelationship: <span class="string">"intersects"</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询结果展示到控制台</span></span><br><span class="line"><span class="keyword">const</span> showInTable = <span class="function">(<span class="params">features: Graphic[]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> attributes = features.map(<span class="function"><span class="params">feature</span> =&gt;</span> feature.attributes);</span><br><span class="line">  <span class="built_in">console</span>.table(attributes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理查询结果</span></span><br><span class="line"><span class="keyword">const</span> showQueryResult = <span class="function">(<span class="params">features: Graphic[]</span>) =&gt;</span> &#123;</span><br><span class="line">  showInTable(features);</span><br><span class="line">  highLight(features);</span><br><span class="line">  graphicsLayer.removeAll(); <span class="comment">// 清空绘制图形</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> workFlow = R.compose(</span><br><span class="line">  R.andThen(showQueryResult), <span class="comment">// 处理查询结果</span></span><br><span class="line">  doQuery,                    <span class="comment">// 使用查询条件查询返回查询结果      </span></span><br><span class="line">  generateQuery               <span class="comment">// 使用绘制的图形生成查询条件</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.在绘制结束，拿到绘制的图形</span></span><br><span class="line">sketch.on(<span class="string">"create"</span>, event =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.state === <span class="string">"complete"</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> geometry = event.graphic.geometry;</span><br><span class="line">    workFlow(geometry);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Ramda</category>
      </categories>
      <tags>
        <tag>Ramda</tag>
      </tags>
  </entry>
  <entry>
    <title>修改服务字段类型</title>
    <url>/2020/09/14/%E4%BF%AE%E6%94%B9%E6%9C%8D%E5%8A%A1%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>接口返回的是geojson格式，但是使用GeojsonLayer加载的时候，高亮的坐标有问题。排查发现，是接口返回的坐标全是string类型。</p>
<p>所以要写一个方法，把string类型的坐标转换为double类型，其他的数据保持不变。</p>
<a id="more"></a>
<p>转换的格式如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"FeatureCollection"</span>,</span><br><span class="line">  <span class="attr">"features"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"Feature"</span>,</span><br><span class="line">      <span class="attr">"properties"</span>: &#123;</span><br><span class="line">        <span class="attr">"ID"</span>: <span class="string">"1"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"geometry"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"Point"</span>,</span><br><span class="line">        <span class="attr">"coordinates"</span>: [</span><br><span class="line">          <span class="string">"120.98058226222103"</span>,</span><br><span class="line">          <span class="string">"31.19176762858661"</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"Feature"</span>,</span><br><span class="line">      <span class="attr">"properties"</span>: &#123;</span><br><span class="line">        <span class="attr">"ID"</span>: <span class="string">"5"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"geometry"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"Point"</span>,</span><br><span class="line">        <span class="attr">"coordinates"</span>: [</span><br><span class="line">          <span class="string">"121.0442694"</span>,</span><br><span class="line">          <span class="string">"31.27477222"</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">-&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"FeatureCollection"</span>,</span><br><span class="line">  <span class="attr">"features"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"Feature"</span>,</span><br><span class="line">      <span class="attr">"properties"</span>: &#123;</span><br><span class="line">        <span class="attr">"ID"</span>: <span class="string">"1"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"geometry"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"Point"</span>,</span><br><span class="line">        <span class="attr">"coordinates"</span>: [</span><br><span class="line">          <span class="number">120.98058226222103</span>,</span><br><span class="line">          <span class="number">31.19176762858661</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"Feature"</span>,</span><br><span class="line">      <span class="attr">"properties"</span>: &#123;</span><br><span class="line">        <span class="attr">"ID"</span>: <span class="string">"5"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"geometry"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"Point"</span>,</span><br><span class="line">        <span class="attr">"coordinates"</span>: [</span><br><span class="line">          <span class="number">121.0442694</span>,</span><br><span class="line">          <span class="number">31.27477222</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Ramda<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    textarea &#123;</span><br><span class="line">      width: 100%;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//cdnjs.cloudflare.com/ajax/libs/ramda/0.27.0/ramda.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"workFlow()"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">"100"</span> <span class="attr">rows</span>=<span class="string">"50"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> getResponse = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="string">"type"</span>: <span class="string">"FeatureCollection"</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"features"</span>: [&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="string">"type"</span>: <span class="string">"Feature"</span>,</span></span><br><span class="line"><span class="actionscript">            <span class="string">"properties"</span>: &#123;</span></span><br><span class="line"><span class="actionscript">              <span class="string">"ID"</span>: <span class="string">"1"</span>,</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="actionscript">            <span class="string">"geometry"</span>: &#123;</span></span><br><span class="line"><span class="actionscript">              <span class="string">"type"</span>: <span class="string">"Point"</span>,</span></span><br><span class="line"><span class="actionscript">              <span class="string">"coordinates"</span>: [</span></span><br><span class="line"><span class="actionscript">                <span class="string">"120.98058226222103"</span>,</span></span><br><span class="line"><span class="actionscript">                <span class="string">"31.19176762858661"</span></span></span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line"><span class="actionscript">            <span class="string">"type"</span>: <span class="string">"Feature"</span>,</span></span><br><span class="line"><span class="actionscript">            <span class="string">"properties"</span>: &#123;</span></span><br><span class="line"><span class="actionscript">              <span class="string">"ID"</span>: <span class="string">"5"</span>,</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="actionscript">            <span class="string">"geometry"</span>: &#123;</span></span><br><span class="line"><span class="actionscript">              <span class="string">"type"</span>: <span class="string">"Point"</span>,</span></span><br><span class="line"><span class="actionscript">              <span class="string">"coordinates"</span>: [</span></span><br><span class="line"><span class="actionscript">                <span class="string">"121.0442694"</span>,</span></span><br><span class="line"><span class="actionscript">                <span class="string">"31.27477222"</span></span></span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> workFlow = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> response = getResponse();</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> featuresLens = R.lensProp(<span class="string">'features'</span>); <span class="comment">// 使用透镜获取features属性</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> coordinatesLens = R.lensPath([<span class="string">'geometry'</span>, <span class="string">'coordinates'</span>]); <span class="comment">// 使用透镜获取coordinates属性</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> coordinates2num = R.map(<span class="built_in">Number</span>); <span class="comment">// 把坐标值从字符串转为数字</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> overFeatures = R.over(coordinatesLens, coordinates2num); <span class="comment">// 修改features中coordinates的值</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> mapFeatures = R.map(overFeatures); <span class="comment">// 遍历features</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> overResponse = R.over(featuresLens, mapFeatures); <span class="comment">// 修改response中features的值</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> result = overResponse(response);</span></span><br><span class="line">      print(response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 打印结果相关</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> setTextarea = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.getElementsByTagName(<span class="string">"textarea"</span>)[<span class="number">0</span>].value = str;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> stringify = <span class="function"><span class="params">json</span> =&gt;</span> <span class="built_in">JSON</span>.stringify(json, <span class="literal">null</span>, <span class="string">"  "</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> print = R.compose(</span></span><br><span class="line">      setTextarea,</span><br><span class="line">      stringify</span><br><span class="line">    );</span><br><span class="line"><span class="actionscript">    <span class="comment">// 打印结果相关</span></span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>按平时ES6的写法，循环遍历，然后修改值。破坏了数据不变。</p>
<p>ramda的写法明显要更复杂一些。</p>
]]></content>
      <categories>
        <category>Ramda</category>
      </categories>
      <tags>
        <tag>Ramda</tag>
      </tags>
  </entry>
  <entry>
    <title>出差准备的物件</title>
    <url>/2020/10/31/%E5%87%BA%E5%B7%AE%E5%87%86%E5%A4%87%E7%9A%84%E7%89%A9%E4%BB%B6/</url>
    <content><![CDATA[<p>差不多每年10月都会出个差、所以存一份儿出差要准备物件的清单，以后就直接照着清单配了。</p>
<a id="more"></a>
<h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><ul>
<li><input disabled="" type="checkbox"> 电脑、键盘、鼠标、手托、支架</li>
<li><input disabled="" type="checkbox"> 电子纸</li>
<li><input disabled="" type="checkbox"> 手机、耳机、充电器</li>
<li><input disabled="" type="checkbox"> U盘</li>
<li><input disabled="" type="checkbox"> 背包、电脑包、腰包</li>
<li><input disabled="" type="checkbox"> 眼睛盒、镜布</li>
</ul>
<h2 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h2><ul>
<li><input disabled="" type="checkbox"> 外套、长袖、长裤</li>
<li><input disabled="" type="checkbox"> 内衣、内裤、睡衣</li>
<li><input disabled="" type="checkbox"> 袜子</li>
<li><input disabled="" type="checkbox"> 脸帕、浴巾、洗面奶、刮胡刀、牙刷</li>
<li><input disabled="" type="checkbox"> 钥匙、身份证</li>
<li><input disabled="" type="checkbox"> 茶包、卫生纸、水杯</li>
</ul>
<h2 id="现场购买"><a href="#现场购买" class="headerlink" title="现场购买"></a>现场购买</h2><ul>
<li><input disabled="" type="checkbox"> 盆</li>
<li><input disabled="" type="checkbox"> 伞（按需）</li>
<li><input disabled="" type="checkbox"> 牙膏</li>
</ul>
]]></content>
      <categories>
        <category>Life</category>
      </categories>
      <tags>
        <tag>trip</tag>
      </tags>
  </entry>
  <entry>
    <title>半透明样式</title>
    <url>/2020/07/09/%E5%8D%8A%E9%80%8F%E6%98%8E%E6%A0%B7%E5%BC%8F/</url>
    <content><![CDATA[<p>UI上，有时候加上半透明，会比较好看。</p>
<p>下面列两种常用的设置半透明。</p>
<p>设置<code>div</code>或者图片的半透明，可以使用下面的设置。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">filter: alpha(Opacity=60);-moz-opacity: 0.6;opacity: 0.6;</span><br></pre></td></tr></table></figure>

<p>在设置输入框的时候，发现上面的写法不太适合。推荐下面的写法。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">background</span><span class="selector-pseudo">:transparent</span>;</span><br><span class="line"><span class="selector-tag">background-color</span>: <span class="selector-tag">rgba</span>(255,255,255,0<span class="selector-class">.25</span>);</span><br><span class="line"><span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>样式效果参考：</p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20200709144115568-1594294588911.png" alt="image-20200709144115568"></p>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>opacity</tag>
        <tag>transparent</tag>
      </tags>
  </entry>
  <entry>
    <title>手写Promise</title>
    <url>/2020/09/18/%E6%89%8B%E5%86%99Promise/</url>
    <content><![CDATA[<p>Promise是一个异步编程的解决方案。</p>
<p>之前的方案是回调函数的方式。优点是指定回调函数的位置更灵活，和解决了回调地狱问题。</p>
<p>规范是Promise A+。</p>
<hr>
<p>下面手写实现一遍Promise便于理解。</p>
<a id="more"></a>
<h3 id="总体结构"><a href="#总体结构" class="headerlink" title="总体结构"></a>总体结构</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">window</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 三个状态常量</span></span><br><span class="line">  <span class="keyword">const</span> PENDING = <span class="string">'pending'</span>, <span class="comment">// 等待</span></span><br><span class="line">    FULFILLED = <span class="string">'fulfilled'</span>, <span class="comment">// 成功</span></span><br><span class="line">    REJECTED = <span class="string">'rejected'</span>;   <span class="comment">// 失败</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise 类</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>excutor 执行器</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">excutor</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化状态</span></span><br><span class="line">    <span class="keyword">this</span>.state = PENDING;</span><br><span class="line">    <span class="comment">// 存储数据</span></span><br><span class="line">    <span class="keyword">this</span>.data = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 存储.then的回调函数 &#123;onFulfilled, onRejected&#125;</span></span><br><span class="line">    <span class="comment">// 可能多次.then，所以是一个数据</span></span><br><span class="line">    <span class="keyword">this</span>.callbacks = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * resolve 成功函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 成功的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * reject 失败函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>reason 失败的原因</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      excutor(resolve, reject); <span class="comment">// 立即执行 执行器函数</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      reject(error); <span class="comment">// 异常就直接抛出</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 原型对象上的then方法</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>onFulfilled 获取成功的回调函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>onRejected 获取失败的回调函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>新的Promise对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 原型对象上的catch方法</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>onRejected 获取失败的回调函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>新的Promise对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.prototype.catch = <span class="function"><span class="keyword">function</span> (<span class="params">onRejected</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise函数对象的resolve方法</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.resolve = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise函数对象的reject方法</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>reason </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.reject = <span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise函数对象的all方法</span></span><br><span class="line"><span class="comment">   * 所有成功才成功，只要一个失败则失败</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.all = <span class="function"><span class="keyword">function</span> (<span class="params">promises</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise函数对象的race方法</span></span><br><span class="line"><span class="comment">   * 第一个结束的 成功则成功 失败则失败</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.race = <span class="function"><span class="keyword">function</span> (<span class="params">promises</span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.Promise = <span class="built_in">Promise</span>;</span><br><span class="line">&#125;)(<span class="built_in">window</span>); <span class="comment">// IIEF</span></span><br></pre></td></tr></table></figure>

<h3 id="执行器的resolve"><a href="#执行器的resolve" class="headerlink" title="执行器的resolve"></a>执行器的resolve</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * resolve 成功函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 成功的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">resolve = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 检查状态，保证状态只能改变一次</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.state !== PENDING) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 改状态</span></span><br><span class="line">  <span class="keyword">this</span>.state = FULFILLED;</span><br><span class="line">  <span class="comment">// 存数据</span></span><br><span class="line">  <span class="keyword">this</span>.data = value;</span><br><span class="line">  <span class="comment">// 检查回调，如果有，立即执行回调函数</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.callbacks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.callbacks.forEach(<span class="function"><span class="params">callbackObj</span> =&gt;</span> &#123;</span><br><span class="line">        callbackObj.onFulfilled(<span class="keyword">this</span>.data);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="执行器的reject"><a href="#执行器的reject" class="headerlink" title="执行器的reject,"></a>执行器的reject,</h3><p>复制粘贴resolve，改状态、名字即可。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * reject 失败函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>reason 失败的原因</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">reject = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 查状态，保证状态只能改变一次</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.state !== PENDING) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 改状态</span></span><br><span class="line">  <span class="keyword">this</span>.state = REJECTED;</span><br><span class="line">  <span class="comment">// 存数据</span></span><br><span class="line">  <span class="keyword">this</span>.data = reason;</span><br><span class="line">  <span class="comment">// 检查回调，如果有，立即执行回调函数</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.callbacks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.callbacks.forEach(<span class="function"><span class="params">callbackObj</span> =&gt;</span> &#123;</span><br><span class="line">        callbackObj.onRejected(<span class="keyword">this</span>.data);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="原型对象上的then-方法"><a href="#原型对象上的then-方法" class="headerlink" title="原型对象上的then 方法"></a>原型对象上的then 方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 原型对象上的then方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>onFulfilled 获取成功的回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>onRejected 获取失败的回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>新的Promise对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 保存当前Promise的this</span></span><br><span class="line">  <span class="keyword">const</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// 返回一个新的Promise</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (that.state = FULFILLED) &#123;</span><br><span class="line">      <span class="comment">// 立即异步执行成功的回调函数</span></span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * 返回Promise的结果由onFulfilled或onRejected执行结果决定</span></span><br><span class="line"><span class="comment">        * 情况1.抛出异常 返回Promise的结果为异常，reason为异常</span></span><br><span class="line"><span class="comment">        * 情况2.返回的是Promise，返回Promise的结果就是这个Promise的结果</span></span><br><span class="line"><span class="comment">        * 情况3.返回的不是Promise，返回的Promise为成功，value就是返回值</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> result = onFulfilled(that.data);</span><br><span class="line">          <span class="keyword">if</span> (result <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">            <span class="comment">// 情况2</span></span><br><span class="line">            result.then(resolve, reject);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 情况3</span></span><br><span class="line">            resolve(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="comment">// 情况1</span></span><br><span class="line">          reject(error);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (that.state = REJECTED) &#123;</span><br><span class="line">      <span class="comment">// 立即异步执行失败的回调函数</span></span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * 返回Promise的结果由onFulfilled或onRejected执行结果决定</span></span><br><span class="line"><span class="comment">        * 情况1.抛出异常 返回Promise的结果为异常，reason为异常</span></span><br><span class="line"><span class="comment">        * 情况2.返回的是Promise，返回Promise的结果就是这个Promise的结果</span></span><br><span class="line"><span class="comment">        * 情况3.返回的不是Promise，返回的Promise为成功，value就是返回值</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> result = onRejected(that.data);</span><br><span class="line">          <span class="keyword">if</span> (result <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">            <span class="comment">// 情况2</span></span><br><span class="line">            result.then(resolve, reject);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 情况3</span></span><br><span class="line">            resolve(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="comment">// 情况1</span></span><br><span class="line">          reject(error);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// that.state = PENDING</span></span><br><span class="line">      <span class="comment">// 保存回调函数到callbacks中去</span></span><br><span class="line">      <span class="comment">// that.callbacks.push(&#123;</span></span><br><span class="line">      <span class="comment">//   onFulfilled, onRejected</span></span><br><span class="line">      <span class="comment">// &#125;); // 直接赋值onFulfilled, onRejected</span></span><br><span class="line">      <span class="comment">// 没有机会改变Promise的状态，所以要像成功失败那样再包一层函数</span></span><br><span class="line">      that.callbacks.push(&#123;</span><br><span class="line">        onFulfilled: handle(onFulfilled),</span><br><span class="line">        onRejected: handle(onRejected)</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="封装handle"><a href="#封装handle" class="headerlink" title="封装handle"></a>封装handle</h3><p>在.then方式中成功和失败的处理很类似，所以封装出来</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> handle = <span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 返回Promise的结果由onFulfilled或onRejected执行结果决定</span></span><br><span class="line"><span class="comment">   * 情况1.抛出异常 返回Promise的结果为异常，reason为异常</span></span><br><span class="line"><span class="comment">   * 情况2.返回的是Promise，返回Promise的结果就是这个Promise的结果</span></span><br><span class="line"><span class="comment">   * 情况3.返回的不是Promise，返回的Promise为成功，value就是返回值</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = callback(that.data);</span><br><span class="line">    <span class="keyword">if</span> (result <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">      <span class="comment">// 情况2</span></span><br><span class="line">      result.then(resolve, reject);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 情况3</span></span><br><span class="line">      resolve(result);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="comment">// 情况1</span></span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="优化后的then方法"><a href="#优化后的then方法" class="headerlink" title="优化后的then方法"></a>优化后的then方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 原型对象上的then方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>onFulfilled 获取成功的回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>onRejected 获取失败的回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>新的Promise对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 设置回调函数默认值（必须是函数），Promise继续传递的保障</span></span><br><span class="line">  onResolved = <span class="keyword">typeof</span> onResolved === <span class="string">'function'</span> ? onResolved : <span class="function"><span class="params">value</span> =&gt;</span> value;</span><br><span class="line">  onRejected = <span class="keyword">typeof</span> onRejected === <span class="string">'function'</span> ? onRejected : <span class="function"><span class="params">reason</span> =&gt;</span> &#123; <span class="keyword">throw</span> reason; &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 保存当前Promise的this</span></span><br><span class="line">  <span class="keyword">const</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// 返回一个新的Promise</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handle = <span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 返回Promise的结果由onFulfilled或onRejected执行结果决定</span></span><br><span class="line"><span class="comment">       * 情况1.抛出异常 返回Promise的结果为异常，reason为异常</span></span><br><span class="line"><span class="comment">       * 情况2.返回的是Promise，返回Promise的结果就是这个Promise的结果</span></span><br><span class="line"><span class="comment">       * 情况3.返回的不是Promise，返回的Promise为成功，value就是返回值</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> result = callback(that.data);</span><br><span class="line">        <span class="keyword">if</span> (result <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">          <span class="comment">// 情况2</span></span><br><span class="line">          result.then(resolve, reject);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 情况3</span></span><br><span class="line">          resolve(result);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="comment">// 情况1</span></span><br><span class="line">        reject(error);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (that.state = FULFILLED) &#123;</span><br><span class="line">      <span class="comment">// 立即异步执行成功的回调函数</span></span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        handle(onFulfilled);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (that.state = REJECTED) &#123;</span><br><span class="line">      <span class="comment">// 立即异步执行失败的回调函数</span></span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        handle(onRejected);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// that.state = PENDING</span></span><br><span class="line">      <span class="comment">// 保存回调函数到callbacks中去</span></span><br><span class="line">      that.callbacks.push(&#123;</span><br><span class="line">        onFulfilled: handle(onFulfilled),</span><br><span class="line">        onRejected: handle(onRejected)</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="原型对象上的catch方法"><a href="#原型对象上的catch方法" class="headerlink" title="原型对象上的catch方法"></a>原型对象上的catch方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 原型对象上的catch方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>onRejected 获取失败的回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>新的Promise对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">Promise</span>.prototype.catch = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">undefined</span>, onRejected);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数对象上的resolve和reject方法"><a href="#函数对象上的resolve和reject方法" class="headerlink" title="函数对象上的resolve和reject方法"></a>函数对象上的resolve和reject方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Promise函数对象的resolve方法</span></span><br><span class="line"><span class="comment"> * 如果收到的是个Promise对象，那么传递下去</span></span><br><span class="line"><span class="comment"> * 如果是一个值，就直接返回值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">value</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="variable">Promise</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">Promise</span>.resolve = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">      value.then(resolve, reject);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve(value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Promise函数对象的reject方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>reason </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="variable">Promise</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">Promise</span>.reject = <span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    reject(reason);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数对象上的all和race方法"><a href="#函数对象上的all和race方法" class="headerlink" title="函数对象上的all和race方法"></a>函数对象上的all和race方法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Promise函数对象的all方法</span></span><br><span class="line"><span class="comment"> * 所有成功才成功，只要一个失败则失败</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&lt;Promise&gt;&#125;</span> </span>promises promise的数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">Promise</span>.all = <span class="function"><span class="keyword">function</span> (<span class="params">promises</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 定义返回结果数组的长度，因为返回的数组要按照传入的数组</span></span><br><span class="line">  <span class="keyword">const</span> values = <span class="keyword">new</span> <span class="built_in">Array</span>(promises.length);</span><br><span class="line">  <span class="comment">// 计算器变量，保证 所有成功才成功</span></span><br><span class="line">  <span class="keyword">let</span> resolvedCount = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    promises.forEach(<span class="function">(<span class="params">promise, index</span>) =&gt;</span> &#123;</span><br><span class="line">      P.resolve(promise).then(</span><br><span class="line">        value =&gt; &#123;</span><br><span class="line">          <span class="comment">// 计数器增加</span></span><br><span class="line">          resolvedCount++;</span><br><span class="line">          <span class="comment">// 按数组顺序 塞进返回结果数组</span></span><br><span class="line">          values[index] = value;</span><br><span class="line">          <span class="keyword">if</span> (resolvedCount === promises.length) &#123;</span><br><span class="line">            resolve(values);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        reason =&gt; &#123;</span><br><span class="line">          reject(reason);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Promise函数对象的race方法</span></span><br><span class="line"><span class="comment"> * 第一个结束的 成功则成功 失败则失败</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&lt;Promise&gt;&#125;</span> </span>promises promise的数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">Promise</span>.race = <span class="function"><span class="keyword">function</span> (<span class="params">promises</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    promises.forEach(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">Promise</span>.resolve(promise).then(</span><br><span class="line">        value =&gt; &#123;</span><br><span class="line">          resolve(value);</span><br><span class="line">        &#125;,</span><br><span class="line">        reason =&gt; &#123;</span><br><span class="line">          reject(reason);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="完整的Promise"><a href="#完整的Promise" class="headerlink" title="完整的Promise"></a>完整的Promise</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">window</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 三个状态常量</span></span><br><span class="line">  <span class="keyword">const</span> PENDING = <span class="string">'pending'</span>, <span class="comment">// 等待</span></span><br><span class="line">    FULFILLED = <span class="string">'fulfilled'</span>, <span class="comment">// 成功</span></span><br><span class="line">    REJECTED = <span class="string">'rejected'</span>;   <span class="comment">// 失败</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise 类</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>excutor 执行器</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">Promise</span> = <span class="function">(<span class="params">excutor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 初始化状态</span></span><br><span class="line">    <span class="keyword">this</span>.state = PENDING;</span><br><span class="line">    <span class="comment">// 存储数据</span></span><br><span class="line">    <span class="keyword">this</span>.data = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 存储.then的回调函数 &#123;onFulfilled, onRejected&#125;</span></span><br><span class="line">    <span class="comment">// 可能多次.then，所以是一个数据</span></span><br><span class="line">    <span class="keyword">this</span>.callbacks = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * resolve 成功函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>value 成功的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    resolve = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 检查状态，保证状态只能改变一次</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.state !== PENDING) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 改状态</span></span><br><span class="line">      <span class="keyword">this</span>.state = FULFILLED;</span><br><span class="line">      <span class="comment">// 存数据</span></span><br><span class="line">      <span class="keyword">this</span>.data = value;</span><br><span class="line">      <span class="comment">// 检查回调，如果有，立即执行回调函数</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.callbacks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.callbacks.forEach(<span class="function"><span class="params">callbackObj</span> =&gt;</span> &#123;</span><br><span class="line">            callbackObj.onFulfilled(<span class="keyword">this</span>.data);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * reject 失败函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>reason 失败的原因</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    reject = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 查状态，保证状态只能改变一次</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.state !== PENDING) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 改状态</span></span><br><span class="line">      <span class="keyword">this</span>.state = REJECTED;</span><br><span class="line">      <span class="comment">// 存数据</span></span><br><span class="line">      <span class="keyword">this</span>.data = reason;</span><br><span class="line">      <span class="comment">// 检查回调，如果有，立即执行回调函数</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.callbacks.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.callbacks.forEach(<span class="function"><span class="params">callbackObj</span> =&gt;</span> &#123;</span><br><span class="line">            callbackObj.onRejected(<span class="keyword">this</span>.data);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      excutor(resolve, reject); <span class="comment">// 立即执行 执行器函数</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      reject(error); <span class="comment">// 异常就直接抛出</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 原型对象上的then方法</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>onFulfilled 获取成功的回调函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>onRejected 获取失败的回调函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>新的Promise对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 设置回调函数默认值（必须是函数），Promise继续传递的保障</span></span><br><span class="line">    onResolved = <span class="keyword">typeof</span> onResolved === <span class="string">'function'</span> ? onResolved : <span class="function"><span class="params">value</span> =&gt;</span> value;</span><br><span class="line">    onRejected = <span class="keyword">typeof</span> onRejected === <span class="string">'function'</span> ? onRejected : <span class="function"><span class="params">reason</span> =&gt;</span> &#123; <span class="keyword">throw</span> reason; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存当前Promise的this</span></span><br><span class="line">    <span class="keyword">const</span> that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="comment">// 返回一个新的Promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> handle = <span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 返回Promise的结果由onFulfilled或onRejected执行结果决定</span></span><br><span class="line"><span class="comment">         * 情况1.抛出异常 返回Promise的结果为异常，reason为异常</span></span><br><span class="line"><span class="comment">         * 情况2.返回的是Promise，返回Promise的结果就是这个Promise的结果</span></span><br><span class="line"><span class="comment">         * 情况3.返回的不是Promise，返回的Promise为成功，value就是返回值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> result = callback(that.data);</span><br><span class="line">          <span class="keyword">if</span> (result <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">            <span class="comment">// 情况2</span></span><br><span class="line">            result.then(resolve, reject);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 情况3</span></span><br><span class="line">            resolve(result);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="comment">// 情况1</span></span><br><span class="line">          reject(error);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (that.state = FULFILLED) &#123;</span><br><span class="line">        <span class="comment">// 立即异步执行成功的回调函数</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          handle(onFulfilled);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (that.state = REJECTED) &#123;</span><br><span class="line">        <span class="comment">// 立即异步执行失败的回调函数</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          handle(onRejected);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123; <span class="comment">// that.state = PENDING</span></span><br><span class="line">        <span class="comment">// 保存回调函数到callbacks中去</span></span><br><span class="line">        that.callbacks.push(&#123;</span><br><span class="line">          onFulfilled: handle(onFulfilled),</span><br><span class="line">          onRejected: handle(onRejected)</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 原型对象上的catch方法</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>onRejected 获取失败的回调函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;Promise&#125;</span> </span>新的Promise对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.prototype.catch = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">undefined</span>, onRejected);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise函数对象的resolve方法</span></span><br><span class="line"><span class="comment">   * 如果收到的是个Promise对象，那么传递下去</span></span><br><span class="line"><span class="comment">   * 如果是一个值，就直接返回值</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">value</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="variable">Promise</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.resolve = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">        value.then(resolve, reject);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolve(value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise函数对象的reject方法</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>reason </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="variable">Promise</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.reject = <span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      reject(reason);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise函数对象的all方法</span></span><br><span class="line"><span class="comment">   * 所有成功才成功，只要一个失败则失败</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Array&lt;Promise&gt;&#125;</span> </span>promises promise的数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.all = <span class="function"><span class="keyword">function</span> (<span class="params">promises</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 定义返回结果数组的长度，因为返回的数组要按照传入的数组</span></span><br><span class="line">    <span class="keyword">const</span> values = <span class="keyword">new</span> <span class="built_in">Array</span>(promises.length);</span><br><span class="line">    <span class="comment">// 计算器变量，保证 所有成功才成功</span></span><br><span class="line">    <span class="keyword">let</span> resolvedCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      promises.forEach(<span class="function">(<span class="params">promise, index</span>) =&gt;</span> &#123;</span><br><span class="line">        P.resolve(promise).then(</span><br><span class="line">          value =&gt; &#123;</span><br><span class="line">            <span class="comment">// 计数器增加</span></span><br><span class="line">            resolvedCount++;</span><br><span class="line">            <span class="comment">// 按数组顺序 塞进返回结果数组</span></span><br><span class="line">            values[index] = value;</span><br><span class="line">            <span class="keyword">if</span> (resolvedCount === promises.length) &#123;</span><br><span class="line">              resolve(values);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          reason =&gt; &#123;</span><br><span class="line">            reject(reason);</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Promise函数对象的race方法</span></span><br><span class="line"><span class="comment">   * 第一个结束的 成功则成功 失败则失败</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;Array&lt;Promise&gt;&#125;</span> </span>promises promise的数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="built_in">Promise</span>.race = <span class="function"><span class="keyword">function</span> (<span class="params">promises</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      promises.forEach(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">Promise</span>.resolve(promise).then(</span><br><span class="line">          value =&gt; &#123;</span><br><span class="line">            resolve(value);</span><br><span class="line">          &#125;,</span><br><span class="line">          reason =&gt; &#123;</span><br><span class="line">            reject(reason);</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.Promise = <span class="built_in">Promise</span>;</span><br><span class="line">&#125;)(<span class="built_in">window</span>); <span class="comment">// IIEF</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>Promise</tag>
        <tag>ES6+</tag>
      </tags>
  </entry>
  <entry>
    <title>查看和生成ssh公钥</title>
    <url>/2020/06/16/%E6%9F%A5%E7%9C%8B%E5%92%8C%E7%94%9F%E6%88%90ssh%E5%85%AC%E9%92%A5/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>遇到个git服务器是用ssh认证的方式，就需要把我生成的公钥发送给代码仓库管理员，让他帮我添加到服务器上，我就可以通过ssh自由地拉取和提交代码了。</p>
<a id="more"></a>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><blockquote>
<p>本文是针对Windows系统</p>
</blockquote>
<ol>
<li>检查<code>C:\Users\username\.ssh</code>目录下是否已经存在ssh公钥，<br>如果存在，就直接用，后续步骤就不用过了。</li>
<li>打开git bash的命令行窗口，输入指令<code>ssh-keygen</code>。</li>
<li>确认存放公钥的地址，默认就是上面说的路径，直接回车确认；<br>输入密码和确认密码，如果不想设置密码，直接不输入内容回车。</li>
<li>在指定目录下会生成<code>id_rsa</code>和<code>id_ras.pub</code>两个文件，<br><code>id_rsa.pub</code>发给仓库管理员，<code>id_ras</code>自己收好。</li>
</ol>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx基础-5:SSL配置</title>
    <url>/2020/06/03/Nginx%E5%9F%BA%E7%A1%80-5-SSL%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>为了安全性，需要配置SSL。配置后就可以使用https来访问。</p>
<h2 id="生成密钥"><a href="#生成密钥" class="headerlink" title="生成密钥"></a>生成密钥</h2><p>下载安装OpenSSL</p>
<p>然后进入到<code>OpenSSL-Win64\bin</code>目录下，执行exe文件。</p>
<p>看到命令行窗口。</p>
<a id="more"></a>
<ol>
<li>使用命令生成一个key文件<br>需要输入一个密码：123456（以后会用到）</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">genrsa -idea -out geodaoyu.key 1024</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>使用命令导出一个csr文件<br>需要输入个人信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">req -new -key geodaoyu.key -out geodaoyu.csr</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用命令把key和csr打包成crt文件<br>需要输入到第一步给的密码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">x509 -req -days 3650 -in geodaoyu.csr -signkey geodaoyu.key -out geodaoyu.crt</span><br></pre></td></tr></table></figure>



</li>
</ol>
<p>发现这个key在window系统不能用，只好换个指令</p>
<ol start="4">
<li><p>使用命令，一次性生成key和crt<br>同样需要输入个人信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">req -days 3650 -x509 -sha256 -nodes -newkey rsa:1024 -keyout geodaoyu.key -out geodaoyu.crt</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>修改<code>nginx.conf</code>中的server</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name  geodaoyu.arcgisonline.cn;</span><br><span class="line"></span><br><span class="line">    ssl_certificate      C:&#x2F;Application&#x2F;nginx-1.17.6&#x2F;ssl&#x2F;geodaoyu.crt;</span><br><span class="line">    ssl_certificate_key  C:&#x2F;Application&#x2F;nginx-1.17.6&#x2F;ssl&#x2F;geodaoyu.key;</span><br><span class="line"></span><br><span class="line">    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        root   html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">    location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">        root   html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>前端应用唤起桌面应用</title>
    <url>/2023/09/22/%E5%89%8D%E7%AB%AF%E5%BA%94%E7%94%A8%E5%94%A4%E8%B5%B7%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>某测绘院购买了高拍仪，需要在前端应用中唤起高拍仪的软件。<br>环境是 win10，本机已安装高拍仪软件。</p>
<a id="more"></a>

<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>注册唤起协议到注册表<br>写一个 RegisterCometApp.reg 文件</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line">[HKEY_CLASSES_ROOT\Comet]</span><br><span class="line">&quot;URL Protocol&quot;&#x3D;&quot;&quot;</span><br><span class="line">@&#x3D;&quot;Comet&quot;</span><br><span class="line">[HKEY_CLASSES_ROOT\Comet\DefaultIcon]</span><br><span class="line">@&#x3D;&quot;C:\\Program Files\\Comet Scanner\\comet.exe&quot;</span><br><span class="line">[HKEY_CLASSES_ROOT\Comet\shell]</span><br><span class="line">[HKEY_CLASSES_ROOT\Comet\shell\open]</span><br><span class="line">[HKEY_CLASSES_ROOT\Comet\shell\open\command]</span><br><span class="line">@&#x3D;&quot;\&quot;C:\\Program Files\\Comet Scanner\\comet.exe\&quot; &quot;</span><br></pre></td></tr></table></figure>

<p>把其中的两处 exe 路径改为实际路径，然后双击 RegisterCometApp.reg 文件，将其添加到注册表。 </p>
<ol start="2">
<li>前端应用通过协议唤起软件<br>测试页面，可以用点击事件，也可以用 a 标签。</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"window.location.href='Comet:'"</span>&gt;</span>唤起App<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>Register</tag>
      </tags>
  </entry>
  <entry>
    <title>空心矩形样式</title>
    <url>/2020/09/02/%E7%A9%BA%E5%BF%83%E7%9F%A9%E5%BD%A2%E6%A0%B7%E5%BC%8F/</url>
    <content><![CDATA[<p>UI设计了一个空心矩形样式，所以这边找了段CSS代码来实现：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">80px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: red;</span><br><span class="line">  <span class="attribute">background-clip</span>: content-box;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">40px</span> solid orange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><code>background-color</code>—控制圆心颜色.</li>
<li><code>background-clip</code>—规定背景的绘制区域.</li>
<li><code>border</code>— 控制外环大小和颜色.<a id="more"></a>
<blockquote>
<p>注：如果不设置<code>background-clip</code>，在border有透明度的时候，会透到下方的background，这也证明background默认是包括了border的。</p>
</blockquote>
</li>
</ul>
<p>实现效果如下：</p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20200902174907882.png" alt="image-20200902174907882"></p>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>border</tag>
        <tag>background</tag>
      </tags>
  </entry>
  <entry>
    <title>空心圆样式</title>
    <url>/2020/08/13/%E7%A9%BA%E5%BF%83%E5%9C%86%E6%A0%B7%E5%BC%8F/</url>
    <content><![CDATA[<p>UI设计了一个空心圆样式，所以这边找了段CSS代码来实现：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: red;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">20px</span> solid orange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><p><code>background-color</code>—控制圆心颜色.</p>
</li>
<li><p><code>border-radius</code>— 控制圆角.</p>
</li>
<li><p><code>border</code>— 控制圆环大小和颜色.</p>
<a id="more"></a>

</li>
</ul>
<p>实现效果如下：</p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20200813175112338.png" alt="image-20200813175112338"></p>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>border</tag>
      </tags>
  </entry>
  <entry>
    <title>在npm上发布一个包</title>
    <url>/2021/08/14/%E5%9C%A8npm%E4%B8%8A%E5%8F%91%E5%B8%83%E4%B8%80%E4%B8%AA%E5%8C%85/</url>
    <content><![CDATA[<p>在学习ArcGIS JS API的过程中，我尝试自己来实现一个esri/core/Accessor类。所以我这么做了，并且把它做成了一个基类发布到了npm上。</p>
<p>这里主要记录如何发布一个包到npm上。</p>
<a id="more"></a>

<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>首先创建一个项目，正常的<code>npm init -y</code>初始化就好。然后传到仓库。比如我传到了GitHub。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>先安装你的依赖（如果你有依赖的话），和填写<code>README.md</code>、<code>LICENSE</code>等。</p>
<p>然后我需要配置<code>package.json</code>和<code>tsconfig.json</code>。</p>
<p><code>package.json</code>：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"@geodaoyu/accessor"</span>, <span class="comment">// 包名，比如要安装当前包，则 npm i @geodaoyu/accessor</span></span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.1"</span>, <span class="comment">// 版本号，a b c三位</span></span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"Implement esri/core/Accessor by myself."</span>, <span class="comment">// 描述</span></span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>, <span class="comment">// 主文件地址</span></span><br><span class="line">  <span class="attr">"module"</span>: <span class="string">"dist/index.js"</span>, <span class="comment">// 导出的模块地址</span></span><br><span class="line">  <span class="attr">"scripts"</span>: &#123; <span class="comment">// 脚本命令，我这里只写了两个，通过npm run来执行</span></span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"npx tsc"</span>, <span class="comment">// 打包编译，因为我是ts库</span></span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"mocha"</span> <span class="comment">// mocha做测试</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"keywords"</span>: [ <span class="comment">// 关键字，方便别人检索</span></span><br><span class="line">    <span class="string">"Accessor"</span>,</span><br><span class="line">    <span class="string">"Esri"</span>,</span><br><span class="line">    <span class="string">"ArcGIS"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"GeoDaoyu"</span>, <span class="comment">// 作者</span></span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"MIT"</span>, <span class="comment">// 许可</span></span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"module"</span>, <span class="comment">// 类型</span></span><br><span class="line">  <span class="attr">"repository"</span>: &#123; <span class="comment">// git仓库地址</span></span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"git"</span>,</span><br><span class="line">    <span class="attr">"url"</span>: <span class="string">"https://github.com/GeoDaoyu/Accessor.git"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123; <span class="comment">// 开发依赖</span></span><br><span class="line">    <span class="attr">"mocha"</span>: <span class="string">"^8.3.2"</span>,</span><br><span class="line">    <span class="attr">"typescript"</span>: <span class="string">"^4.2.4"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>tsconfig.json</code>：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"experimentalDecorators"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"ESNext"</span>,</span><br><span class="line">    <span class="attr">"target"</span>: <span class="string">"ESNext"</span>,</span><br><span class="line">    <span class="attr">"sourceMap"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"rootDir"</span>: <span class="string">"./src"</span>, <span class="comment">// 根地址</span></span><br><span class="line">    <span class="attr">"outDir"</span>: <span class="string">"./dist"</span>, <span class="comment">// 输出地址</span></span><br><span class="line">    <span class="attr">"esModuleInterop"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"declaration"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"skipLibCheck"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"moduleResolution"</span>: <span class="string">"node"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"include"</span>: [</span><br><span class="line">    <span class="string">"src/**/*.ts"</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"exclude"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h2><p>然后就是正常的编写你的代码。调试通过<code>node</code>来调试。</p>
<h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><p>编写<code>xxx.test.js</code>等测试代码，然后<code>npm run test</code>来测试。</p>
<h2 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h2><p>需要一个npm的账号，然后<code>npm publish</code>即可发布。</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>npm</tag>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title>禁止自动填充密码框</title>
    <url>/2023/09/22/%E7%A6%81%E6%AD%A2%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85%E5%AF%86%E7%A0%81%E6%A1%86/</url>
    <content><![CDATA[<p>浏览器设置可以自动填充密码，有时候很有用，有时候很讨厌。<br>这里记录一个通过HTML属性禁用自动填充密码的方法。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Input</span><br><span class="line">  autoComplete=<span class="string">"new-password"</span></span><br><span class="line">  type=<span class="string">"password"</span></span><br><span class="line">  placeholder=<span class="string">"密码"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>视频融合</title>
    <url>/2020/11/25/%E8%A7%86%E9%A2%91%E8%9E%8D%E5%90%88/</url>
    <content><![CDATA[<p>项目中有使用到视频融合，记录实现过程。</p>
<p>视频融合简单来讲就是在地图中接入一个视频。视频如地图中的要素一般。</p>
<p>效果图如下：</p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20201124103009147.png" alt="image-20201124103009147"></p>
<a id="more"></a>
<h2 id="实现基础"><a href="#实现基础" class="headerlink" title="实现基础"></a>实现基础</h2><p>ArcGIS JS API 提供了一个类，externalRenderers，可以在地图中接入第三方的WebGL（原生WebGL，或者是WebGL的库，如three）。</p>
<p>three中可以轻松的实现，用WebGL加载视频。</p>
<h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><p>分两步，第一步：在three中实现加载视频；第二步：把写好的three程序集成到地图中。</p>
<h2 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h2><p>这是第一次接触three，所以照官网写了一个入门例子，一个旋转的正方体。代码放在附件（附1）中。</p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20201124103927627.png" alt="image-20201124103927627"></p>
<p>需要理解three中的一些概念：</p>
<ul>
<li>Scene：场景</li>
<li>Camera：相机</li>
<li>Geometry：图形（骨架）</li>
<li>Material：材质（衣服）</li>
<li>Mesh：三维模型（骨架+衣服）</li>
<li>Light：光源</li>
</ul>
<p>three提供了一个类，VideoTexture，可以将视频作为纹理贴图到三维模型上。代码放在附件（附2）中。</p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20201124104810141.png" alt="image-20201124104810141"></p>
<p>通过externalRenderers 将three程序集成到地图中。代码放在附件（附3）中。</p>
<p>参数说明写到了代码注释中。</p>
<p>每当地图视图更新时，会进入到externalRenderer 的render函数进行渲染。如果是three中模型的动画，则要放到这个函数中处理，添加了一个three动画的示例代码，放在附件（附4）中。</p>
<p><img src="https://gitee.com/GeoDaoyu/PicGo/raw/master/blog/image-20201124140554690.png" alt="image-20201124140554690"></p>
<h2 id="附件"><a href="#附件" class="headerlink" title="附件"></a>附件</h2><blockquote>
<p>注：THREE-123dev，ArcGIS JS API-4.16</p>
</blockquote>
<h3 id="附1：旋转的正方体"><a href="#附1：旋转的正方体" class="headerlink" title="附1：旋转的正方体"></a>附1：旋转的正方体</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>My first three.js app<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">		body &#123;</span><br><span class="line">			margin: 0;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		canvas &#123;</span><br><span class="line">			display: block;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./three.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">		<span class="comment">// 创建scene和camera</span></span></span><br><span class="line"><span class="actionscript">		<span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</span></span><br><span class="line"><span class="javascript">		<span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">75</span>, <span class="built_in">window</span>.innerWidth / <span class="built_in">window</span>.innerHeight, <span class="number">0.1</span>, <span class="number">1000</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 创建renderer，并添加到页面上</span></span></span><br><span class="line"><span class="actionscript">		<span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</span></span><br><span class="line"><span class="javascript">		renderer.setSize(<span class="built_in">window</span>.innerWidth, <span class="built_in">window</span>.innerHeight);</span></span><br><span class="line"><span class="javascript">		<span class="built_in">document</span>.body.appendChild(renderer.domElement);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">		<span class="comment">// 创建形状和材质</span></span></span><br><span class="line"><span class="actionscript">		<span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.BoxGeometry();</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">const</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial(&#123;</span></span><br><span class="line">			color: 0x00ff00</span><br><span class="line">		&#125;);</span><br><span class="line"><span class="actionscript">		<span class="comment">// 创建三维模型</span></span></span><br><span class="line"><span class="actionscript">		<span class="keyword">const</span> cube = <span class="keyword">new</span> THREE.Mesh(geometry, material);</span></span><br><span class="line">		scene.add(cube);</span><br><span class="line"></span><br><span class="line">		camera.position.z = 5;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">		<span class="keyword">const</span> animate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line">			requestAnimationFrame(animate);</span><br><span class="line"></span><br><span class="line">			cube.rotation.x += 0.01;</span><br><span class="line">			cube.rotation.y += 0.01;</span><br><span class="line"></span><br><span class="line">			renderer.render(scene, camera);</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		animate();</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="附2：视频贴图"><a href="#附2：视频贴图" class="headerlink" title="附2：视频贴图"></a>附2：视频贴图</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>video in THREE<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    body &#123;</span><br><span class="line">      margin: 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    canvas &#123;</span><br><span class="line">      display: block;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    video &#123;</span><br><span class="line">      position: absolute;</span><br><span class="line">      left: 10px;</span><br><span class="line">      bottom: 10px;</span><br><span class="line">      width: 300px;</span><br><span class="line">      height: 300px;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./three.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// 创建scene和camera</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> scene = <span class="keyword">new</span> THREE.Scene();</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">75</span>, <span class="built_in">window</span>.innerWidth / <span class="built_in">window</span>.innerHeight, <span class="number">0.1</span>, <span class="number">1000</span>);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 创建renderer，并添加到页面上</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</span></span><br><span class="line"><span class="javascript">    renderer.setSize(<span class="built_in">window</span>.innerWidth, <span class="built_in">window</span>.innerHeight);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.body.appendChild(renderer.domElement);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 创建视频</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> video = <span class="built_in">document</span>.createElement(<span class="string">"video"</span>);</span></span><br><span class="line"><span class="actionscript">    video.crossOrigin = <span class="string">"anonymous"</span>;</span></span><br><span class="line"><span class="actionscript">    video.loop = <span class="literal">true</span>;</span></span><br><span class="line"><span class="actionscript">    video.muted = <span class="literal">true</span>;</span></span><br><span class="line"><span class="actionscript">    video.src = <span class="string">'./video.mp4'</span>;</span></span><br><span class="line">    video.play();</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 创建视频贴纸</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> texture = <span class="keyword">new</span> THREE.VideoTexture(video);</span></span><br><span class="line">    texture.minFilter = THREE.LinearFilter;</span><br><span class="line">    texture.magFilter = THREE.LinearFilter;</span><br><span class="line">    texture.format = THREE.RGBFormat;</span><br><span class="line"><span class="actionscript">    texture.generateMipmaps = <span class="literal">false</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 创建形状和材质</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> geometry = <span class="keyword">new</span> THREE.BoxGeometry(); <span class="comment">// 六面体</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> materialArray = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">6</span>).fill(<span class="keyword">new</span> THREE.MeshBasicMaterial(&#123;</span></span><br><span class="line">      map: texture</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 创建三维模型</span></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> cube = <span class="keyword">new</span> THREE.Mesh(geometry, materialArray);</span></span><br><span class="line">    scene.add(cube);</span><br><span class="line"></span><br><span class="line">    camera.position.z = 5;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> animate = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line">      if (video.readyState === video.HAVE_ENOUGH_DATA) &#123;</span><br><span class="line">        if (texture) &#123;</span><br><span class="line"><span class="actionscript">          texture.needsUpdate = <span class="literal">true</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      requestAnimationFrame(animate);</span><br><span class="line">      renderer.render(scene, camera);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    animate();</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="附3：视频融合"><a href="#附3：视频融合" class="headerlink" title="附3：视频融合"></a>附3：视频融合</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"initial-scale=1, maximum-scale=1, user-scalable=no"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Use three.js from an external renderer<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    html,</span><br><span class="line">    body,</span><br><span class="line"><span class="css">    <span class="selector-id">#viewDiv</span> &#123;</span></span><br><span class="line">      padding: 0;</span><br><span class="line">      margin: 0;</span><br><span class="line">      height: 100%;</span><br><span class="line">      width: 100%;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"../jsapi/4.16/esri/css/main.css"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- three要在ArcGIS 之前，不然会报错 multipleDefine --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"./three.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"../jsapi/4.16/dojo/dojo.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">require</span>([</span></span><br><span class="line"><span class="actionscript">      <span class="string">"esri/Map"</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="string">"esri/views/SceneView"</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="string">"esri/views/3d/externalRenderers"</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="string">"esri/geometry/SpatialReference"</span>,</span></span><br><span class="line"><span class="actionscript">    ], <span class="function"><span class="keyword">function</span> <span class="params">(</span></span></span></span><br><span class="line">      EsriMap,</span><br><span class="line">      SceneView,</span><br><span class="line">      externalRenderers,</span><br><span class="line">      SpatialReference,</span><br><span class="line">    ) &#123;</span><br><span class="line"><span class="actionscript">      <span class="comment">// Create a map</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">//////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> map = <span class="keyword">new</span> EsriMap(&#123;</span></span><br><span class="line"><span class="actionscript">        basemap: <span class="string">"gray"</span>,</span></span><br><span class="line"><span class="actionscript">        ground: <span class="string">"world-elevation"</span></span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// Create a SceneView</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">//////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> view = <span class="keyword">new</span> SceneView(&#123;</span></span><br><span class="line"><span class="actionscript">        container: <span class="string">"viewDiv"</span>,</span></span><br><span class="line">        map: map,</span><br><span class="line"><span class="actionscript">        viewingMode: <span class="string">"global"</span>,</span></span><br><span class="line">        camera: &#123;</span><br><span class="line">          position: &#123;</span><br><span class="line">            x: 12979966.298703134,</span><br><span class="line">            y: 4884427.262489007,</span><br><span class="line">            z: 2548.834649768658,</span><br><span class="line">            spatialReference: &#123;</span><br><span class="line">              wkid: 102100</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          heading: 352.94663895458274,</span><br><span class="line">          tilt: 48.19183381946247</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> geoData = [<span class="number">116.5968704223633</span>, <span class="number">40.15447407601198</span>, <span class="number">100.2</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// Disable lighting based on the current camera position.</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">// We want to display the lighting according to the current time of day.</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">// view.environment.lighting.cameraTrackingEnabled = false;</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// Create our custom external renderer</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">//////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> externalRenderer = &#123;</span></span><br><span class="line"><span class="actionscript">        renderer: <span class="literal">null</span>, <span class="comment">// three.js renderer</span></span></span><br><span class="line"><span class="actionscript">        camera: <span class="literal">null</span>, <span class="comment">// three.js camera</span></span></span><br><span class="line"><span class="actionscript">        scene: <span class="literal">null</span>, <span class="comment">// three.js scene</span></span></span><br><span class="line"><span class="actionscript">        ambient: <span class="literal">null</span>, <span class="comment">// three.js ambient light source</span></span></span><br><span class="line"><span class="actionscript">        sun: <span class="literal">null</span>, <span class="comment">// three.js sun light source</span></span></span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line"><span class="javascript">         * Setup <span class="function"><span class="keyword">function</span>, <span class="title">called</span> <span class="title">once</span> <span class="title">by</span> <span class="title">the</span> <span class="title">ArcGIS</span> <span class="title">JS</span> <span class="title">API</span>.</span></span></span><br><span class="line">         */</span><br><span class="line"><span class="actionscript">        setup: <span class="function"><span class="keyword">function</span> <span class="params">(context)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// initialize the three.js renderer</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">//////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer = <span class="keyword">new</span> THREE.WebGLRenderer(&#123;</span></span><br><span class="line">            context: context.gl,</span><br><span class="line"><span class="actionscript">            premultipliedAlpha: <span class="literal">false</span>,</span></span><br><span class="line">          &#125;);</span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.renderer.setPixelRatio(<span class="built_in">window</span>.devicePixelRatio);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer.setViewport(<span class="number">0</span>, <span class="number">0</span>, view.width, view.height);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// prevent three.js from clearing the buffers provided by the ArcGIS JS API.</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer.autoClear = <span class="literal">false</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// The ArcGIS JS API renders to custom offscreen buffers, and not to the default framebuffers.</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// We have to inject this bit of code into the three.js runtime in order for it to bind those</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// buffers instead of the default ones.</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> originalSetRenderTarget = <span class="keyword">this</span>.renderer.setRenderTarget.bind(</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.renderer</span></span><br><span class="line">          );</span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer.setRenderTarget = <span class="function"><span class="keyword">function</span> <span class="params">(target)</span> </span>&#123;</span></span><br><span class="line">            originalSetRenderTarget(target);</span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (target == <span class="literal">null</span>) &#123;</span></span><br><span class="line">              context.bindRenderTarget();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// setup the three.js scene</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.scene = <span class="keyword">new</span> THREE.Scene();</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// 添加辅助坐标轴，当只有一个三维模型的时候必须添加，不明原因</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.scene.add(<span class="keyword">new</span> THREE.AxesHelper(<span class="number">9000000</span>));</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// setup the camera</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.camera = <span class="keyword">new</span> THREE.PerspectiveCamera();</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// setup scene lighting</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.ambient = <span class="keyword">new</span> THREE.AmbientLight(<span class="number">0xffffff</span>, <span class="number">0.5</span>);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.scene.add(<span class="keyword">this</span>.ambient);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.sun = <span class="keyword">new</span> THREE.DirectionalLight(<span class="number">0xffffff</span>, <span class="number">0.5</span>);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.scene.add(<span class="keyword">this</span>.sun);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// 创建面</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> geometry = <span class="keyword">new</span> THREE.PlaneGeometry(<span class="number">500</span>, <span class="number">500</span>); <span class="comment">// 矩形平面</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// 创建视频</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> video = <span class="built_in">document</span>.createElement(<span class="string">"video"</span>);</span></span><br><span class="line"><span class="actionscript">          video.crossOrigin = <span class="string">"anonymous"</span>;</span></span><br><span class="line"><span class="actionscript">          video.loop = <span class="literal">true</span>;</span></span><br><span class="line"><span class="actionscript">          video.muted = <span class="literal">true</span>;</span></span><br><span class="line"><span class="actionscript">          video.src = <span class="string">'./video.mp4'</span>;</span></span><br><span class="line">          video.play();</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> texture = <span class="keyword">new</span> THREE.VideoTexture(video);</span></span><br><span class="line">          texture.minFilter = THREE.LinearFilter;</span><br><span class="line">          texture.magFilter = THREE.LinearFilter;</span><br><span class="line">          texture.format = THREE.RGBFormat;</span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> material = <span class="keyword">new</span> THREE.MeshPhongMaterial(&#123;</span></span><br><span class="line"><span class="actionscript">            map: texture, <span class="comment">// 设置纹理贴图</span></span></span><br><span class="line">            side: THREE.DoubleSide</span><br><span class="line">          &#125;);</span><br><span class="line"><span class="actionscript">          <span class="comment">// 创建网格对象</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> meshObj = <span class="keyword">new</span> THREE.Mesh(geometry, material);</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// 坐标转换</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> transform = <span class="keyword">new</span> THREE.Matrix4();</span></span><br><span class="line">          transform.fromArray(</span><br><span class="line">            externalRenderers.renderCoordinateTransformAt(</span><br><span class="line">              view,</span><br><span class="line">              geoData,</span><br><span class="line">              SpatialReference.WGS84,</span><br><span class="line"><span class="javascript">              <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">16</span>)</span></span><br><span class="line">            )</span><br><span class="line">          );</span><br><span class="line"><span class="actionscript">          <span class="comment">// A reference to an array where the 16 matrix elements will be stored. </span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// The resulting matrix follows OpenGL conventions where the translation components occupy </span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// the 13th, 14th and 15th elements. If undefined, a newly created matrix returned.</span></span></span><br><span class="line">          meshObj.position.x = transform.elements[12];</span><br><span class="line">          meshObj.position.y = transform.elements[13];</span><br><span class="line">          meshObj.position.z = transform.elements[14];</span><br><span class="line"><span class="actionscript">          <span class="comment">// 旋转网格对象</span></span></span><br><span class="line"><span class="javascript">          meshObj.rotation.z = -<span class="built_in">Math</span>.asin(</span></span><br><span class="line"><span class="javascript">            <span class="built_in">Math</span>.cos((geoData[<span class="number">1</span>] / <span class="number">180</span>) * <span class="built_in">Math</span>.PI) *</span></span><br><span class="line"><span class="javascript">            <span class="built_in">Math</span>.cos((geoData[<span class="number">0</span>] / <span class="number">180</span>) * <span class="built_in">Math</span>.PI)</span></span><br><span class="line">          );</span><br><span class="line"><span class="javascript">          meshObj.rotation.x = <span class="built_in">Math</span>.atan(</span></span><br><span class="line"><span class="javascript">            <span class="built_in">Math</span>.tan((geoData[<span class="number">1</span>] / <span class="number">180</span>) * <span class="built_in">Math</span>.PI) /</span></span><br><span class="line"><span class="javascript">            <span class="built_in">Math</span>.sin((geoData[<span class="number">0</span>] / <span class="number">180</span>) * <span class="built_in">Math</span>.PI)</span></span><br><span class="line">          );</span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.scene.add(meshObj);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// cleanup after ourselves</span></span></span><br><span class="line">          context.resetWebGLState();</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        render: <span class="function"><span class="keyword">function</span> <span class="params">(context)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// update camera parameters</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">///////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> cam = context.camera;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.camera.position.set(cam.eye[<span class="number">0</span>], cam.eye[<span class="number">1</span>], cam.eye[<span class="number">2</span>]);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.camera.up.set(cam.up[<span class="number">0</span>], cam.up[<span class="number">1</span>], cam.up[<span class="number">2</span>]);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.camera.lookAt(</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">new</span> THREE.Vector3(cam.center[<span class="number">0</span>], cam.center[<span class="number">1</span>], cam.center[<span class="number">2</span>])</span></span><br><span class="line">          );</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// Projection matrix can be copied directly</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.camera.projectionMatrix.fromArray(cam.projectionMatrix);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// update lighting</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">/////////////////////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="javascript">          view.environment.lighting.date = <span class="built_in">Date</span>.now();</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> l = context.sunLight;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.sun.position.set(l.direction[<span class="number">0</span>], l.direction[<span class="number">1</span>], l.direction[<span class="number">2</span>]);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.sun.intensity = l.diffuse.intensity;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.sun.color = <span class="keyword">new</span> THREE.Color(</span></span><br><span class="line">            l.diffuse.color[0],</span><br><span class="line">            l.diffuse.color[1],</span><br><span class="line">            l.diffuse.color[2]</span><br><span class="line">          );</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.ambient.intensity = l.ambient.intensity;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.ambient.color = <span class="keyword">new</span> THREE.Color(</span></span><br><span class="line">            l.ambient.color[0],</span><br><span class="line">            l.ambient.color[1],</span><br><span class="line">            l.ambient.color[2]</span><br><span class="line">          );</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// draw the scene</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">/////////////////////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer.state.reset(); <span class="comment">// this.renderer.resetGLState();</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer.render(<span class="keyword">this</span>.scene, <span class="keyword">this</span>.camera);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// as we want to smoothly animate the ISS movement, immediately request a re-render</span></span></span><br><span class="line">          externalRenderers.requestRender(view);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// cleanup</span></span></span><br><span class="line">          context.resetWebGLState();</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// register the external renderer</span></span></span><br><span class="line">      externalRenderers.add(view, externalRenderer);</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"viewDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="附4：简易动画"><a href="#附4：简易动画" class="headerlink" title="附4：简易动画"></a>附4：简易动画</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"initial-scale=1, maximum-scale=1, user-scalable=no"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>animate<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    html,</span><br><span class="line">    body,</span><br><span class="line"><span class="css">    <span class="selector-id">#viewDiv</span> &#123;</span></span><br><span class="line">      padding: 0;</span><br><span class="line">      margin: 0;</span><br><span class="line">      height: 100%;</span><br><span class="line">      width: 100%;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"../jsapi/4.16/esri/css/main.css"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- three要在ArcGIS 之前，不然会报错 multipleDefine --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"./three.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"../jsapi/4.16/dojo/dojo.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">require</span>([</span></span><br><span class="line"><span class="actionscript">      <span class="string">"esri/Map"</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="string">"esri/views/SceneView"</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="string">"esri/views/3d/externalRenderers"</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="string">"esri/geometry/SpatialReference"</span>,</span></span><br><span class="line"><span class="actionscript">    ], <span class="function"><span class="keyword">function</span> <span class="params">(</span></span></span></span><br><span class="line">      EsriMap,</span><br><span class="line">      SceneView,</span><br><span class="line">      externalRenderers,</span><br><span class="line">      SpatialReference,</span><br><span class="line">    ) &#123;</span><br><span class="line"><span class="actionscript">      <span class="comment">// Create a map</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">//////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> map = <span class="keyword">new</span> EsriMap(&#123;</span></span><br><span class="line"><span class="actionscript">        basemap: <span class="string">"gray"</span>,</span></span><br><span class="line"><span class="actionscript">        ground: <span class="string">"world-elevation"</span></span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// Create a SceneView</span></span></span><br><span class="line"><span class="actionscript">      <span class="comment">//////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> view = <span class="keyword">new</span> SceneView(&#123;</span></span><br><span class="line"><span class="actionscript">        container: <span class="string">"viewDiv"</span>,</span></span><br><span class="line">        map: map,</span><br><span class="line"><span class="actionscript">        viewingMode: <span class="string">"global"</span>,</span></span><br><span class="line">        camera: &#123;</span><br><span class="line">          position: &#123;</span><br><span class="line">            x: 12979966.298703134,</span><br><span class="line">            y: 4884427.262489007,</span><br><span class="line">            z: 2548.834649768658,</span><br><span class="line">            spatialReference: &#123;</span><br><span class="line">              wkid: 102100</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          heading: 352.94663895458274,</span><br><span class="line">          tilt: 48.19183381946247</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> geoData = [<span class="number">116.5968704223633</span>, <span class="number">40.15447407601198</span>, <span class="number">100.2</span>];</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> externalRenderer = &#123;</span></span><br><span class="line"><span class="actionscript">        renderer: <span class="literal">null</span>, <span class="comment">// three.js renderer</span></span></span><br><span class="line"><span class="actionscript">        camera: <span class="literal">null</span>, <span class="comment">// three.js camera</span></span></span><br><span class="line"><span class="actionscript">        scene: <span class="literal">null</span>, <span class="comment">// three.js scene</span></span></span><br><span class="line"><span class="actionscript">        ambient: <span class="literal">null</span>, <span class="comment">// three.js ambient light source</span></span></span><br><span class="line"><span class="actionscript">        sun: <span class="literal">null</span>, <span class="comment">// three.js sun light source</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        meshObj: <span class="literal">null</span>, <span class="comment">// 缓存三维模型，动画是改变其位置参数</span></span></span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line"><span class="javascript">         * Setup <span class="function"><span class="keyword">function</span>, <span class="title">called</span> <span class="title">once</span> <span class="title">by</span> <span class="title">the</span> <span class="title">ArcGIS</span> <span class="title">JS</span> <span class="title">API</span>.</span></span></span><br><span class="line">         */</span><br><span class="line"><span class="actionscript">        setup: <span class="function"><span class="keyword">function</span> <span class="params">(context)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// initialize the three.js renderer</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">//////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer = <span class="keyword">new</span> THREE.WebGLRenderer(&#123;</span></span><br><span class="line">            context: context.gl,</span><br><span class="line"><span class="actionscript">            premultipliedAlpha: <span class="literal">false</span>,</span></span><br><span class="line">          &#125;);</span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.renderer.setPixelRatio(<span class="built_in">window</span>.devicePixelRatio);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer.setViewport(<span class="number">0</span>, <span class="number">0</span>, view.width, view.height);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// prevent three.js from clearing the buffers provided by the ArcGIS JS API.</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer.autoClear = <span class="literal">false</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// The ArcGIS JS API renders to custom offscreen buffers, and not to the default framebuffers.</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// We have to inject this bit of code into the three.js runtime in order for it to bind those</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// buffers instead of the default ones.</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> originalSetRenderTarget = <span class="keyword">this</span>.renderer.setRenderTarget.bind(</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.renderer</span></span><br><span class="line">          );</span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer.setRenderTarget = <span class="function"><span class="keyword">function</span> <span class="params">(target)</span> </span>&#123;</span></span><br><span class="line">            originalSetRenderTarget(target);</span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (target == <span class="literal">null</span>) &#123;</span></span><br><span class="line">              context.bindRenderTarget();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// setup the three.js scene</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.scene = <span class="keyword">new</span> THREE.Scene();</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// 添加辅助坐标轴，当只有一个三维模型的时候必须添加，不明原因</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.scene.add(<span class="keyword">new</span> THREE.AxesHelper(<span class="number">9000000</span>));</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// setup the camera</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.camera = <span class="keyword">new</span> THREE.PerspectiveCamera();</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// setup scene lighting</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.ambient = <span class="keyword">new</span> THREE.AmbientLight(<span class="number">0xffffff</span>, <span class="number">0.5</span>);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.scene.add(<span class="keyword">this</span>.ambient);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.sun = <span class="keyword">new</span> THREE.DirectionalLight(<span class="number">0xffffff</span>, <span class="number">0.5</span>);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.scene.add(<span class="keyword">this</span>.sun);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// 创建面</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> geometry = <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>); <span class="comment">// 矩形平面</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">const</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial(&#123;</span></span><br><span class="line">            color: 0x00ff00</span><br><span class="line">          &#125;);</span><br><span class="line"><span class="actionscript">          <span class="comment">// 创建网格对象</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> meshObj = <span class="keyword">new</span> THREE.Mesh(geometry, material);</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// 坐标转换</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> transform = <span class="keyword">new</span> THREE.Matrix4();</span></span><br><span class="line">          transform.fromArray(</span><br><span class="line">            externalRenderers.renderCoordinateTransformAt(</span><br><span class="line">              view,</span><br><span class="line">              geoData,</span><br><span class="line">              SpatialReference.WGS84,</span><br><span class="line"><span class="javascript">              <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">16</span>)</span></span><br><span class="line">            )</span><br><span class="line">          );</span><br><span class="line"><span class="actionscript">          <span class="comment">// A reference to an array where the 16 matrix elements will be stored. </span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// The resulting matrix follows OpenGL conventions where the translation components occupy </span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// the 13th, 14th and 15th elements. If undefined, a newly created matrix returned.</span></span></span><br><span class="line">          meshObj.position.x = transform.elements[12];</span><br><span class="line">          meshObj.position.y = transform.elements[13];</span><br><span class="line">          meshObj.position.z = transform.elements[14];</span><br><span class="line"><span class="actionscript">          <span class="comment">// 旋转网格对象</span></span></span><br><span class="line"><span class="javascript">          meshObj.rotation.z = -<span class="built_in">Math</span>.asin(</span></span><br><span class="line"><span class="javascript">            <span class="built_in">Math</span>.cos((geoData[<span class="number">1</span>] / <span class="number">180</span>) * <span class="built_in">Math</span>.PI) *</span></span><br><span class="line"><span class="javascript">            <span class="built_in">Math</span>.cos((geoData[<span class="number">0</span>] / <span class="number">180</span>) * <span class="built_in">Math</span>.PI)</span></span><br><span class="line">          );</span><br><span class="line"><span class="javascript">          meshObj.rotation.x = <span class="built_in">Math</span>.atan(</span></span><br><span class="line"><span class="javascript">            <span class="built_in">Math</span>.tan((geoData[<span class="number">1</span>] / <span class="number">180</span>) * <span class="built_in">Math</span>.PI) /</span></span><br><span class="line"><span class="javascript">            <span class="built_in">Math</span>.sin((geoData[<span class="number">0</span>] / <span class="number">180</span>) * <span class="built_in">Math</span>.PI)</span></span><br><span class="line">          );</span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.meshObj = meshObj;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.scene.add(meshObj);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// cleanup after ourselves</span></span></span><br><span class="line">          context.resetWebGLState();</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        render: <span class="function"><span class="keyword">function</span> <span class="params">(context)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// update camera parameters</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">///////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> cam = context.camera;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.camera.position.set(cam.eye[<span class="number">0</span>], cam.eye[<span class="number">1</span>], cam.eye[<span class="number">2</span>]);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.camera.up.set(cam.up[<span class="number">0</span>], cam.up[<span class="number">1</span>], cam.up[<span class="number">2</span>]);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.camera.lookAt(</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">new</span> THREE.Vector3(cam.center[<span class="number">0</span>], cam.center[<span class="number">1</span>], cam.center[<span class="number">2</span>])</span></span><br><span class="line">          );</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// Projection matrix can be copied directly</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.camera.projectionMatrix.fromArray(cam.projectionMatrix);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// update lighting</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">/////////////////////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="javascript">          view.environment.lighting.date = <span class="built_in">Date</span>.now();</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> l = context.sunLight;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.sun.position.set(l.direction[<span class="number">0</span>], l.direction[<span class="number">1</span>], l.direction[<span class="number">2</span>]);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.sun.intensity = l.diffuse.intensity;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.sun.color = <span class="keyword">new</span> THREE.Color(</span></span><br><span class="line">            l.diffuse.color[0],</span><br><span class="line">            l.diffuse.color[1],</span><br><span class="line">            l.diffuse.color[2]</span><br><span class="line">          );</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.ambient.intensity = l.ambient.intensity;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.ambient.color = <span class="keyword">new</span> THREE.Color(</span></span><br><span class="line">            l.ambient.color[0],</span><br><span class="line">            l.ambient.color[1],</span><br><span class="line">            l.ambient.color[2]</span><br><span class="line">          );</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> meshObj = <span class="keyword">this</span>.meshObj;</span></span><br><span class="line">          meshObj.rotation.z = meshObj.rotation.z + 0.01;</span><br><span class="line">          meshObj.rotation.x = meshObj.rotation.x + 0.01;</span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.scene.add(meshObj);</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// draw the scene</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">/////////////////////////////////////////////////////////////////////////////////////////////////////</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer.state.reset(); <span class="comment">// this.renderer.resetGLState();</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">this</span>.renderer.render(<span class="keyword">this</span>.scene, <span class="keyword">this</span>.camera);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// as we want to smoothly animate the ISS movement, immediately request a re-render</span></span></span><br><span class="line">          externalRenderers.requestRender(view);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">          <span class="comment">// cleanup</span></span></span><br><span class="line">          context.resetWebGLState();</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// register the external renderer</span></span></span><br><span class="line">      externalRenderers.add(view, externalRenderer);</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"viewDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ArcGIS JS API</category>
      </categories>
      <tags>
        <tag>THREE</tag>
        <tag>externalRenderers</tag>
      </tags>
  </entry>
  <entry>
    <title>记一次捂汗治疗风寒感冒</title>
    <url>/2020/07/06/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%8D%82%E6%B1%97%E6%B2%BB%E7%96%97%E9%A3%8E%E5%AF%92%E6%84%9F%E5%86%92/</url>
    <content><![CDATA[<p>新冠疫情期间（2020.6.15-6.19），不小心得了风寒感冒，自己在家用捂汗的方法来治疗。</p>
<h2 id="症状"><a href="#症状" class="headerlink" title="症状"></a>症状</h2><p>扁桃体发炎，喉咙痛。</p>
<p>咳痰（白痰）和流涕。</p>
<p>恶寒，头痛。</p>
<a id="more"></a>
<h2 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h2><ol>
<li><p>按说明书服用猴耳环，对扁桃体消炎。</p>
</li>
<li><p>扁桃体炎症消除后（吃药一天后就明显不红不痛了），停止服用猴耳环。</p>
</li>
<li><p>感冒灵，中午一包，白天多喝热水。</p>
<blockquote>
<p>我不知道猴耳环和感冒灵会不会药物冲突或者药物过量，所以只敢分开吃</p>
</blockquote>
</li>
<li><p>晚饭稍微多吃一些。</p>
</li>
<li><p>晚饭半小时后，热水吃第二包感冒灵。</p>
</li>
<li><p>20点上床睡觉，用被子将自己包裹。感觉身体发热，出汗。</p>
</li>
<li><p>第二天感觉感冒明显好转。</p>
</li>
</ol>
<blockquote>
<p>捂汗只能治疗风寒感冒，千万不能用来治疗风热感冒。</p>
</blockquote>
]]></content>
      <categories>
        <category>Health</category>
      </categories>
      <tags>
        <tag>Health</tag>
        <tag>Cold</tag>
      </tags>
  </entry>
  <entry>
    <title>本地部署ArcGIS-JS-API</title>
    <url>/2020/06/16/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2ArcGIS-JS-API/</url>
    <content><![CDATA[<p>网上有很多的本地部署ArcGIS API for JavaScript教程。</p>
<p>我翻译并简单修改了官网的部署教程（API解压后的install.html），整理如下。</p>
<a id="more"></a>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>官网下载压缩包，然后解压后放置到要部署的web服务器上，可能是IIS、Tomcat或Nginx。</p>
<h2 id="修改代码"><a href="#修改代码" class="headerlink" title="修改代码"></a>修改代码</h2><ol>
<li>打开文件<code>/var/www/html/arcgis_js_api/library/arcgis_js_api/library/4.15/dojo/dojo.js</code> 并检索 <code>[HOSTNAME_AND_PATH_TO_JSAPI]</code>, 然后用<code>www.example.com/arcgis_js_api/library/4.15/</code>替换.</li>
<li>打开文件<code>/var/www/html/arcgis_js_api/library/arcgis_js_api/library/4.15/init.js</code> 并检索  <code>[HOSTNAME_AND_PATH_TO_JSAPI]</code>, 然后用<code>www.example.com/arcgis_js_api/library/4.15/</code>替换.</li>
</ol>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>现在应该能够从你的web服务器使用以下URL访问ArcGIS API for JavaScript：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;www.example.com&#x2F;arcgis_js_api&#x2F;library&#x2F;4.15&#x2F;dojo&#x2F;dojo.js&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>为了测试是否部署成功，可以使用下面的测试页面。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"initial-scale=1, maximum-scale=1,user-scalable=no"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Test Map<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://www.example.com/arcgis_js_api/library/4.15/dijit/themes/claro/claro.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://www.example.com/arcgis_js_api/library/4.15/esri/themes/light/main.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      html,</span><br><span class="line">      body,</span><br><span class="line"><span class="css">      <span class="selector-id">#viewDiv</span> &#123;</span></span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">        width: 100%;</span><br><span class="line">        height: 100%;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://www.example.com/arcgis_js_api/library/4.15/dojo/dojo.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> myMap, view;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">require</span>([</span></span><br><span class="line"><span class="actionscript">        <span class="string">"esri/Basemap"</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"esri/layers/TileLayer"</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"esri/Map"</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"esri/views/MapView"</span></span></span><br><span class="line"><span class="actionscript">      ], <span class="function"><span class="keyword">function</span> <span class="params">(Basemap, TileLayer, Map, MapView)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// --------------------------------------------------------------------</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// If you do not have public internet access then use the Basemap class</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// and point this URL to your own locally accessible cached service.</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">//</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// Otherwise you can just use one of the named hosted ArcGIS services.</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// --------------------------------------------------------------------</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> layer = <span class="keyword">new</span> TileLayer(&#123;</span></span><br><span class="line"><span class="actionscript">          url: <span class="string">"https://www.example.com/arcgis/rest/services/Folder/Custom_Base_Map/MapServer"</span></span></span><br><span class="line">        &#125;);</span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> customBasemap = <span class="keyword">new</span> Basemap(&#123;</span></span><br><span class="line">          baseLayers: [layer],</span><br><span class="line"><span class="actionscript">          title: <span class="string">"Custom Basemap"</span>,</span></span><br><span class="line"><span class="actionscript">          id: <span class="string">"myBasemap"</span></span></span><br><span class="line">        &#125;);</span><br><span class="line"><span class="javascript">        myMap = <span class="keyword">new</span> <span class="built_in">Map</span>(&#123;</span></span><br><span class="line">          basemap: customBasemap</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="actionscript">        view = <span class="keyword">new</span> MapView(&#123;</span></span><br><span class="line"><span class="actionscript">          center: [<span class="number">-111.87</span>, <span class="number">40.57</span>], <span class="comment">// long, lat</span></span></span><br><span class="line"><span class="actionscript">          container: <span class="string">"viewDiv"</span>,</span></span><br><span class="line">          map: myMap,</span><br><span class="line">          zoom: 6</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"claro"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"viewDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><em>注意</em>：1. 修改页面中的链接；2. 使用http或https协议，请勿使用file协议访问页面。</p>
</blockquote>
<h2 id="使用HTTP"><a href="#使用HTTP" class="headerlink" title="使用HTTP"></a>使用HTTP</h2><p>如果你希望使用<code>http</code>来使用API，那么在修改代码步骤中，用<code>http</code>代替<code>https</code>，如，</p>
<p>修改前: <code>baseUrl:&quot;https://www.example.com/arcgis_js_api/library/4.15/dojo&quot;</code></p>
<p>修改后: <code>baseUrl:&quot;http://www.example.com/arcgis_js_api/library/4.15/dojo&quot;</code></p>
<h2 id="字体跨域"><a href="#字体跨域" class="headerlink" title="字体跨域"></a>字体跨域</h2><p>在开发模式下，可能会出现字体跨域，导致微件上的图标无法显示。下面列举在不同服务器上通过允许跨域来处理。</p>
<h3 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h3><ol>
<li><p>打开IIS管理器</p>
</li>
<li><p>选中部署API的网站，找到<strong><em>HTTP响应标头</em></strong>和<strong><em>MIME类型</em></strong></p>
</li>
<li><p>配置MIME类型<br>有下列的类型需要注册：</p>
<table>
<thead>
<tr>
<th>extension</th>
<th><code>MIME/type</code></th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>.ttf</code></td>
<td><code>application/octet-stream</code></td>
<td>True Type Fonts</td>
</tr>
<tr>
<td><code>.wasm</code></td>
<td><code>application/wasm</code></td>
<td><a href="http://webassembly.org/" target="_blank" rel="noopener">WebAssembly</a></td>
</tr>
<tr>
<td><code>.woff</code></td>
<td><code>application/font-woff</code></td>
<td><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/WOFF" target="_blank" rel="noopener">Web Open Font Format</a></td>
</tr>
<tr>
<td><code>.woff2</code></td>
<td><code>application/font-woff2</code></td>
<td><a href="https://www.w3.org/TR/WOFF2/" target="_blank" rel="noopener">WOFF File Format 2.0</a></td>
</tr>
<tr>
<td><code>.wsv</code></td>
<td><code>application/octet-stream</code></td>
<td>Supports <code>SceneView</code>‘s stars visualization</td>
</tr>
</tbody></table>
<p>点击<strong><em>MIME类型</em></strong>，右键选择<strong>打开功能</strong>，然后右键选择<strong>添加</strong>。</p>
</li>
<li><p>配置HTTP响应标头<br>点击<strong><em>HTTP响应标头</em></strong>，右键选择<strong>打开功能</strong>，然后右键选择<strong>添加</strong>。<br>添加名称：<code>Access-Control-Allow-Origin</code> ，值：<code>*</code>。</p>
</li>
</ol>
<h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><p>修改Tomcat配置文件，安装目录下的<code>conf/web.xml</code>。</p>
<p>按照<a href="http://tomcat.apache.org/tomcat-8.0-doc/config/filter.html#CORS_Filter" target="_blank" rel="noopener">官网说明</a>在<code>&lt;!-- ================== Built In Filter Definitions ===================== --&gt;</code>之后增加一段配置。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CorsFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.catalina.filters.CorsFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.allowed.origins<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.allowed.methods<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>GET,POST,HEAD,OPTIONS,PUT<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.allowed.headers<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>Content-Type,X-Requested-With,accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.exposed.headers<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>Access-Control-Allow-Origin,Access-Control-Allow-Credentials<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.support.credentials<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.preflight.maxage<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CorsFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：当cors.allowed.origins设置为*时，cors.support.credentials不能设置为true。</p>
</blockquote>
<h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><p>修改Nginx配置文件，</p>
<p>增加一行<code>add_header Access-Control-Allow-Origin *;</code>如，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">location &#x2F;arcgis&#x2F;api &#123;</span><br><span class="line">	add_header Access-Control-Allow-Origin *;</span><br><span class="line">	alias C:&#x2F;Resource&#x2F;arcgis&#x2F;api;</span><br><span class="line">	index dojo&#x2F;dojo.js;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ArcGIS JS API</category>
      </categories>
      <tags>
        <tag>ArcGIS JS API</tag>
        <tag>ArcGIS</tag>
        <tag>CORS</tag>
      </tags>
  </entry>
  <entry>
    <title>设置滚动条样式</title>
    <url>/2020/06/29/%E8%AE%BE%E7%BD%AE%E6%BB%9A%E5%8A%A8%E6%9D%A1%E6%A0%B7%E5%BC%8F/</url>
    <content><![CDATA[<p>不使用插件，通过CSS设置滚动条样式。</p>
<p>你可以使用以下伪元素选择器去修改各式webkit浏览器的滚动条样式：</p>
<ul>
<li><code>::-webkit-scrollbar</code> — 整个滚动条.</li>
<li><code>::-webkit-scrollbar-button</code> — 滚动条上的按钮 (上下箭头).</li>
<li><code>::-webkit-scrollbar-thumb</code> — 滚动条上的滚动滑块.</li>
<li><code>::-webkit-scrollbar-track</code> — 滚动条轨道.</li>
<li><code>::-webkit-scrollbar-track-piece</code> — 滚动条没有滑块的轨道部分.</li>
<li><code>::-webkit-scrollbar-corner</code> — 当同时有垂直滚动条和水平滚动条时交汇的部分.</li>
<li><code>::-webkit-resizer</code> — 某些元素的corner部分的部分样式(如:textarea的可拖动按钮).<a id="more"></a>
<h2 id="设置浏览器滚动条"><a href="#设置浏览器滚动条" class="headerlink" title="设置浏览器滚动条"></a>设置浏览器滚动条</h2></li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">// 滚动条凹槽的颜色，还可以设置边框属性</span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-track-piece</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f8f8f8</span>;</span><br><span class="line">&#125;</span><br><span class="line">// 滚动条的宽度</span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line">// 滚动条的滑块</span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-thumb</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ddd</span>;</span><br><span class="line">  <span class="attribute">background-clip</span>: padding-box;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-pseudo">::-webkit-scrollbar-thumb</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">	<span class="attribute">background-color</span>: <span class="number">#bbb</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="设置div滚动条"><a href="#设置div滚动条" class="headerlink" title="设置div滚动条"></a>设置div滚动条</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"scroll"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.scroll</span><span class="selector-pseudo">::-webkit-scrollbar</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.scroll</span><span class="selector-pseudo">::-webkit-scrollbar-track</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: orange;</span><br><span class="line">  <span class="attribute">-webkit-border-radius</span>: <span class="number">2em</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">2em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.scroll</span><span class="selector-pseudo">::-webkit-scrollbar-thumb</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">  <span class="attribute">-webkit-border-radius</span>: <span class="number">2em</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">2em</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用jQuery控制滚动条"><a href="#使用jQuery控制滚动条" class="headerlink" title="使用jQuery控制滚动条"></a>使用jQuery控制滚动条</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="keyword">this</span>).animate(&#123; <span class="attr">scrollTop</span>: <span class="string">"+=50"</span> &#125;, <span class="number">1000</span>); <span class="comment">// 竖直</span></span><br><span class="line">$(<span class="keyword">this</span>).animate(&#123; <span class="attr">scrollLeft</span>: <span class="string">"+=50"</span> &#125;, <span class="number">1000</span>); <span class="comment">// 水平</span></span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<p>$(this)表示要滚动的对象，-=50表示向上（左）滚动50px ， +=50表示向下（右）滚动50px ，1000表示滚动速度，可能的值：毫秒、”slow”、”fast”。</p>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>翻译-微件开发</title>
    <url>/2021/04/22/%E7%BF%BB%E8%AF%91-%E5%BE%AE%E4%BB%B6%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<p><em>翻译自ArcGIS JS API 官网教程！！！</em></p>
<p>微件是可重用的用户界面组件，是提供丰富用户体验的关键。ArcGIS for JavaScript API提供了一组随时可用的微件。从4.2版开始，它还为创建定制微件提供了基础。</p>
<a id="more"></a>
<p>本指南讨论微件开发的基本原理。在当前框架下，它的实现仅关注特定领域。无论微件的功能是什么，创建自定义微件的基础都是一致的。这里有<a href="https://developers.arcgis.com/javascript/latest/custom-widget/#additional-information" target="_blank" rel="noopener">额外的资源</a> 帮助您入门。可参考 <a href="https://developers.arcgis.com/javascript/latest/sample-code/widgets-custom-widget/index.html" target="_blank" rel="noopener">Create custom widget</a> 和 <a href="https://developers.arcgis.com/javascript/latest/sample-code/widgets-custom-recenter/index.html" target="_blank" rel="noopener">Recenter widget</a> 的示例，了解如何创建自己的自定义微件。</p>
<blockquote>
<p>请注意，这个框架并不打算替代所有dijit。使用dgrid就是一个这样的例子。在这里，您仍然需要使用Dijit。</p>
</blockquote>
<h2 id="开发前提"><a href="#开发前提" class="headerlink" title="开发前提"></a>开发前提</h2><p>在创建自己的自定义微件之前，您需要确保具备所需的要求。这些将根据您的微件需求而变化。下面列出的是微件开发的最低要求。</p>
<h3 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h3><p><a href="https://www.typescriptlang.org/" target="_blank" rel="noopener">TypeScript</a>是JavaScript的超集。编写后它会被编译成纯JavaScript。微件开发建议使用TypeScript。这有一个额外的 <a href="https://developers.arcgis.com/javascript/latest/guide/typescript-setup/index.html" target="_blank" rel="noopener">TypeScript 启动</a> 的例子，它提供了一些基础步骤来搭建你的TypeScript开发环境。这里有大量的<a href="https://www.sitepen.com/blog/update-the-definitive-typescript-guide/" target="_blank" rel="noopener">网络资源</a> 详细介绍TypeScript是什么，为什么使用和怎么使用它。熟悉这些基本知识将使微件开发过程更加容易。</p>
<h3 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h3><p><a href="https://www.typescriptlang.org/docs/handbook/jsx.html" target="_blank" rel="noopener">JSX</a> 是一种JavaScript扩展语法，它允许我们像描述HTML一样描述微件UI。它看起来类似于HTML，它可以与JavaScript内联使用。</p>
<h3 id="熟悉esri-core-Accessor"><a href="#熟悉esri-core-Accessor" class="headerlink" title="熟悉esri/core/Accessor"></a>熟悉esri/core/Accessor</h3><p><a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-core-Accessor.html" target="_blank" rel="noopener">Accessor</a> 是4.x的核心特性之一，也是所有类（包括微件）的基类。关于它如何工作及其使用模式的更多细节，请参阅主题<a href="https://developers.arcgis.com/javascript/latest/guide/implementing-accessor/index.html" target="_blank" rel="noopener">实现访问器</a>。</p>
<h2 id="微件生命周期"><a href="#微件生命周期" class="headerlink" title="微件生命周期"></a>微件生命周期</h2><p>在开始开发之前，一定要对微件的生命周期有个大致的了解。无论微件类型如何，其生命周期的一般概念都是相同的。它们是：</p>
<ol>
<li><strong>constructor (params)</strong> - 这里是微件初始化时设置所需属性的地方。由于微件是从<a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-core-Accessor.html" target="_blank" rel="noopener">Accessor</a>派生的，因此你可以在<a href="https://developers.arcgis.com/javascript/latest/programming-patterns/#properties" target="_blank" rel="noopener">处理属性</a>主题中了解获取、设置和查看属性。</li>
<li><strong>postInitialize()</strong> - 这个方法在微件被创建，但是UI还没有渲染的时候调用。</li>
<li><strong>render()</strong> - 这是唯一的一个必须方法，用来渲染UI。</li>
<li><strong>destroy()</strong> - 释放微件示例方法。</li>
</ol>
<h2 id="TypeScript装饰器"><a href="#TypeScript装饰器" class="headerlink" title="TypeScript装饰器"></a>TypeScript装饰器</h2><p>微件开发利用了 <a href="https://www.typescriptlang.org/docs/handbook/decorators.html" target="_blank" rel="noopener">TypeScript装饰器</a>。这允许我们在设计时定义和修改现有属性、方法和构造函数中的公共行为。我们将在下面讨论最常见的微件装饰器类型。</p>
<h3 id="subclass"><a href="#subclass" class="headerlink" title="@subclass"></a><code>@subclass</code></h3><p>可以将这些装饰器看作是用于创建类的底层粘合剂。</p>
<p>下面的代码片段导入并扩展了esri/widgets/Widget类，并在render方法中定义了UI。JSX用于定义UI。在这个简单的场景中，创建了一个内容为John Smith的div元素。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import Widget from &quot;esri&#x2F;widgets&#x2F;Widget&quot;;</span><br><span class="line"></span><br><span class="line">@subclass(&quot;esri.widgets.HelloWorld&quot;)</span><br><span class="line">class HelloWorld extends Widget &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;John Smith&lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="property"><a href="#property" class="headerlink" title="@property()"></a><code>@property()</code></h3><p>此装饰器用于定义访问器属性。使用这个装饰器定义的任何属性现在都可以获得和设置。此外，您还可以观察任何属性的更改。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@property()</span><br><span class="line">name: string;</span><br></pre></td></tr></table></figure>

<h3 id="renderable"><a href="#renderable" class="headerlink" title="@renderable()"></a><code>@renderable()</code></h3><p>此装饰器用于调度渲染。每当修改属性时，都会自动调度和更新渲染。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@renderable()</span><br><span class="line">name: string;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通常，在实现类属性时，您将同时使用@property()和@renderable()。例如,</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@property()</span><br><span class="line">@renderable()</span><br><span class="line">name: string;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="aliasOf"><a href="#aliasOf" class="headerlink" title="@aliasOf()"></a><code>@aliasOf()</code></h3><p>这个装饰器允许我们定义一个属性别名。这有助于保持代码的整洁，从而不重复现有的属性(例如，已经在ViewModel中实现了)。上面提供的完整示例没有使用此装饰器。如果有一个与该文件相关联的HelloWorldViewModel，则可以通过这种方法直接访问其属性，从而避免代码重复。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@aliasOf(&quot;viewModel.name&quot;)</span><br><span class="line">name: string;</span><br></pre></td></tr></table></figure>

<h2 id="微件实施"><a href="#微件实施" class="headerlink" title="微件实施"></a>微件实施</h2><p>以下步骤提供了实现自定义小部件所需步骤的高级概述:</p>
<h3 id="继承微件"><a href="#继承微件" class="headerlink" title="继承微件"></a>继承微件</h3><p>在非常基本的层次上，您将通过扩展基本的小部件类来创建小部件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; Import used to extend off of base Widget class</span><br><span class="line">import Widget from &quot;esri&#x2F;widgets&#x2F;Widget&quot;;</span><br><span class="line"></span><br><span class="line">@subclass(&quot;esri.widgets.HelloWorld&quot;)</span><br><span class="line">class HelloWorld extends Widget &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现属性和方法"><a href="#实现属性和方法" class="headerlink" title="实现属性和方法"></a>实现属性和方法</h3><p>接下来，您可以实现特定于该小部件的任何属性和/或方法。这段代码展示了如何利用这些属性的装饰器。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; Create &#39;name&#39; property</span><br><span class="line">@property()</span><br><span class="line">@renderable()</span><br><span class="line">name: string &#x3D; &quot;John Smith&quot;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Create &#39;emphasized&#39; property</span><br><span class="line">@property()</span><br><span class="line">@renderable()</span><br><span class="line">emphasized: boolean &#x3D; false;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Create private _onNameUpdate method</span><br><span class="line">private _onNameUpdate(): string &#123; return &#39;$&#123;this.name&#125;&#39;;&#125;</span><br></pre></td></tr></table></figure>

<p>默认情况下，元素中引用的函数将把 <code>this</code> 设置为实际元素。您可以选择使用bind属性来更新 <code>this</code> 。下面的代码绑定了监听 <code>name</code> 属性更新时使用的 <code>_onNameUpdate</code> 回调方法。这在下面的postInitialize方法中显示。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class HelloWorld extends Widget &#123;</span><br><span class="line"></span><br><span class="line">  constructor() &#123;</span><br><span class="line">    super();</span><br><span class="line">    this._onNameUpdate &#x3D; this._onNameUpdate.bind(this);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>postInitialize方法在微件的属性就绪时调用，但在它渲染之前调用。在下面的代码片段中，我们将观察name属性。一旦更新，它将调用_onNameUpdate回调方法。watchUtils.init()调用返回一个WatchHandle对象，然后将该对象传递给own()。这有助于在小部件被销毁后清理任何资源。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">postInitialize() &#123;</span><br><span class="line">  const handle &#x3D; watchUtils.init(this, &quot;name&quot;, this._onNameUpdate);</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; Helper used for cleaning up resources once the widget is destroyed</span><br><span class="line">  this.own(handle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="渲染微件"><a href="#渲染微件" class="headerlink" title="渲染微件"></a>渲染微件</h3><p>在实现属性之后，使用JSX呈现微件的UI。这在微件的render方法中处理，这是微件实现所需的唯一方法。</p>
<blockquote>
<p>有关此特性的额外信息，请参阅下面的 <a href="https://developers.arcgis.com/javascript/latest/custom-widget/#widget-rendering" target="_blank" rel="noopener">示例</a> 。</p>
</blockquote>
<blockquote>
<p>请注意，作为JSX元素创建的小部件目前还不受支持。例如，以下代码片段将不起作用。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const search &#x3D; &lt;Search view&#x3D;&#123;view&#125; &#x2F;&gt;;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>微件CSS通过class属性设置。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  const classes &#x3D; &#123; &quot;hello-world-emphasized&quot;: this.emphasized &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div class &#x3D; &#123;this.classes(&quot;hello-world&quot;,classes)&#125;&gt;</span><br><span class="line">      &#123;this._onNameUpdate()&#125;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在4.7版本之前，如果需要更动态的方法，可以使用classes。这需要一个对象，其中键表示要切换的CSS类。如果值为true则添加该类，如果值为false则删除该类。</p>
<p>从4.7开始，不要使用此属性。而是使用classes helper方法。这个方法简化了CSS类属性的设置。</p>
</blockquote>
<p>最后，在微件上调用destroy将释放微件，并释放在下面postInitialize中引用的own()方法中注册的所有资源。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">postInitialize() &#123;</span><br><span class="line">  const handle &#x3D; watchUtils.init(this, &quot;name&quot;, this._onNameUpdate);</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; Helper used for cleaning up resources once the widget is destroyed</span><br><span class="line">  this.own(handle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="导出模块"><a href="#导出模块" class="headerlink" title="导出模块"></a>导出模块</h3><p>在代码页的最后，添加一行以导出对象。</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export default HelloWorld;</span><br></pre></td></tr></table></figure>

<h3 id="完成代码"><a href="#完成代码" class="headerlink" title="完成代码"></a>完成代码</h3><p> <a href="https://developers.arcgis.com/javascript/latest/sample-code/widgets-custom-widget/index.html" target="_blank" rel="noopener">创建自定义微件</a> 示例完整地显示了.tsx文件。这个TypeScript文件使用这个扩展名来表示这个类使用JSX，e.g. <code>.ts + .jsx = .tsx</code>.</p>
<h2 id="微件渲染"><a href="#微件渲染" class="headerlink" title="微件渲染"></a>微件渲染</h2><p>下面列出的属性可以用于渲染微件样式:</p>
<ul>
<li><a href="https://maquettejs.org/typedoc/interfaces/vnodeproperties.html#classes" target="_blank" rel="noopener">classes:</a> (Deprecated at 4.7) This property allows CSS classes to be added and removed dynamically. Beginning with version 4.7, please use the <a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Widget.html#classes" target="_blank" rel="noopener">classes</a> helper method instead.</li>
<li><a href="http://maquettejs.org/typedoc/interfaces/vnodeproperties.html#styles" target="_blank" rel="noopener">styles:</a> Allows styles to be changed dynamically.</li>
<li><a href="https://maquettejs.org/typedoc/interfaces/vnodeproperties.html#aftercreate" target="_blank" rel="noopener">afterCreate:</a> This callback method executes after the node is added to the DOM. Any child nodes and properties have already been applied. Use this method within <a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Widget.html#render" target="_blank" rel="noopener">render</a> to access the real DOM node. It is also possible to use per element.</li>
<li><a href="http://maquettejs.org/typedoc/interfaces/vnodeproperties.html#afterupdate" target="_blank" rel="noopener">afterUpdate:</a> This callback method executes every time the node is updated.</li>
<li><a href="http://maquettejs.org/typedoc/interfaces/vnodeproperties.html#bind" target="_blank" rel="noopener">bind:</a> This property is used to set the value of <code>this</code> for event handlers.</li>
<li><a href="http://maquettejs.org/typedoc/interfaces/vnodeproperties.html#key" target="_blank" rel="noopener">key:</a> This is used to uniquely identify a DOM node among its siblings. This is important if you have sibling elements with the same selector and the elements are added/removed dynamically.</li>
</ul>
<h2 id="ViewModel模式"><a href="#ViewModel模式" class="headerlink" title="ViewModel模式"></a>ViewModel模式</h2><h2 id="额外信息"><a href="#额外信息" class="headerlink" title="额外信息"></a>额外信息</h2><p>请参阅这些额外的链接以获得更多信息:</p>
<ul>
<li><a href="https://developers.arcgis.com/javascript/latest/sample-code/widgets-custom-widget/index.html" target="_blank" rel="noopener">Create custom widget</a></li>
<li><a href="https://developers.arcgis.com/javascript/latest/sample-code/widgets-custom-recenter/index.html" target="_blank" rel="noopener">Recenter widget</a></li>
<li><a href="https://developers.arcgis.com/javascript/latest/guide/typescript-setup/index.html" target="_blank" rel="noopener">TypeScript Setup</a></li>
<li><a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-core-Accessor.html" target="_blank" rel="noopener">Accessor</a> class</li>
<li><a href="https://developers.arcgis.com/javascript/latest/guide/implementing-accessor/index.html" target="_blank" rel="noopener">Implementing Accessor</a></li>
<li><a href="https://developers.arcgis.com/javascript/latest/guide/programming-patterns/#properties" target="_blank" rel="noopener">Guide - Working with properties</a></li>
<li><a href="https://developers.arcgis.com/javascript/latest/guide/styling/index.html" target="_blank" rel="noopener">Styling</a></li>
<li><a href="https://www.typescriptlang.org/" target="_blank" rel="noopener">TypeScript</a> reference</li>
<li><a href="https://www.typescriptlang.org/docs/handbook/jsx.html" target="_blank" rel="noopener">JSX</a> reference</li>
<li><a href="https://developers.arcgis.com/javascript/latest/guide/migrating/index.html#properties" target="_blank" rel="noopener">Migrating from 3.x to 4.18</a></li>
</ul>
]]></content>
      <categories>
        <category>translation</category>
      </categories>
      <tags>
        <tag>translation</tag>
      </tags>
  </entry>
  <entry>
    <title>css多背景拼接</title>
    <url>/2023/09/25/css%E5%A4%9A%E8%83%8C%E6%99%AF%E6%8B%BC%E6%8E%A5/</url>
    <content><![CDATA[<p>多背景，要求上面 400px 是渐变色，下面全部是纯色。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">      <span class="number">180deg</span>,</span><br><span class="line">      #<span class="number">8392</span>bb <span class="number">0%</span>,</span><br><span class="line">      rgba(<span class="number">232</span>, <span class="number">234</span>, <span class="number">241</span>, <span class="number">0</span>) <span class="number">100%</span></span><br><span class="line">    ), <span class="built_in">linear-gradient</span>(<span class="number">180deg</span>, #e8eaf1 <span class="number">0%</span>, #e8eaf1 <span class="number">100%</span>);</span><br><span class="line">  <span class="attribute">background-size</span>: <span class="number">100%</span> <span class="number">400px</span>, <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat, repeat-y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>background</tag>
      </tags>
  </entry>
  <entry>
    <title>使用中间件解耦业务流函数</title>
    <url>/2023/10/10/%E4%BD%BF%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%A7%A3%E8%80%A6%E4%B8%9A%E5%8A%A1%E6%B5%81%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><ul>
<li>了解中间件、洋葱模型等概念</li>
<li>了解Redux、Koa中中间件的使用</li>
<li>一点函数式编程技巧（方便阅读redux源码）<a id="more"></a>

</li>
</ul>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>点击按钮，执行分析，打印结果。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b;</span><br><span class="line"><span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result = add(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新增需求 ，在分析时增加loading。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'loading...'</span>);</span><br><span class="line">  <span class="keyword">const</span> result = add(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'loaded'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候，loading和业务代码就已经耦合了。像loading、log等是最简单的耦合情况。</p>
<p>实际开发中会发生更复杂的耦合。比如在某个分析前后需要控制图层的加载。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'如果有白模，卸载白模'</span>);</span><br><span class="line">  <span class="keyword">const</span> result = add(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'如果卸载过白模，加载白模'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>继续新增需求，在分析前要矫正参数，在分析后要过滤结果。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'loading...'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'矫正参数'</span>);</span><br><span class="line">  <span class="keyword">const</span> result = add(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'过滤结果'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'loaded'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样整个函数就会越来越难以维护。</p>
<h2 id="期望"><a href="#期望" class="headerlink" title="期望"></a>期望</h2><p>loading函数应该和分析函数解耦，且形态大致如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> loading = <span class="keyword">async</span> (next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'loading...'</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'loaded'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>loading函数不关心分析函数的内容，它只关心执行的顺序，在分析前后显示loading。</p>
<p><code>onClick</code>函数也会对应修改为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result = applyMiddlewares(</span><br><span class="line">    loading,</span><br><span class="line">    add</span><br><span class="line">  )(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="联想"><a href="#联想" class="headerlink" title="联想"></a>联想</h2><p>从loading函数的形态，很容易能联想到Redux或者Koa的中间件。</p>
<p><a href="https://cn.redux.js.org/understanding/history-and-design/middleware/#%E7%90%86%E8%A7%A3-middleware" target="_blank" rel="noopener">Redux</a>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="function"><span class="params">store</span> =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'dispatching'</span>, action)</span><br><span class="line">  <span class="keyword">const</span> result = next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState())</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://koajs.com.cn/" target="_blank" rel="noopener">Koa</a>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="keyword">const</span> ms = <span class="built_in">Date</span>.now() - start;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;ctx.method&#125;</span> <span class="subst">$&#123;ctx.url&#125;</span> - <span class="subst">$&#123;ms&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>代码示例均来官方文档。</p>
</blockquote>
<h2 id="核心"><a href="#核心" class="headerlink" title="核心"></a>核心</h2><p>因为redux的中间件必须和store绑定使用，不能直接使用，所以参考<a href="https://github1s.com/reduxjs/redux/blob/master/src/applyMiddleware.ts" target="_blank" rel="noopener">redux源码</a>实现了<code>applyMiddlewares</code>方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> applyMiddlewares =</span><br><span class="line">  (...middlewares) =&gt;</span><br><span class="line">  <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> chain = middlewares.reduceRight(</span><br><span class="line">      (acc, curr) =&gt; <span class="function"><span class="params">()</span> =&gt;</span> curr(ctx, acc),</span><br><span class="line">      () =&gt; &#123;&#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">await</span> chain();</span><br><span class="line">    <span class="keyword">return</span> ctx;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>函数的作用就是控制执行顺序。</p>
<p>输入是中间件函数<code>middlewares</code>和上下文<code>ctx</code>，输出是上下文<code>ctx</code>。</p>
<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><p>现在把loading改造成为中间件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> middleware1 = <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware1 before"</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware1 after"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> middleware2 = <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware2 before"</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware2 after"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> middleware3 = <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware3 before"</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware3 after"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>把分析函数更新为异步函数，再套一层函数成为中间件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(a + b), <span class="number">3000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> core = <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; a, b &#125; = ctx;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> add(a, b);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  ctx.result = result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>参数和结果都在<code>ctx</code>中获取和赋值。</p>
<p>核心函数（最后一个函数）可不再调用<code>next()</code>。</p>
<h2 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h2><p>调用时，传入中间件函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ctx = <span class="keyword">await</span> applyMiddlewares(</span><br><span class="line">  middleware1,</span><br><span class="line">  middleware2,</span><br><span class="line">  middleware3,</span><br><span class="line">  core</span><br><span class="line">)(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(ctx); <span class="comment">// &#123; a: 1, b: 1, result: 2&#125;</span></span><br></pre></td></tr></table></figure>

<p>控制台日志：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">middleware1 before ​​​​​at ​​​​​​quokka.js:8:3​</span><br><span class="line"></span><br><span class="line">middleware2 before ​​​​​at ​​​​​​quokka.js:14:3​</span><br><span class="line"></span><br><span class="line">middleware3 before ​​​​​at ​​​​​​quokka.js:20:3​</span><br><span class="line"></span><br><span class="line">2 ​​​​​at ​​​​​​​​result​​​ ​quokka.js:28:3​</span><br><span class="line"></span><br><span class="line">middleware3 after ​​​​​at ​​​​​​quokka.js:22:3​</span><br><span class="line"></span><br><span class="line">middleware2 after ​​​​​at ​​​​​​quokka.js:16:3​</span><br><span class="line"></span><br><span class="line">middleware1 after ​​​​​at ​​​​​​quokka.js:10:3​</span><br><span class="line"></span><br><span class="line">&#123; a: 1, b: 1, result: 2 &#125;</span><br><span class="line">  ​​​​​at ​​​​​​​​ctx​​​ ​quokka.js:49:1</span><br></pre></td></tr></table></figure>

<h2 id="延伸"><a href="#延伸" class="headerlink" title="延伸"></a>延伸</h2><p>有了中间件之后，处理新的需求就变得非常简单。</p>
<p>middleware1作为loading函数，middleware2作为矫正参数，middleware3作为过滤结果即可。</p>
<p>像定位和高亮结果，也都可以作为中间件函数。</p>
<p>洋葱图：（矫正参数（（（（分析）过滤结果）定位）高亮））</p>
<p>代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ctx = <span class="keyword">await</span> applyMiddlewares(</span><br><span class="line">  矫正参数,</span><br><span class="line">  定位,</span><br><span class="line">  高亮,</span><br><span class="line">  过滤结果,</span><br><span class="line">  分析</span><br><span class="line">)(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(ctx);</span><br></pre></td></tr></table></figure>

<p>执行顺序：矫正参数=》分析=》过滤结果=》定位=》高亮</p>
<h2 id="附件"><a href="#附件" class="headerlink" title="附件"></a>附件</h2><p>完整示例代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(a + b), <span class="number">3000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> middleware1 = <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware1 before"</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware1 after"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> middleware2 = <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware2 before"</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware2 after"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> middleware3 = <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware3 before"</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"middleware3 after"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> core = <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; a, b &#125; = ctx;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> add(a, b);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  ctx.result = result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> applyMiddlewares =</span><br><span class="line">  (...middlewares) =&gt;</span><br><span class="line">  <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> chain = middlewares.reduceRight(</span><br><span class="line">      (acc, curr) =&gt; <span class="function"><span class="params">()</span> =&gt;</span> curr(ctx, acc),</span><br><span class="line">      () =&gt; &#123;&#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">await</span> chain();</span><br><span class="line">    <span class="keyword">return</span> ctx;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx = <span class="keyword">await</span> applyMiddlewares(</span><br><span class="line">  middleware1,</span><br><span class="line">  middleware2,</span><br><span class="line">  middleware3,</span><br><span class="line">  core</span><br><span class="line">)(&#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(ctx);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>middleware</tag>
      </tags>
  </entry>
</search>
